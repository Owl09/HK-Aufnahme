<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Aufnahme HK Daten</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="manifest.webmanifest">
    <style>
        :root { font-family: "Segoe UI", Arial, sans-serif; -webkit-text-size-adjust: 100%; }
        body { margin: 0; padding: calc(24px + env(safe-area-inset-top)) 16px calc(36px + env(safe-area-inset-bottom)); background: #f4f5f7; color: #1f2933; display: flex; justify-content: center; }
        .card { width: min(940px, 100%); background: #fff; border-radius: 16px; padding: 28px; box-shadow: 0 18px 40px rgba(15,23,42,0.12); border: 1px solid #e5e7eb; }
        h1 { margin: 0 0 6px; }
        p { margin: 0 0 20px; color: #4b5563; }
        form { display: flex; flex-direction: column; gap: 18px; }
        .room-card { border: 1px solid #d1d5db; border-radius: 14px; background: #fcfdff; }
        .system-card { border: 1px solid #d1d5db; border-radius: 14px; background: #fcfdff; padding: 18px 20px; display: flex; flex-direction: column; gap: 16px; }
        .system-row { display: flex; flex-direction: column; gap: 10px; }
        textarea { width: 100%; min-height: 72px; padding: 10px 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 16px; background: #fff; resize: vertical; }
        .hidden { display: none; }
        details { border-radius: 14px; }
        summary { list-style: none; cursor: pointer; padding: 18px 20px; display: flex; justify-content: space-between; align-items: center; color: #111827; font-weight: 600; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: "+"; font-size: 20px; transition: transform 0.2s; }
        details[open] summary::after { transform: rotate(45deg); }
        summary span { display: flex; flex-direction: column; }
        summary small { font-weight: normal; color: #6b7280; }
        .room-body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 18px; }
        .field-row { display: grid; grid-template-columns: 170px 1fr 1fr; gap: 12px; align-items: center; }
        .field-row.single { grid-template-columns: 170px 1fr; }
        label { font-weight: 600; color: #1f2933; }
        select, input[type="text"] { width: 100%; padding: 10px 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 16px; background: #fff; }
        .inline-options { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
        .inline-options label { display: flex; align-items: center; gap: 6px; font-weight: 600; }
        .inline-options input { width: auto; }
        .draw-wrap { margin-top: 6px; display: flex; flex-direction: column; gap: 6px; }
        .draw-canvas { width: 100%; height: 44px; border: 1px dashed #cbd5e1; border-radius: 6px; background: #fff; touch-action: none; }
        .draw-wrap { margin-top: 0; }
        .draw-actions { justify-content: flex-end; }
        .draw-actions { display: none; }
        .draw-action { display: none; }
        small { display: none; margin-top: 4px; color: #64748b; font-weight: normal; }
        .hk-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px; background: #fff; display: flex; flex-direction: column; gap: 12px; }
        .hk-card h3 { margin: 0; font-size: 16px; color: #0f172a; }
        .hk-toggle { border: none; margin: 0; }
        .hk-toggle summary { padding: 12px 16px; border: 1px dashed #94a3b8; border-radius: 10px; font-weight: 600; font-size: 15px; color: #1d4ed8; background: #f8fafc; }
        .hk-toggle summary::after { content: "+"; font-size: 16px; }
        .hk-toggle[open] summary::after { content: "-"; }
        .hk-toggle .hk-card { margin-top: 10px; }
        .add-hk-btn, .add-room-btn, .export-btn, .reset-btn { margin: 10px 0 0; padding: 10px 14px; border-radius: 10px; border: 1px dashed #9ca3af; background: #f9fafb; color: #111827; font-weight: 600; cursor: pointer; width: 100%; text-align: center; }
        .add-hk-btn:active, .add-room-btn:active, .export-btn:active, .reset-btn:active { transform: translateY(1px); }
        .add-room-btn { margin-top: 16px; }
        .export-btn { border-color: #2563eb; color: #1d4ed8; background: #eef2ff; }
        .reset-btn { border-color: #ef4444; color: #991b1b; background: #fef2f2; }
        .print-view { display: block; visibility: hidden; height: 0; overflow: hidden; }
        .print-view { font-family: "Segoe UI", Arial, sans-serif; color: #0f172a; padding: 18px; }
        .print-view .doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 14px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }
        .print-view h1 { margin: 0; font-size: 22px; }
        .print-view .meta { color: #6b7280; font-size: 13px; }
        .print-view .room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin: 0 0 14px; background: #fff; }
        .print-view .room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .print-view .room-title { font-size: 18px; font-weight: 700; }
        .print-view .room-sub { color: #6b7280; font-size: 14px; }
        .print-view .badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }
        .print-view table { width: 100%; border-collapse: collapse; }
        .print-view th, .print-view td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }
        .print-view th { background: #f8fafc; font-weight: 700; }
        .print-view .draw-img { display: block; max-height: 60px; max-width: 140px; }
        body.show-print .card { display: none; }
        body.show-print .print-view { visibility: visible; height: auto; overflow: visible; }
        @media print {
          body { background: #fff; }
          .card, .add-room-btn, .export-btn, .add-hk-btn { display: none !important; }
          .print-view { visibility: visible !important; height: auto !important; overflow: visible !important; }
          .print-view .room { break-inside: avoid; page-break-inside: avoid; }
        }
        @media (max-width: 720px) { .field-row, .field-row.single { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<main class="card">
    <header>
        <h1>Aufnahme HK Daten</h1>
        <p>Auch im iPad Dateien-Viewer nutzbar: R&auml;ume und Heizk&ouml;rper ohne JavaScript erfassen.</p>
    </header>
    <form>
        <section class="system-card">
            <h2 style="margin:0;font-size:18px;">Anlagentechnik</h2>
            <div class="system-row">
                <label>Fl&auml;chenheizung vorhanden?</label>
                <div class="inline-options">
                    <label><input type="radio" name="surfaceHeating" value="Ja">Ja</label>
                    <label><input type="radio" name="surfaceHeating" value="Nein">Nein</label>
                </div>
            </div>
            <div class="system-row hidden" id="surfaceHeatingDetails">
                <div class="inline-options">
                    <label><input type="checkbox" name="surfaceHeatingDistributorPhoto">Foto vom Verteiler</label>
                </div>
                <div class="field-row single">
                    <label for="distributorDn">Verteiler DN</label>
                    <textarea id="distributorDn" name="distributorDn" placeholder="mit Stift eintragen"></textarea>
                </div>
                <div class="field-row single">
                    <label for="layingSpacing">Verlegeabstand</label>
                    <select id="layingSpacing" name="layingSpacing">
                        <option value="" selected disabled>Abstand w&auml;hlen &hellip;</option>
                        <option>5</option>
                        <option>5.5</option>
                        <option>7.5</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12.5</option>
                        <option>15</option>
                        <option>16.5</option>
                        <option>20</option>
                        <option>22.5</option>
                        <option>25</option>
                        <option>27.5</option>
                        <option>30</option>
                    </select>
                </div>
                <div class="field-row single">
                    <label for="fBHLineDiameter">Durchmesser Leitung FBH</label>
                    <select id="fBHLineDiameter" name="fBHLineDiameter">
                        <option value="" selected disabled>Durchmesser w&auml;hlen &hellip;</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                        <option>32</option>
                        <option>33</option>
                        <option>34</option>
                        <option>35</option>
                        <option>36</option>
                        <option>37</option>
                        <option>38</option>
                        <option>39</option>
                        <option>40</option>
                        <option>41</option>
                        <option>42</option>
                        <option>43</option>
                        <option>44</option>
                        <option>45</option>
                        <option>46</option>
                        <option>47</option>
                        <option>48</option>
                        <option>49</option>
                        <option>50</option>
                    </select>
                </div>
            </div>
        </section>
        <section class="room-card">
            <details open>
                <summary><span data-room-label data-default="Raum 1">Raum 1 <small>Geschoss zuerst w&auml;hlen</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room1Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room1Floor" name="room1Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room1Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room1Name" name="room1Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm1">Platte</label>
                                    <label><input type="radio" name="room1HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm2">Platte</label>
                                    <label><input type="radio" name="room1HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm3">Platte</label>
                                    <label><input type="radio" name="room1HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 2">Raum 2 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room2Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room2Floor" name="room2Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room2Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room2Name" name="room2Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm1">Platte</label>
                                    <label><input type="radio" name="room2HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm2">Platte</label>
                                    <label><input type="radio" name="room2HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm3">Platte</label>
                                    <label><input type="radio" name="room2HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 3">Raum 3 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room3Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room3Floor" name="room3Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room3Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room3Name" name="room3Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm1">Platte</label>
                                    <label><input type="radio" name="room3HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm2">Platte</label>
                                    <label><input type="radio" name="room3HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm3">Platte</label>
                                    <label><input type="radio" name="room3HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 4">Raum 4 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room4Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room4Floor" name="room4Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room4Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room4Name" name="room4Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm1">Platte</label>
                                    <label><input type="radio" name="room4HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm2">Platte</label>
                                    <label><input type="radio" name="room4HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm3">Platte</label>
                                    <label><input type="radio" name="room4HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 5">Raum 5 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room5Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room5Floor" name="room5Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room5Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room5Name" name="room5Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm1">Platte</label>
                                    <label><input type="radio" name="room5HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm2">Platte</label>
                                    <label><input type="radio" name="room5HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm3">Platte</label>
                                    <label><input type="radio" name="room5HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <button type="button" class="add-room-btn">+ Raum hinzuf&uuml;gen</button>
        <button type="button" class="export-btn">PDF-&Uuml;bersicht erstellen</button>
        <button type="button" class="reset-btn">Alles reseten</button>
        <p style="margin-top:12px;color:#6b7280;font-size:15px;">Tipp: R&auml;ume lassen sich mit dem Button oben beliebig erg&auml;nzen. Bei Bedarf in Safari, Chrome oder Edge &ouml;ffnen.</p>
    </form>
</main>
<div id="printView" class="print-view" aria-hidden="true"></div>
<script>
(function(){
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js?v=3").then(reg => {
        reg.update().catch(() => {});
      }).catch(() => {});
    });
  }
  function updateLabels(){
    const cards = document.querySelectorAll(".room-card");
    const seen = {};
    cards.forEach(card => {
      const label = card.querySelector("[data-room-label]");
      const roomSel = card.querySelector('select[name$="Name"]');
      const floorSel = card.querySelector('select[name$="Floor"]');
      if(!label || !roomSel || !floorSel) return;
      const base = label.dataset.default || label.textContent.trim();
      const room = roomSel.value;
      const floor = floorSel.value;
      let text = base;
      if(room){
        seen[room] = (seen[room] || 0) + 1;
        const suffix = seen[room] > 1 ? seen[room] : "";
        text = room + suffix + (floor ? ` (${floor})` : "");
      }
      const small = label.querySelector("small");
      label.textContent = "";
      label.append(document.createTextNode(text + " "));
      if(small) label.append(small);
    });
  }

  function attachRoomListeners(card){
    const roomSel = card.querySelector('select[name$="Name"]');
    const floorSel = card.querySelector('select[name$="Floor"]');
    roomSel && roomSel.addEventListener("change", updateLabels);
    floorSel && floorSel.addEventListener("change", updateLabels);
  }

  function cacheDefaults(hk){
    hk.querySelectorAll("label").forEach(label => {
      if(!label.dataset.defaultLabel) label.dataset.defaultLabel = label.innerHTML;
    });
    hk.querySelectorAll("select").forEach(sel => {
      if(sel.dataset.defaultOptions) return;
      const opts = Array.from(sel.options).map(opt => ({
        value: opt.value,
        text: opt.text,
        disabled: opt.disabled
      }));
      sel.dataset.defaultOptions = JSON.stringify(opts);
    });
    hk.querySelectorAll('input[type="text"]').forEach(inp => {
      if(!inp.dataset.defaultPlaceholder) inp.dataset.defaultPlaceholder = inp.placeholder || "";
    });
  }

  function restoreSelect(sel){
    if(!sel || !sel.dataset.defaultOptions) return;
    let opts = [];
    try { opts = JSON.parse(sel.dataset.defaultOptions); } catch(e){ opts = []; }
    sel.innerHTML = "";
    opts.forEach(opt => {
      const el = document.createElement("option");
      el.value = opt.value;
      el.textContent = opt.text;
      if(opt.disabled) el.disabled = true;
      sel.appendChild(el);
    });
    sel.selectedIndex = 0;
  }

  function setSelectOptions(sel, placeholder, values){
    if(!sel) return;
    sel.innerHTML = "";
    const first = document.createElement("option");
    first.value = "";
    first.textContent = placeholder;
    first.disabled = true;
    first.selected = true;
    sel.appendChild(first);
    values.forEach(val => {
      const opt = document.createElement("option");
      opt.value = val;
      opt.textContent = val;
      sel.appendChild(opt);
    });
  }

  function applyBauform(hk){
    const checked = hk.querySelector('input[type="radio"][name*="HkForm"]:checked');
    const checkedText = checked && checked.parentElement ? checked.parentElement.textContent : "";
    const isRippen = !!(checked && /Rippen/i.test(checkedText));
    cacheDefaults(hk);
    const heightSel = hk.querySelector('select[name*="HkHeight"]');
    const widthSel = hk.querySelector('select[name*="HkWidth"]');
    const dnSel = hk.querySelector('select[name*="HkDn"]');
    const typeSel = hk.querySelector('select[name*="HkType"]');
    const heightRow = heightSel ? heightSel.closest(".field-row") : null;
    const widthRow = widthSel ? widthSel.closest(".field-row") : null;
    const dnRow = dnSel ? dnSel.closest(".field-row") : null;
    const typeRow = typeSel ? typeSel.closest(".field-row") : null;
    const heightInput = hk.querySelector('input[name*="HkHeight"]');
    const widthInput = hk.querySelector('input[name*="HkWidth"]');
    const dnInput = hk.querySelector('input[name*="HkDn"]');

    if(isRippen){
      if(typeRow){
        const label = typeRow.querySelector("label");
        if(label) label.innerHTML = "HK Typ<small>Guss, Stahl</small>";
      }
      if(heightRow){
        const label = heightRow.querySelector("label");
        if(label) label.innerHTML = "H\u00f6he [mm]<small>280, 430, 580, 680, 880, 980</small>";
      }
      if(widthRow){
        const label = widthRow.querySelector("label");
        if(label) label.innerHTML = "Tiefe [mm]<small>70, 110, 160, 220, 250</small>";
      }
      if(dnRow){
        const label = dnRow.querySelector("label");
        if(label) label.innerHTML = "Gliederzahl<small>1 bis 100</small>";
      }
      setSelectOptions(typeSel, "Typ w\u00e4hlen ...", ["Guss","Stahl"]);
      setSelectOptions(heightSel, "H\u00f6he w\u00e4hlen ...", ["280","430","580","680","880","980"]);
      setSelectOptions(widthSel, "Tiefe w\u00e4hlen ...", ["70","110","160","220","250"]);
      const glieder = Array.from({length: 100}, (_, i) => String(i + 1));
      setSelectOptions(dnSel, "Gliederzahl w\u00e4hlen ...", glieder);
      if(heightInput) { heightInput.placeholder = "andere H\u00f6he"; heightInput.value = ""; }
      if(widthInput) { widthInput.placeholder = "andere Tiefe"; widthInput.value = ""; }
      if(dnInput) { dnInput.placeholder = "andere Gliederzahl"; dnInput.value = ""; }
    } else {
      if(typeRow){
        const label = typeRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(heightRow){
        const label = heightRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(widthRow){
        const label = widthRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(dnRow){
        const label = dnRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      restoreSelect(typeSel);
      restoreSelect(heightSel);
      restoreSelect(widthSel);
      restoreSelect(dnSel);
      if(heightInput && heightInput.dataset.defaultPlaceholder) heightInput.placeholder = heightInput.dataset.defaultPlaceholder;
      if(widthInput && widthInput.dataset.defaultPlaceholder) widthInput.placeholder = widthInput.dataset.defaultPlaceholder;
      if(dnInput && dnInput.dataset.defaultPlaceholder) dnInput.placeholder = dnInput.dataset.defaultPlaceholder;
    }
  }

  function attachBauformListeners(container){
    const hkCards = container.classList && container.classList.contains("hk-card")
      ? [container]
      : Array.from(container.querySelectorAll(".hk-card"));
    hkCards.forEach(hk => {
      hk.querySelectorAll('input[type="radio"][name*="HkForm"]').forEach(radio => {
        if(radio.dataset.bound) return;
        radio.dataset.bound = "1";
        if(!radio.hasAttribute("value") || radio.value === "on"){
          const text = radio.parentElement ? radio.parentElement.textContent : "";
          radio.value = /Rippen/i.test(text) ? "Rippen" : "Platte";
        }
        radio.addEventListener("change", () => applyBauform(hk));
      });
      applyBauform(hk);
    });
  }

  document.querySelectorAll(".room-card").forEach(attachRoomListeners);
  attachBauformListeners(document);
  updateLabels();

  function setupDrawingInputs(container){
    const inputs = (container || document).querySelectorAll('input[type="text"][name$="Custom"]');
    inputs.forEach(input => {
      if(input.dataset.drawEnhanced) return;
      input.dataset.drawEnhanced = "1";
      const wrap = document.createElement("div");
      wrap.className = "draw-wrap";
      const canvas = document.createElement("canvas");
      canvas.className = "draw-canvas";
      wrap.append(canvas);

      const hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = input.name;
      hidden.dataset.drawing = "";
      input.insertAdjacentElement("afterend", wrap);
      input.replaceWith(hidden);

      const ctx = canvas.getContext("2d");
      function resizeCanvas(){
        const rect = canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;
        canvas.width = Math.max(1, Math.floor(rect.width * dpr));
        canvas.height = Math.max(1, Math.floor(rect.height * dpr));
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
        ctx.strokeStyle = "#0f172a";
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      let drawing = false;
      function posFromEvent(e){
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }
      function start(e){
        drawing = true;
        const p = posFromEvent(e);
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        e.preventDefault();
      }
      function move(e){
        if(!drawing) return;
        const p = posFromEvent(e);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        e.preventDefault();
      }
      function end(){
        if(!drawing) return;
        drawing = false;
        hidden.dataset.drawing = canvas.toDataURL("image/png");
      }
      canvas.addEventListener("pointerdown", start);
      canvas.addEventListener("pointermove", move);
      canvas.addEventListener("pointerup", end);
      canvas.addEventListener("pointerleave", end);
      canvas.addEventListener("touchstart", start, { passive: false });
      canvas.addEventListener("touchmove", move, { passive: false });
      canvas.addEventListener("touchend", end);

      // keine Loeschen-Aktion
    });
  }

  setupDrawingInputs(document);

  const surfaceHeatingRadios = document.querySelectorAll('input[name="surfaceHeating"]');
  const surfaceHeatingDetails = document.getElementById("surfaceHeatingDetails");
  function toggleSurfaceHeating(){
    if(!surfaceHeatingDetails) return;
    const checked = document.querySelector('input[name="surfaceHeating"]:checked');
    surfaceHeatingDetails.classList.toggle("hidden", !(checked && checked.value === "Ja"));
  }
  surfaceHeatingRadios.forEach(r => r.addEventListener("change", toggleSurfaceHeating));
  toggleSurfaceHeating();

  function addHeater(stack){
    const heaters = stack.querySelectorAll(".hk-card");
    if(!heaters.length) return;
    const template = heaters[heaters.length - 1];
    const clone = template.cloneNode(true);
    const nextIndex = heaters.length + 1;
    const title = clone.querySelector("h3");
    if(title) title.textContent = "Heizk\u00f6rper " + nextIndex;
    clone.querySelectorAll("select").forEach(sel => sel.selectedIndex = 0);
    clone.querySelectorAll("input").forEach(inp => inp.value = "");
    clone.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    clone.querySelectorAll(".draw-wrap").forEach(wrap => wrap.remove());
    clone.querySelectorAll('input[type="hidden"][name$="Custom"]').forEach(inp => {
      delete inp.dataset.drawing;
      delete inp.dataset.drawEnhanced;
    });
    clone.querySelectorAll("select,input").forEach(el => {
      const name = el.getAttribute("name");
      if(!name) return;
      const match = name.match(/^(room\d+Hk[A-Za-z]+?)(\d+)$/);
      if(match) el.setAttribute("name", match[1] + nextIndex);
    });
    stack.appendChild(clone);
    attachBauformListeners(clone);
    setupDrawingInputs(clone);
  }

  function enhanceStack(stack){
    if(!stack || stack.dataset.enhanced) return;
    stack.dataset.enhanced = "1";
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "add-hk-btn";
    btn.textContent = "+ Heizk\u00f6rper hinzuf\u00fcgen";
    btn.addEventListener("click", () => addHeater(stack));
    const parent = stack.parentNode;
    if(parent){
      parent.querySelectorAll(".add-hk-btn").forEach(x => x.remove());
      parent.appendChild(btn);
    }
  }

  document.querySelectorAll(".hk-stack").forEach(enhanceStack);

  function resetRoomCard(card, index){
    card.querySelectorAll(".add-hk-btn").forEach(btn => btn.remove());
    card.querySelectorAll(".hk-stack").forEach(stack => stack.removeAttribute("data-enhanced"));
    card.querySelectorAll("details").forEach(det => det.open = false);
    const label = card.querySelector("[data-room-label]");
    if(label){
      const small = label.querySelector("small");
      label.dataset.default = "Raum " + index;
      label.textContent = "";
      label.append(document.createTextNode("Raum " + index + " "));
      if(small) label.append(small);
    }
    card.querySelectorAll("input").forEach(inp => inp.value = "");
    card.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    card.querySelectorAll("select").forEach(sel => sel.selectedIndex = 0);
    card.querySelectorAll(".draw-wrap").forEach(wrap => wrap.remove());
    card.querySelectorAll('input[type="hidden"][name$="Custom"]').forEach(inp => {
      delete inp.dataset.drawing;
      delete inp.dataset.drawEnhanced;
    });
    card.querySelectorAll("h3").forEach((h3, i) => h3.textContent = "Heizk\u00f6rper " + (i + 1));
    card.querySelectorAll("[id]").forEach(el => {
      const id = el.id;
      if(id) el.id = id.replace(/room\d+/, "room" + index);
    });
    card.querySelectorAll("label[for]").forEach(lab => {
      if(lab.htmlFor) lab.htmlFor = lab.htmlFor.replace(/room\d+/, "room" + index);
    });
    card.querySelectorAll("[name]").forEach(el => {
      const name = el.getAttribute("name");
      if(name) el.setAttribute("name", name.replace(/room\d+/, "room" + index));
    });
  }

  const addRoomBtn = document.querySelector(".add-room-btn");
  const form = document.querySelector("form");
  const roomTemplate = document.querySelector(".room-card");
  if(addRoomBtn && form && roomTemplate){
    addRoomBtn.addEventListener("click", () => {
      const nextIndex = document.querySelectorAll(".room-card").length + 1;
      const clone = roomTemplate.cloneNode(true);
      resetRoomCard(clone, nextIndex);
      form.insertBefore(clone, addRoomBtn);
      attachRoomListeners(clone);
      clone.querySelectorAll(".hk-stack").forEach(enhanceStack);
      attachBauformListeners(clone);
      setupDrawingInputs(clone);
      updateLabels();
    });
  }

  function pickField(selectEl, customEl){
    const selectVal = selectEl && selectEl.value ? selectEl.value : "";
    if(selectVal) return { value: selectVal, draw: "" };
    const draw = customEl && customEl.dataset.drawing ? customEl.dataset.drawing : "";
    if(draw) return { value: "", draw };
    return { value: "", draw: "" };
  }

  function collectData(){
    const rooms = [];
    const surfaceHeating = document.querySelector('input[name="surfaceHeating"]:checked');
    const surfaceDetails = document.getElementById("surfaceHeatingDetails");
    const detailsOpen = surfaceDetails && !surfaceDetails.classList.contains("hidden");
    const system = {
      surfaceHeating: surfaceHeating ? surfaceHeating.value : (detailsOpen ? "Ja" : ""),
      distributorPhoto: !!document.querySelector('input[name="surfaceHeatingDistributorPhoto"]:checked'),
      distributorDn: (document.getElementById("distributorDn") || {}).value || "",
      layingSpacing: (document.getElementById("layingSpacing") || {}).value || ""
    };
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      const roomSel = card.querySelector('select[name$="Name"]');
      const floorSel = card.querySelector('select[name$="Floor"]');
      const roomName = roomSel ? roomSel.value.trim() : "";
      const floor = floorSel ? floorSel.value.trim() : "";
      const heaters = [];
      card.querySelectorAll(".hk-card").forEach(hk => {
        const formChecked = hk.querySelector('input[type="radio"][name*="HkForm"]:checked');
        const formText = formChecked && formChecked.parentElement ? formChecked.parentElement.textContent : "";
        const bauform = /Rippen/i.test(formText) ? "Rippen" : (/Platte/i.test(formText) ? "Platte" : "");
        const typeSel = hk.querySelector('select[name*="HkType"]');
        const typeCustom = hk.querySelector('input[name*="HkType"]');
        const heightSel = hk.querySelector('select[name*="HkHeight"]');
        const heightCustom = hk.querySelector('input[name*="HkHeight"]');
        const widthSel = hk.querySelector('select[name*="HkWidth"]');
        const widthCustom = hk.querySelector('input[name*="HkWidth"]');
        const dnSel = hk.querySelector('select[name*="HkDn"]');
        const dnCustom = hk.querySelector('input[name*="HkDn"]');
        const typeField = pickField(typeSel, typeCustom);
        const heightField = pickField(heightSel, heightCustom);
        const widthField = pickField(widthSel, widthCustom);
        const dnField = pickField(dnSel, dnCustom);
        const entry = {
          bauform,
          type: typeField.value,
          typeDraw: typeField.draw,
          height: heightField.value,
          heightDraw: heightField.draw,
          width: widthField.value,
          widthDraw: widthField.draw,
          dn: dnField.value,
          dnDraw: dnField.draw
        };
        const hasData = !!(entry.type || entry.typeDraw || entry.height || entry.heightDraw || entry.width || entry.widthDraw || entry.dn || entry.dnDraw);
        if(hasData) heaters.push(entry);
      });
      if(roomName || floor || heaters.length){
        rooms.push({ index: idx + 1, roomName, floor, heaters });
      }
    });
    return { system, rooms, detailsOpen };
  }

  function renderCell(value, draw){
    if(draw) return '<img class="draw-img" src="' + draw + '" alt="Zeichnung">';
    return value || "-";
  }

  function renderPrint(data){
    const now = new Date().toLocaleString();
    const container = document.getElementById("printView");
    if(!container) return;
    const surfaceHeating = document.querySelector('input[name="surfaceHeating"]:checked');
    const surfaceDetails = document.getElementById("surfaceHeatingDetails");
    const detailsOpen = surfaceDetails && !surfaceDetails.classList.contains("hidden");
    const distributorPhotoChecked = !!document.querySelector('input[name="surfaceHeatingDistributorPhoto"]:checked');
    const distributorDnValue = ((document.getElementById("distributorDn") || {}).value || "").trim();
    const layingSpacingValue = ((document.getElementById("layingSpacing") || {}).value || "").trim();
    const system = {
      surfaceHeating: surfaceHeating ? surfaceHeating.value : (detailsOpen ? "Ja" : ""),
      distributorPhoto: distributorPhotoChecked,
      distributorDn: distributorDnValue,
      layingSpacing: layingSpacingValue,
      fbhLineDiameter: ((document.getElementById("fBHLineDiameter") || {}).value || "").trim()
    };
    const hasSystem = !!(system.surfaceHeating || system.distributorPhoto || system.distributorDn || system.layingSpacing || system.fbhLineDiameter || detailsOpen);
    const sections = [];
    if(hasSystem){
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Anlagentechnik</div><div class="room-sub">Fl\u00e4chenheizung vorhanden: ' + (system.surfaceHeating || "-") + '</div></div>',
        '<div class="badge">System</div>',
        '</div>',
        '<table class="hk-table">',
        '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
        '<tbody>',
        '<tr><td>Foto vom Verteiler</td><td>' + (system.distributorPhoto ? "Ja" : "Nein") + '</td></tr>',
        '<tr><td>Verteiler DN</td><td>' + (system.distributorDn || "-") + '</td></tr>',
        '<tr><td>Verlegeabstand</td><td>' + (system.layingSpacing || "-") + '</td></tr>',
        '<tr><td>Durchmesser Leitung FBH</td><td>' + (system.fbhLineDiameter || "-") + '</td></tr>',
        '</tbody></table></section>'
      ].join(""));
    }
    data.rooms.forEach(room => {
      const plate = [];
      const rippen = [];
      room.heaters.forEach(hk => {
        if((hk.bauform || "").toLowerCase() === "rippen") rippen.push(hk);
        else plate.push(hk);
      });
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">' + (room.roomName || "Raum " + room.index) + '</div><div class="room-sub">Geschoss: ' + (room.floor || "-") + '</div></div>',
        '<div class="badge">Raum ' + room.index + '</div>',
        '</div>',
        (plate.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>#</th><th>Bauform</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Breite [mm]</th><th>DN</th></tr></thead>',
          '<tbody>',
          plate.map((hk, i) => (
            '<tr>' +
            '<td>' + (i + 1) + '</td>' +
            '<td>' + (hk.bauform || "Platte") + '</td>' +
            '<td>' + renderCell(hk.type, hk.typeDraw) + '</td>' +
            '<td>' + renderCell(hk.height, hk.heightDraw) + '</td>' +
            '<td>' + renderCell(hk.width, hk.widthDraw) + '</td>' +
            '<td>' + renderCell(hk.dn, hk.dnDraw) + '</td>' +
            '</tr>'
          )).join(""),
          '</tbody></table>'
        ].join("") : ""),
        (rippen.length ? [
          '<table class="hk-table" style="margin-top:10px;">',
          '<thead><tr><th>#</th><th>Bauform</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Tiefe [mm]</th><th>Gliederzahl</th></tr></thead>',
          '<tbody>',
          rippen.map((hk, i) => (
            '<tr>' +
            '<td>' + (i + 1) + '</td>' +
            '<td>' + (hk.bauform || "Rippen") + '</td>' +
            '<td>' + renderCell(hk.type, hk.typeDraw) + '</td>' +
            '<td>' + renderCell(hk.height, hk.heightDraw) + '</td>' +
            '<td>' + renderCell(hk.width, hk.widthDraw) + '</td>' +
            '<td>' + renderCell(hk.dn, hk.dnDraw) + '</td>' +
            '</tr>'
          )).join(""),
          '</tbody></table>'
        ].join("") : ""),
        (!plate.length && !rippen.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>#</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Breite [mm]</th><th>DN</th></tr></thead>',
          '<tbody><tr><td>1</td><td>-</td><td>-</td><td>-</td><td>-</td></tr></tbody></table>'
        ].join("") : ""),
        '</section>'
      ].join(""));
    });
    container.innerHTML = [
      '<div class="doc-head"><h1>Aufnahme HK Daten</h1><div class="meta">Erstellt: ' + now + '</div></div>',
      sections.join("")
    ].join("");
    document.body.classList.add("show-print");
    // Force reflow before printing (iOS WebView)
    void container.offsetHeight;
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        setTimeout(() => window.print(), 300);
      });
    });
  }

  function downloadFile(data){
    const now = new Date().toLocaleString();
    const markup = buildReportMarkup(data, now);
    const html = [
      '<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>HK-Erfassung</title>',
      '<style>',
      'body { font-family: "Segoe UI", Arial, sans-serif; margin: 24px; color: #0f172a; }',
      '.doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; }',
      'h1 { margin: 0; font-size: 22px; }',
      '.meta { color: #6b7280; font-size: 13px; }',
      '.room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin-bottom: 14px; background: #fff; }',
      '.room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }',
      '.room-title { font-size: 18px; font-weight: 700; }',
      '.room-sub { color: #6b7280; font-size: 14px; }',
      '.badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }',
      'table { width: 100%; border-collapse: collapse; }',
      'th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }',
      'th { background: #f8fafc; font-weight: 700; }',
      'td { background: #fff; }',
      '</style></head><body>',
      markup,
      '</body></html>'
    ].join("");
    const blob = new Blob([html], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "hk-daten.html";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 15000);
  }

  const exportBtn = document.querySelector(".export-btn");
  const resetBtn = document.querySelector(".reset-btn");
  window.addEventListener("afterprint", () => {
    document.body.classList.remove("show-print");
  });
  if(exportBtn){
    exportBtn.addEventListener("click", () => {
      const data = collectData();
      if(!data.rooms.length && !data.system.surfaceHeating && !data.system.distributorPhoto && !data.system.distributorDn && !data.system.layingSpacing && !data.system.fbhLineDiameter){
        alert("Keine Daten erfasst.");
        return;
      }
      renderPrint(data);
    });
  }
  if(resetBtn){
    resetBtn.addEventListener("click", () => {
      if(confirm("Alle Eingaben zuruecksetzen?")){
        location.reload();
      }
    });
  }
})();
</script>
</body>
</html>
