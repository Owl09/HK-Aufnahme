<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Aufnahme HK Daten</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="manifest.webmanifest">
    <style>
        :root { font-family: "Segoe UI", Arial, sans-serif; -webkit-text-size-adjust: 100%; }
        *, *::before, *::after { box-sizing: border-box; }
        body { margin: 0; padding: calc(24px + env(safe-area-inset-top)) 16px calc(36px + env(safe-area-inset-bottom)); background: #f4f5f7; color: #1f2933; overflow-x: hidden; }
        .card { width: 100%; max-width: 100%; background: #fff; border-radius: 16px; padding: 28px; box-shadow: 0 18px 40px rgba(15,23,42,0.12); border: 1px solid #e5e7eb; }
        h1 { margin: 0 0 6px; }
        p { margin: 0 0 20px; color: #4b5563; }
        form { display: flex; flex-direction: column; gap: 18px; }
        .room-card { border: 1px solid #d1d5db; border-radius: 14px; background: #fcfdff; }
        .system-card { border: 1px solid #d1d5db; border-radius: 14px; background: #fcfdff; }
        .system-card.section-red { background: #ffe4e6; border-color: #fda4af; }
        .system-card.section-orange { background: #ffedd5; border-color: #fdba74; }
        .system-card.section-yellow { background: #fef3c7; border-color: #facc15; }
        .system-card.section-purple { background: #ede9fe; border-color: #c4b5fd; }
        .system-card.section-green { background: #dcfce7; border-color: #86efac; }
        .system-card.section-blue { background: #dbeafe; border-color: #93c5fd; }
        .system-card.section-gray { background: #e5e7eb; border-color: #cbd5f5; }
        .system-row { display: flex; flex-direction: column; gap: 10px; }
        textarea { width: 100%; min-height: 72px; padding: 10px 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 16px; background: #fff; resize: vertical; }
        .hidden { display: none; }
        details { border-radius: 14px; }
        summary { list-style: none; cursor: pointer; padding: 18px 20px; display: flex; justify-content: space-between; align-items: center; color: #111827; font-weight: 600; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: "+"; font-size: 20px; transition: transform 0.2s; }
        details[open] summary::after { transform: rotate(45deg); }
        summary span { display: flex; flex-direction: column; }
        summary small { font-weight: normal; color: #6b7280; }
        .section-body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 16px; }
        .room-body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 18px; }
        .field-row { display: grid; grid-template-columns: 170px 1fr 1fr; gap: 12px; align-items: center; }
        .field-row.single { grid-template-columns: 170px 1fr; }
        .field-row.dual { grid-template-columns: 170px 1fr 170px 1fr; column-gap: 12px; }
        .field-row.annex-row { grid-template-columns: 150px 1fr 120px 1fr 110px 1fr; column-gap: 8px; }
        .field-row.ogd-row { grid-template-columns: 170px 0.8fr 1fr; }
        .field-row.dual.type-row { grid-template-columns: 170px 1fr 170px 1fr; }
        .field-row.pump { grid-template-columns: 170px 1fr 70px 1fr; column-gap: 8px; }
        .label-shift-right { margin-left: 10px; }
        .field-spacer { display: block; }
        label { font-weight: 600; color: #1f2933; }
        select, input[type="text"] { width: 100%; padding: 10px 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 16px; background: #fff; }
        .inline-options { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
        .inline-options label { display: flex; align-items: center; gap: 6px; font-weight: 600; }
        .inline-options input { width: auto; }
        .inline-right { margin-left: auto; display: inline-flex; gap: 16px; align-items: center; }
        .check-grid { display: grid; grid-template-columns: repeat(2, minmax(160px, 1fr)); gap: 8px 16px; }
        .roof-type-grid { grid-template-columns: repeat(4, minmax(140px, 1fr)); }
        .matrix-table { width: 100%; border-collapse: collapse; }
        .roof-table th, .roof-table td { width: 25%; }
        .gaube-table { table-layout: fixed; }
        .gaube-table th:first-child, .gaube-table td:first-child { width: 12%; }
        .gaube-table th:not(:first-child), .gaube-table td:not(:first-child) { width: 22%; }
        .matrix-table th, .matrix-table td { border: 1px solid #94a3b8; padding: 8px; vertical-align: top; text-align: left; }
        .matrix-table th { background: #f8fafc; font-weight: 700; }
        .matrix-table .col-wide { width: 40%; }
        .matrix-table .col-narrow { width: 12%; }
        .draw-wrap { margin-top: 6px; display: flex; flex-direction: column; gap: 6px; }
        .draw-canvas { width: 100%; height: 44px; border: 1px dashed #cbd5e1; border-radius: 6px; background: #fff; touch-action: none; }
        .draw-canvas.large { height: 842px; }
        .draw-wrap { margin-top: 0; }
        .draw-actions { justify-content: flex-end; }
        .draw-actions { display: none; }
        .draw-action { display: none; }
        .draw-toggle { display: none; }
        .draw-toggle.active { display: none; }
        small { display: none; margin-top: 4px; color: #64748b; font-weight: normal; }
        .hk-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px; background: #fff; display: flex; flex-direction: column; gap: 12px; }
        .hk-card h3 { margin: 0; font-size: 16px; color: #0f172a; }
        .hk-toggle { border: none; margin: 0; }
        .hk-toggle summary { padding: 12px 16px; border: 1px dashed #94a3b8; border-radius: 10px; font-weight: 600; font-size: 15px; color: #1d4ed8; background: #f8fafc; }
        .hk-toggle summary::after { content: "+"; font-size: 16px; }
        .hk-toggle[open] summary::after { content: "-"; }
        .hk-toggle .hk-card { margin-top: 10px; }
        .add-hk-btn, .add-room-btn, .add-window-btn, .export-btn, .reset-btn, .eraser-btn, .share-btn { margin: 10px 0 0; padding: 10px 14px; border-radius: 10px; border: 1px dashed #9ca3af; background: #f9fafb; color: #111827; font-weight: 600; cursor: pointer; width: 100%; text-align: center; }
        .add-hk-btn:active, .add-room-btn:active, .add-window-btn:active, .export-btn:active, .reset-btn:active, .eraser-btn:active, .share-btn:active { transform: translateY(1px); }
        .add-room-btn { margin-top: 16px; }
        .export-btn { border-color: #2563eb; color: #1d4ed8; background: #eef2ff; }
        .eraser-btn { border-color: #f59e0b; color: #92400e; background: #fef3c7; }
        .eraser-btn.active { background: #fee2e2; border-color: #fecaca; color: #991b1b; }
        .share-btn { border-color: #16a34a; color: #14532d; background: #dcfce7; }
        .share-btn.active { background: #bbf7d0; border-color: #86efac; }
        .reset-btn { border-color: #ef4444; color: #991b1b; background: #fef2f2; }
        .floating-eraser {
          position: fixed;
          top: calc(12px + env(safe-area-inset-top));
          left: 12px;
          z-index: 1000;
          width: 44px;
          height: 44px;
          min-width: 44px;
          padding: 0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 700;
        }
        .print-view { display: block; visibility: hidden; height: 0; overflow: hidden; }
        .print-view { font-family: "Segoe UI", Arial, sans-serif; color: #0f172a; padding: 18px; }
        .print-view .doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 14px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }
        .print-view h1 { margin: 0; font-size: 22px; }
        .print-view .meta { color: #6b7280; font-size: 13px; }
        .print-view .room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin: 0 0 14px; background: #fff; }
        .print-view .room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .print-view .room-title { font-size: 18px; font-weight: 700; }
        .print-view .room-sub { color: #6b7280; font-size: 14px; }
        .print-view .badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }
        .print-view table { width: 100%; border-collapse: collapse; }
        .print-view th, .print-view td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }
        .print-view th { background: #f8fafc; font-weight: 700; }
        .print-view .draw-img { display: block; max-height: 60px; max-width: 140px; }
        .print-view .window-table th, .print-view .window-table td { padding: 4px 6px; }
        .print-view .window-table .draw-img { max-height: 36px; max-width: 120px; }
        body.show-print .card { display: none; }
        body.show-print .print-view { visibility: visible; height: auto; overflow: visible; }
        @media print {
          body { background: #fff; }
          .card, .add-room-btn, .export-btn, .add-hk-btn { display: none !important; }
          .print-view { visibility: visible !important; height: auto !important; overflow: visible !important; }
          .print-view .room { break-inside: avoid; page-break-inside: avoid; }
        }
        @media (max-width: 720px) { .field-row, .field-row.single { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<main class="card">
    <header>
        <h1>Aufnahme HK Daten</h1>
    </header>
    <form>
        <details class="system-card" open>
            <summary><span>Anschrift</span></summary>
            <div class="section-body">
                <div class="field-row single">
                    <label for="addressNameDraw">Name</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressNameDraw" name="addressNameDraw">
                        <canvas class="draw-canvas" data-draw-target="addressNameDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressStreetDraw">Stra&szlig;e, Nr.</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressStreetDraw" name="addressStreetDraw">
                        <canvas class="draw-canvas" data-draw-target="addressStreetDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressCityDraw">PLZ/Ort</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressCityDraw" name="addressCityDraw">
                        <canvas class="draw-canvas" data-draw-target="addressCityDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressPhoneDraw">Telefon</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressPhoneDraw" name="addressPhoneDraw">
                        <canvas class="draw-canvas" data-draw-target="addressPhoneDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressEmailDraw">Email</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressEmailDraw" name="addressEmailDraw">
                        <canvas class="draw-canvas" data-draw-target="addressEmailDraw"></canvas>
                    </div>
                </div>
                <div class="system-row">
                    <label>Geb&auml;udedaten wie oben?</label>
                    <div class="inline-options">
                        <label><input type="radio" name="buildingData" value="Ja">Ja</label>
                        <label><input type="radio" name="buildingData" value="Nein">Nein</label>
                    </div>
                </div>
                <div class="system-row hidden" id="buildingDataDetails">
                    <div class="field-row single">
                        <label for="buildingStreetDraw">Stra&szlig;e, Nr.</label>
                        <div class="draw-wrap">
                            <input type="hidden" id="buildingStreetDraw" name="buildingStreetDraw">
                            <canvas class="draw-canvas" data-draw-target="buildingStreetDraw"></canvas>
                        </div>
                    </div>
                    <div class="field-row single">
                        <label for="buildingCityDraw">PLZ/Ort</label>
                        <div class="draw-wrap">
                            <input type="hidden" id="buildingCityDraw" name="buildingCityDraw">
                            <canvas class="draw-canvas" data-draw-target="buildingCityDraw"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card section-red" open>
            <summary><span>Geb&auml;udetyp</span></summary>
            <div class="section-body">
                <div class="field-row dual">
                    <label for="buildingYearDraw">Baujahr</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="buildingYearDraw" name="buildingYearDraw">
                        <canvas class="draw-canvas" data-draw-target="buildingYearDraw"></canvas>
                    </div>
                    <label for="buildingUnits">Wohneinheiten</label>
                    <select id="buildingUnits" name="buildingUnits">
                        <option value="" selected disabled>Anzahl w&auml;hlen &hellip;</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                        <option>32</option>
                        <option>33</option>
                        <option>34</option>
                        <option>35</option>
                        <option>36</option>
                        <option>37</option>
                        <option>38</option>
                        <option>39</option>
                        <option>40</option>
                        <option>41</option>
                        <option>42</option>
                        <option>43</option>
                        <option>44</option>
                        <option>45</option>
                        <option>46</option>
                        <option>47</option>
                        <option>48</option>
                        <option>49</option>
                        <option>50</option>
                    </select>
                </div>
                <div class="field-row single">
                    <label>Geb&auml;udetyp</label>
                    <div class="check-grid">
                        <label><input type="checkbox" name="buildingTypeDetached">Freistehend</label>
                        <label><input type="checkbox" name="buildingTypeMultiFamily">Mehrfamilienhaus</label>
                        <label><input type="checkbox" name="buildingTypeEndTerrace">Reihenendhaus</label>
                        <label><input type="checkbox" name="buildingTypeMidTerrace">Reihenmittelhaus</label>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card section-red" open>
            <summary><span>Geschossh&ouml;he, Kellerdecke/Bodenplatte, Au&szlig;enw&auml;nde</span></summary>
            <div class="section-body">
                <div class="field-row dual">
                    <label for="floorHeightBasementDraw">Keller</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeightBasementDraw" name="floorHeightBasementDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeightBasementDraw"></canvas>
                    </div>
                    <label for="floorHeightGroundDraw">Erdgeschoss</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeightGroundDraw" name="floorHeightGroundDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeightGroundDraw"></canvas>
                    </div>
                </div>
                <div class="field-row dual">
                    <label for="floorHeight1OgDraw">1.OG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeight1OgDraw" name="floorHeight1OgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeight1OgDraw"></canvas>
                    </div>
                    <label for="floorHeight2OgDraw">2.OG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeight2OgDraw" name="floorHeight2OgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeight2OgDraw"></canvas>
                    </div>
                </div>
                <div class="field-row dual">
                    <label for="floorHeight3OgDraw">3.OG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeight3OgDraw" name="floorHeight3OgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeight3OgDraw"></canvas>
                    </div>
                    <label for="floorHeightDgDraw">DG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeightDgDraw" name="floorHeightDgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeightDgDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label>Art/Aufbau/Material</label>
                    <div class="inline-options">
                        <label><input type="checkbox" name="structureMassive">Massiv</label>
                        <label><input type="checkbox" name="structureWooden">Holzbalken</label>
                        <div class="inline-right">
                            <label>Keller beheizt</label>
                            <label><input type="radio" name="basementHeated" value="Ja">Ja</label>
                            <label><input type="radio" name="basementHeated" value="Nein">Nein</label>
                        </div>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="notesDraw">Notizen</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="notesDraw" name="notesDraw">
                        <canvas class="draw-canvas" data-draw-target="notesDraw"></canvas>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card section-orange" open>
            <summary><span>Au&szlig;enw&auml;nde</span></summary>
            <div class="section-body">
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Aufbau</th>
                            <th>Schicht 1</th>
                            <th>Schicht 2</th>
                            <th>Schicht 3</th>
                            <th>Schicht 4</th>
                            <th>Schicht 5</th>
                            <th>Gesamtdicke</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Nord</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL1Draw" name="wallNorthL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL2Draw" name="wallNorthL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL3Draw" name="wallNorthL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL4Draw" name="wallNorthL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL5Draw" name="wallNorthL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthTotalDraw" name="wallNorthTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Ost</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL1Draw" name="wallEastL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL2Draw" name="wallEastL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL3Draw" name="wallEastL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL4Draw" name="wallEastL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL5Draw" name="wallEastL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastTotalDraw" name="wallEastTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>S&uuml;d</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL1Draw" name="wallSouthL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL2Draw" name="wallSouthL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL3Draw" name="wallSouthL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL4Draw" name="wallSouthL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL5Draw" name="wallSouthL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthTotalDraw" name="wallSouthTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>West</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL1Draw" name="wallWestL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL2Draw" name="wallWestL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL3Draw" name="wallWestL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL4Draw" name="wallWestL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL5Draw" name="wallWestL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestTotalDraw" name="wallWestTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="field-row single">
                    <label for="wallNotesDraw">Notizen</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="wallNotesDraw" name="wallNotesDraw">
                        <canvas class="draw-canvas" data-draw-target="wallNotesDraw"></canvas>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card section-yellow" open>
            <summary><span>Fenster</span></summary>
            <div class="section-body">
                <table class="matrix-table window-table">
                    <thead>
                        <tr>
                            <th>HR</th>
                            <th class="col-narrow">Raum</th>
                            <th>VG</th>
                            <th>Stoff</th>
                            <th class="col-wide">Ma&szlig;e</th>
                            <th class="col-narrow">Bj.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="window-row" data-window-index="1">
                            <td>
                                <select id="windowHr1" name="windowHr1" data-window-field="windowHr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td class="col-narrow">
                                <div class="draw-wrap">
                                    <input type="hidden" id="windowRoomDraw1" name="windowRoomDraw1" data-window-field="windowRoomDraw">
                                    <canvas class="draw-canvas" data-draw-target="windowRoomDraw1"></canvas>
                                </div>
                            </td>
                            <td>
                                <select id="windowVg1" name="windowVg1" data-window-field="windowVg">
                                    <option value="" selected disabled>VG</option>
                                    <option>EV</option>
                                    <option>DV</option>
                                    <option>3F</option>
                                </select>
                            </td>
                            <td>
                                <select id="windowMaterial1" name="windowMaterial1" data-window-field="windowMaterial">
                                    <option value="" selected disabled>Stoff</option>
                                    <option>KU</option>
                                    <option>HO</option>
                                    <option>ME</option>
                                </select>
                            </td>
                            <td class="col-wide">
                                <div class="draw-wrap">
                                    <input type="hidden" id="windowSizeDraw1" name="windowSizeDraw1" data-window-field="windowSizeDraw">
                                    <canvas class="draw-canvas" data-draw-target="windowSizeDraw1"></canvas>
                                </div>
                            </td>
                            <td class="col-narrow">
                                <div class="draw-wrap">
                                    <input type="hidden" id="windowYearDraw1" name="windowYearDraw1" data-window-field="windowYearDraw">
                                    <canvas class="draw-canvas" data-draw-target="windowYearDraw1"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="add-window-btn">+ Fenster hinzuf&uuml;gen</button>
            </div>
        </details>
        <details class="system-card section-purple" open>
            <summary><span>Dachgaube</span></summary>
            <div class="section-body">
                <table class="matrix-table gaube-table">
                    <colgroup>
                        <col style="width:12%;">
                        <col style="width:22%;">
                        <col style="width:22%;">
                        <col style="width:22%;">
                        <col style="width:22%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Gaube1</th>
                            <th>Gaube2</th>
                            <th>Gaube3</th>
                            <th>Gaube4</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>HR</td>
                            <td>
                                <select id="gaube1Hr" name="gaube1Hr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaube2Hr" name="gaube2Hr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaube3Hr" name="gaube3Hr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaube4Hr" name="gaube4Hr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Breite</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube1WidthDraw" name="gaube1WidthDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube1WidthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube2WidthDraw" name="gaube2WidthDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube2WidthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube3WidthDraw" name="gaube3WidthDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube3WidthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube4WidthDraw" name="gaube4WidthDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube4WidthDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>H&ouml;he</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube1HeightDraw" name="gaube1HeightDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube1HeightDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube2HeightDraw" name="gaube2HeightDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube2HeightDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube3HeightDraw" name="gaube3HeightDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube3HeightDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaube4HeightDraw" name="gaube4HeightDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaube4HeightDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Winkel</td>
                            <td>
                                <select id="gaube1Angle" name="gaube1Angle">
                                    <option value="" selected disabled>Winkel</option>
                                    <option>0&deg;</option>
                                    <option>1&deg;</option>
                                    <option>2&deg;</option>
                                    <option>3&deg;</option>
                                    <option>4&deg;</option>
                                    <option>5&deg;</option>
                                    <option>6&deg;</option>
                                    <option>7&deg;</option>
                                    <option>8&deg;</option>
                                    <option>9&deg;</option>
                                    <option>10&deg;</option>
                                    <option>11&deg;</option>
                                    <option>12&deg;</option>
                                    <option>13&deg;</option>
                                    <option>14&deg;</option>
                                    <option>15&deg;</option>
                                    <option>16&deg;</option>
                                    <option>17&deg;</option>
                                    <option>18&deg;</option>
                                    <option>19&deg;</option>
                                    <option>20&deg;</option>
                                    <option>21&deg;</option>
                                    <option>22&deg;</option>
                                    <option>23&deg;</option>
                                    <option>24&deg;</option>
                                    <option>25&deg;</option>
                                    <option>26&deg;</option>
                                    <option>27&deg;</option>
                                    <option>28&deg;</option>
                                    <option>29&deg;</option>
                                    <option>30&deg;</option>
                                    <option>31&deg;</option>
                                    <option>32&deg;</option>
                                    <option>33&deg;</option>
                                    <option>34&deg;</option>
                                    <option>35&deg;</option>
                                    <option>36&deg;</option>
                                    <option>37&deg;</option>
                                    <option>38&deg;</option>
                                    <option>39&deg;</option>
                                    <option>40&deg;</option>
                                    <option>41&deg;</option>
                                    <option>42&deg;</option>
                                    <option>43&deg;</option>
                                    <option>44&deg;</option>
                                    <option>45&deg;</option>
                                    <option>46&deg;</option>
                                    <option>47&deg;</option>
                                    <option>48&deg;</option>
                                    <option>49&deg;</option>
                                    <option>50&deg;</option>
                                    <option>51&deg;</option>
                                    <option>52&deg;</option>
                                    <option>53&deg;</option>
                                    <option>54&deg;</option>
                                    <option>55&deg;</option>
                                    <option>56&deg;</option>
                                    <option>57&deg;</option>
                                    <option>58&deg;</option>
                                    <option>59&deg;</option>
                                    <option>60&deg;</option>
                                    <option>61&deg;</option>
                                    <option>62&deg;</option>
                                    <option>63&deg;</option>
                                    <option>64&deg;</option>
                                    <option>65&deg;</option>
                                    <option>66&deg;</option>
                                    <option>67&deg;</option>
                                    <option>68&deg;</option>
                                    <option>69&deg;</option>
                                    <option>70&deg;</option>
                                    <option>71&deg;</option>
                                    <option>72&deg;</option>
                                    <option>73&deg;</option>
                                    <option>74&deg;</option>
                                    <option>75&deg;</option>
                                    <option>76&deg;</option>
                                    <option>77&deg;</option>
                                    <option>78&deg;</option>
                                    <option>79&deg;</option>
                                    <option>80&deg;</option>
                                    <option>81&deg;</option>
                                    <option>82&deg;</option>
                                    <option>83&deg;</option>
                                    <option>84&deg;</option>
                                    <option>85&deg;</option>
                                    <option>86&deg;</option>
                                    <option>87&deg;</option>
                                    <option>88&deg;</option>
                                    <option>89&deg;</option>
                                    <option>90&deg;</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaube2Angle" name="gaube2Angle">
                                    <option value="" selected disabled>Winkel</option>
                                    <option>0&deg;</option>
                                    <option>1&deg;</option>
                                    <option>2&deg;</option>
                                    <option>3&deg;</option>
                                    <option>4&deg;</option>
                                    <option>5&deg;</option>
                                    <option>6&deg;</option>
                                    <option>7&deg;</option>
                                    <option>8&deg;</option>
                                    <option>9&deg;</option>
                                    <option>10&deg;</option>
                                    <option>11&deg;</option>
                                    <option>12&deg;</option>
                                    <option>13&deg;</option>
                                    <option>14&deg;</option>
                                    <option>15&deg;</option>
                                    <option>16&deg;</option>
                                    <option>17&deg;</option>
                                    <option>18&deg;</option>
                                    <option>19&deg;</option>
                                    <option>20&deg;</option>
                                    <option>21&deg;</option>
                                    <option>22&deg;</option>
                                    <option>23&deg;</option>
                                    <option>24&deg;</option>
                                    <option>25&deg;</option>
                                    <option>26&deg;</option>
                                    <option>27&deg;</option>
                                    <option>28&deg;</option>
                                    <option>29&deg;</option>
                                    <option>30&deg;</option>
                                    <option>31&deg;</option>
                                    <option>32&deg;</option>
                                    <option>33&deg;</option>
                                    <option>34&deg;</option>
                                    <option>35&deg;</option>
                                    <option>36&deg;</option>
                                    <option>37&deg;</option>
                                    <option>38&deg;</option>
                                    <option>39&deg;</option>
                                    <option>40&deg;</option>
                                    <option>41&deg;</option>
                                    <option>42&deg;</option>
                                    <option>43&deg;</option>
                                    <option>44&deg;</option>
                                    <option>45&deg;</option>
                                    <option>46&deg;</option>
                                    <option>47&deg;</option>
                                    <option>48&deg;</option>
                                    <option>49&deg;</option>
                                    <option>50&deg;</option>
                                    <option>51&deg;</option>
                                    <option>52&deg;</option>
                                    <option>53&deg;</option>
                                    <option>54&deg;</option>
                                    <option>55&deg;</option>
                                    <option>56&deg;</option>
                                    <option>57&deg;</option>
                                    <option>58&deg;</option>
                                    <option>59&deg;</option>
                                    <option>60&deg;</option>
                                    <option>61&deg;</option>
                                    <option>62&deg;</option>
                                    <option>63&deg;</option>
                                    <option>64&deg;</option>
                                    <option>65&deg;</option>
                                    <option>66&deg;</option>
                                    <option>67&deg;</option>
                                    <option>68&deg;</option>
                                    <option>69&deg;</option>
                                    <option>70&deg;</option>
                                    <option>71&deg;</option>
                                    <option>72&deg;</option>
                                    <option>73&deg;</option>
                                    <option>74&deg;</option>
                                    <option>75&deg;</option>
                                    <option>76&deg;</option>
                                    <option>77&deg;</option>
                                    <option>78&deg;</option>
                                    <option>79&deg;</option>
                                    <option>80&deg;</option>
                                    <option>81&deg;</option>
                                    <option>82&deg;</option>
                                    <option>83&deg;</option>
                                    <option>84&deg;</option>
                                    <option>85&deg;</option>
                                    <option>86&deg;</option>
                                    <option>87&deg;</option>
                                    <option>88&deg;</option>
                                    <option>89&deg;</option>
                                    <option>90&deg;</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaube3Angle" name="gaube3Angle">
                                    <option value="" selected disabled>Winkel</option>
                                    <option>0&deg;</option>
                                    <option>1&deg;</option>
                                    <option>2&deg;</option>
                                    <option>3&deg;</option>
                                    <option>4&deg;</option>
                                    <option>5&deg;</option>
                                    <option>6&deg;</option>
                                    <option>7&deg;</option>
                                    <option>8&deg;</option>
                                    <option>9&deg;</option>
                                    <option>10&deg;</option>
                                    <option>11&deg;</option>
                                    <option>12&deg;</option>
                                    <option>13&deg;</option>
                                    <option>14&deg;</option>
                                    <option>15&deg;</option>
                                    <option>16&deg;</option>
                                    <option>17&deg;</option>
                                    <option>18&deg;</option>
                                    <option>19&deg;</option>
                                    <option>20&deg;</option>
                                    <option>21&deg;</option>
                                    <option>22&deg;</option>
                                    <option>23&deg;</option>
                                    <option>24&deg;</option>
                                    <option>25&deg;</option>
                                    <option>26&deg;</option>
                                    <option>27&deg;</option>
                                    <option>28&deg;</option>
                                    <option>29&deg;</option>
                                    <option>30&deg;</option>
                                    <option>31&deg;</option>
                                    <option>32&deg;</option>
                                    <option>33&deg;</option>
                                    <option>34&deg;</option>
                                    <option>35&deg;</option>
                                    <option>36&deg;</option>
                                    <option>37&deg;</option>
                                    <option>38&deg;</option>
                                    <option>39&deg;</option>
                                    <option>40&deg;</option>
                                    <option>41&deg;</option>
                                    <option>42&deg;</option>
                                    <option>43&deg;</option>
                                    <option>44&deg;</option>
                                    <option>45&deg;</option>
                                    <option>46&deg;</option>
                                    <option>47&deg;</option>
                                    <option>48&deg;</option>
                                    <option>49&deg;</option>
                                    <option>50&deg;</option>
                                    <option>51&deg;</option>
                                    <option>52&deg;</option>
                                    <option>53&deg;</option>
                                    <option>54&deg;</option>
                                    <option>55&deg;</option>
                                    <option>56&deg;</option>
                                    <option>57&deg;</option>
                                    <option>58&deg;</option>
                                    <option>59&deg;</option>
                                    <option>60&deg;</option>
                                    <option>61&deg;</option>
                                    <option>62&deg;</option>
                                    <option>63&deg;</option>
                                    <option>64&deg;</option>
                                    <option>65&deg;</option>
                                    <option>66&deg;</option>
                                    <option>67&deg;</option>
                                    <option>68&deg;</option>
                                    <option>69&deg;</option>
                                    <option>70&deg;</option>
                                    <option>71&deg;</option>
                                    <option>72&deg;</option>
                                    <option>73&deg;</option>
                                    <option>74&deg;</option>
                                    <option>75&deg;</option>
                                    <option>76&deg;</option>
                                    <option>77&deg;</option>
                                    <option>78&deg;</option>
                                    <option>79&deg;</option>
                                    <option>80&deg;</option>
                                    <option>81&deg;</option>
                                    <option>82&deg;</option>
                                    <option>83&deg;</option>
                                    <option>84&deg;</option>
                                    <option>85&deg;</option>
                                    <option>86&deg;</option>
                                    <option>87&deg;</option>
                                    <option>88&deg;</option>
                                    <option>89&deg;</option>
                                    <option>90&deg;</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaube4Angle" name="gaube4Angle">
                                    <option value="" selected disabled>Winkel</option>
                                    <option>0&deg;</option>
                                    <option>1&deg;</option>
                                    <option>2&deg;</option>
                                    <option>3&deg;</option>
                                    <option>4&deg;</option>
                                    <option>5&deg;</option>
                                    <option>6&deg;</option>
                                    <option>7&deg;</option>
                                    <option>8&deg;</option>
                                    <option>9&deg;</option>
                                    <option>10&deg;</option>
                                    <option>11&deg;</option>
                                    <option>12&deg;</option>
                                    <option>13&deg;</option>
                                    <option>14&deg;</option>
                                    <option>15&deg;</option>
                                    <option>16&deg;</option>
                                    <option>17&deg;</option>
                                    <option>18&deg;</option>
                                    <option>19&deg;</option>
                                    <option>20&deg;</option>
                                    <option>21&deg;</option>
                                    <option>22&deg;</option>
                                    <option>23&deg;</option>
                                    <option>24&deg;</option>
                                    <option>25&deg;</option>
                                    <option>26&deg;</option>
                                    <option>27&deg;</option>
                                    <option>28&deg;</option>
                                    <option>29&deg;</option>
                                    <option>30&deg;</option>
                                    <option>31&deg;</option>
                                    <option>32&deg;</option>
                                    <option>33&deg;</option>
                                    <option>34&deg;</option>
                                    <option>35&deg;</option>
                                    <option>36&deg;</option>
                                    <option>37&deg;</option>
                                    <option>38&deg;</option>
                                    <option>39&deg;</option>
                                    <option>40&deg;</option>
                                    <option>41&deg;</option>
                                    <option>42&deg;</option>
                                    <option>43&deg;</option>
                                    <option>44&deg;</option>
                                    <option>45&deg;</option>
                                    <option>46&deg;</option>
                                    <option>47&deg;</option>
                                    <option>48&deg;</option>
                                    <option>49&deg;</option>
                                    <option>50&deg;</option>
                                    <option>51&deg;</option>
                                    <option>52&deg;</option>
                                    <option>53&deg;</option>
                                    <option>54&deg;</option>
                                    <option>55&deg;</option>
                                    <option>56&deg;</option>
                                    <option>57&deg;</option>
                                    <option>58&deg;</option>
                                    <option>59&deg;</option>
                                    <option>60&deg;</option>
                                    <option>61&deg;</option>
                                    <option>62&deg;</option>
                                    <option>63&deg;</option>
                                    <option>64&deg;</option>
                                    <option>65&deg;</option>
                                    <option>66&deg;</option>
                                    <option>67&deg;</option>
                                    <option>68&deg;</option>
                                    <option>69&deg;</option>
                                    <option>70&deg;</option>
                                    <option>71&deg;</option>
                                    <option>72&deg;</option>
                                    <option>73&deg;</option>
                                    <option>74&deg;</option>
                                    <option>75&deg;</option>
                                    <option>76&deg;</option>
                                    <option>77&deg;</option>
                                    <option>78&deg;</option>
                                    <option>79&deg;</option>
                                    <option>80&deg;</option>
                                    <option>81&deg;</option>
                                    <option>82&deg;</option>
                                    <option>83&deg;</option>
                                    <option>84&deg;</option>
                                    <option>85&deg;</option>
                                    <option>86&deg;</option>
                                    <option>87&deg;</option>
                                    <option>88&deg;</option>
                                    <option>89&deg;</option>
                                    <option>90&deg;</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table class="matrix-table gaube-window-table">
                    <thead>
                        <tr>
                            <th>HR</th>
                            <th class="col-narrow">Raum</th>
                            <th>VG</th>
                            <th>Stoff</th>
                            <th class="col-wide">Ma&szlig;e</th>
                            <th class="col-narrow">Bj.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="gaube-window-row" data-gaube-window-index="1">
                            <td>
                                <select id="gaubeWindowHr1" name="gaubeWindowHr1" data-gaube-window-field="gaubeWindowHr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td class="col-narrow">
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaubeWindowRoomDraw1" name="gaubeWindowRoomDraw1" data-gaube-window-field="gaubeWindowRoomDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaubeWindowRoomDraw1"></canvas>
                                </div>
                            </td>
                            <td>
                                <select id="gaubeWindowVg1" name="gaubeWindowVg1" data-gaube-window-field="gaubeWindowVg">
                                    <option value="" selected disabled>VG</option>
                                    <option>EV</option>
                                    <option>DV</option>
                                    <option>3F</option>
                                </select>
                            </td>
                            <td>
                                <select id="gaubeWindowMaterial1" name="gaubeWindowMaterial1" data-gaube-window-field="gaubeWindowMaterial">
                                    <option value="" selected disabled>Stoff</option>
                                    <option>KU</option>
                                    <option>HO</option>
                                    <option>ME</option>
                                </select>
                            </td>
                            <td class="col-wide">
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaubeWindowSizeDraw1" name="gaubeWindowSizeDraw1" data-gaube-window-field="gaubeWindowSizeDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaubeWindowSizeDraw1"></canvas>
                                </div>
                            </td>
                            <td class="col-narrow">
                                <div class="draw-wrap">
                                    <input type="hidden" id="gaubeWindowYearDraw1" name="gaubeWindowYearDraw1" data-gaube-window-field="gaubeWindowYearDraw">
                                    <canvas class="draw-canvas" data-draw-target="gaubeWindowYearDraw1"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="add-window-btn add-gaube-window-btn">+ Gaubenfenster hinzuf&uuml;gen</button>
            </div>
        </details>
        <details class="system-card section-green" open>
            <summary><span>Dach/OGD</span></summary>
            <div class="section-body">
                <h3 style="margin:0 0 6px;font-size:16px;">Dachfl&auml;chenfenster</h3>
                <table class="matrix-table roof-window-table">
                    <thead>
                        <tr>
                            <th>HR</th>
                            <th class="col-narrow">Raum</th>
                            <th>VG</th>
                            <th>Stoff</th>
                            <th class="col-wide">Ma&szlig;e</th>
                            <th class="col-narrow">Bj.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="roof-window-row" data-roof-window-index="1">
                            <td>
                                <select id="roofWindowHr1" name="roofWindowHr1" data-roof-window-field="roofWindowHr">
                                    <option value="" selected disabled>HR</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td class="col-narrow">
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofWindowRoomDraw1" name="roofWindowRoomDraw1" data-roof-window-field="roofWindowRoomDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofWindowRoomDraw1"></canvas>
                                </div>
                            </td>
                            <td>
                                <select id="roofWindowVg1" name="roofWindowVg1" data-roof-window-field="roofWindowVg">
                                    <option value="" selected disabled>VG</option>
                                    <option>EV</option>
                                    <option>DV</option>
                                    <option>3F</option>
                                </select>
                            </td>
                            <td>
                                <select id="roofWindowMaterial1" name="roofWindowMaterial1" data-roof-window-field="roofWindowMaterial">
                                    <option value="" selected disabled>Stoff</option>
                                    <option>KU</option>
                                    <option>HO</option>
                                    <option>ME</option>
                                </select>
                            </td>
                            <td class="col-wide">
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofWindowSizeDraw1" name="roofWindowSizeDraw1" data-roof-window-field="roofWindowSizeDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofWindowSizeDraw1"></canvas>
                                </div>
                            </td>
                            <td class="col-narrow">
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofWindowYearDraw1" name="roofWindowYearDraw1" data-roof-window-field="roofWindowYearDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofWindowYearDraw1"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="add-window-btn add-roof-window-btn">Dachfl&auml;chenfenster</button>
                <h3 style="margin:8px 0 0;font-size:16px;">OGD</h3>
                <div class="field-row dual ogd-row">
                    <label for="ogdStructure">Art/Aufbau/Material</label>
                    <select id="ogdStructure" name="ogdStructure">
                        <option value="" selected disabled>Auswahl &hellip;</option>
                        <option>Massiv</option>
                        <option>Holzbalken</option>
                    </select>
                    <div class="draw-wrap">
                        <input type="hidden" id="ogdStructureDraw" name="ogdStructureDraw">
                        <canvas class="draw-canvas" data-draw-target="ogdStructureDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="ogdInsulationDraw">D&auml;mmung</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="ogdInsulationDraw" name="ogdInsulationDraw">
                        <canvas class="draw-canvas" data-draw-target="ogdInsulationDraw"></canvas>
                    </div>
                </div>
                <h3 style="margin:8px 0 0;font-size:16px;">Dach</h3>
                <div class="check-grid roof-type-grid">
                    <label><input type="checkbox" name="roofTypeSatteldach">Satteldach</label>
                    <label><input type="checkbox" name="roofTypeWalmdach">Walmdach</label>
                    <label><input type="checkbox" name="roofTypePultdach">Pultdach</label>
                    <label><input type="checkbox" name="roofTypeMansardendach">Mansardendach</label>
                    <label><input type="checkbox" name="roofTypeFlachdach">Flachdach</label>
                    <label><input type="checkbox" name="roofTypeKruppelwalmdach">Kr&uuml;ppelwalmdach</label>
                    <label><input type="checkbox" name="roofTypeSheddach">Sheddach</label>
                </div>
                <table class="matrix-table roof-table">
                    <thead>
                        <tr>
                            <th>Tiefe</th>
                            <th>Breite</th>
                            <th>Abstand</th>
                            <th>Winkel</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofDepthDraw" name="roofDepthDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofDepthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofWidthDraw" name="roofWidthDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofWidthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofSpacingDraw" name="roofSpacingDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofSpacingDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofAngleDraw" name="roofAngleDraw">
                                    <canvas class="draw-canvas" data-draw-target="roofAngleDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofDepthDraw2" name="roofDepthDraw2">
                                    <canvas class="draw-canvas" data-draw-target="roofDepthDraw2"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofWidthDraw2" name="roofWidthDraw2">
                                    <canvas class="draw-canvas" data-draw-target="roofWidthDraw2"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofSpacingDraw2" name="roofSpacingDraw2">
                                    <canvas class="draw-canvas" data-draw-target="roofSpacingDraw2"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="roofAngleDraw2" name="roofAngleDraw2">
                                    <canvas class="draw-canvas" data-draw-target="roofAngleDraw2"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="field-row single">
                    <label for="roofInsulationDraw">D&auml;mmung</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="roofInsulationDraw" name="roofInsulationDraw">
                        <canvas class="draw-canvas" data-draw-target="roofInsulationDraw"></canvas>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card section-blue">
            <summary><span>Anbau</span></summary>
            <div class="section-body">
                <div class="field-row annex-row">
                    <label>Anbau</label>
                    <div class="inline-options">
                        <label><input type="radio" name="annexExists" value="Ja">Ja</label>
                        <label><input type="radio" name="annexExists" value="Nein">Nein</label>
                    </div>
                    <label for="annexYearDraw">Baujahr</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="annexYearDraw" name="annexYearDraw">
                        <canvas class="draw-canvas" data-draw-target="annexYearDraw"></canvas>
                    </div>
                    <label for="annexType">Bodenplatte</label>
                    <select id="annexType" name="annexType">
                        <option value="" selected disabled>Auswahl &hellip;</option>
                        <option>Massiv</option>
                        <option>Holzbalken</option>
                    </select>
                </div>
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Aufbau</th>
                            <th>Schicht 1</th>
                            <th>Schicht 2</th>
                            <th>Schicht 3</th>
                            <th>Schicht 4</th>
                            <th>Schicht 5</th>
                            <th>Gesamtdicke</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Nord</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallNorthL1Draw" name="annexWallNorthL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallNorthL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallNorthL2Draw" name="annexWallNorthL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallNorthL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallNorthL3Draw" name="annexWallNorthL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallNorthL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallNorthL4Draw" name="annexWallNorthL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallNorthL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallNorthL5Draw" name="annexWallNorthL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallNorthL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallNorthTotalDraw" name="annexWallNorthTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallNorthTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Ost</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallEastL1Draw" name="annexWallEastL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallEastL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallEastL2Draw" name="annexWallEastL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallEastL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallEastL3Draw" name="annexWallEastL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallEastL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallEastL4Draw" name="annexWallEastL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallEastL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallEastL5Draw" name="annexWallEastL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallEastL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallEastTotalDraw" name="annexWallEastTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallEastTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>S&uuml;d</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallSouthL1Draw" name="annexWallSouthL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallSouthL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallSouthL2Draw" name="annexWallSouthL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallSouthL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallSouthL3Draw" name="annexWallSouthL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallSouthL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallSouthL4Draw" name="annexWallSouthL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallSouthL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallSouthL5Draw" name="annexWallSouthL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallSouthL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallSouthTotalDraw" name="annexWallSouthTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallSouthTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>West</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallWestL1Draw" name="annexWallWestL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallWestL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallWestL2Draw" name="annexWallWestL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallWestL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallWestL3Draw" name="annexWallWestL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallWestL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallWestL4Draw" name="annexWallWestL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallWestL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallWestL5Draw" name="annexWallWestL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallWestL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexWallWestTotalDraw" name="annexWallWestTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexWallWestTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <h3 style="margin:8px 0 0;font-size:16px;">Dach</h3>
                <div class="check-grid roof-type-grid">
                    <label><input type="checkbox" name="annexRoofTypeSatteldach">Satteldach</label>
                    <label><input type="checkbox" name="annexRoofTypeWalmdach">Walmdach</label>
                    <label><input type="checkbox" name="annexRoofTypePultdach">Pultdach</label>
                    <label><input type="checkbox" name="annexRoofTypeMansardendach">Mansardendach</label>
                    <label><input type="checkbox" name="annexRoofTypeFlachdach">Flachdach</label>
                    <label><input type="checkbox" name="annexRoofTypeKruppelwalmdach">Kr&uuml;ppelwalmdach</label>
                    <label><input type="checkbox" name="annexRoofTypeSheddach">Sheddach</label>
                </div>
                <table class="matrix-table roof-table">
                    <thead>
                        <tr>
                            <th>Tiefe</th>
                            <th>Breite</th>
                            <th>Abstand</th>
                            <th>Winkel</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofDepthDraw" name="annexRoofDepthDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofDepthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofWidthDraw" name="annexRoofWidthDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofWidthDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofSpacingDraw" name="annexRoofSpacingDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofSpacingDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofAngleDraw" name="annexRoofAngleDraw">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofAngleDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofDepthDraw2" name="annexRoofDepthDraw2">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofDepthDraw2"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofWidthDraw2" name="annexRoofWidthDraw2">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofWidthDraw2"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofSpacingDraw2" name="annexRoofSpacingDraw2">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofSpacingDraw2"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="annexRoofAngleDraw2" name="annexRoofAngleDraw2">
                                    <canvas class="draw-canvas" data-draw-target="annexRoofAngleDraw2"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="field-row single">
                    <label for="annexRoofInsulationDraw">D&auml;mmung</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="annexRoofInsulationDraw" name="annexRoofInsulationDraw">
                        <canvas class="draw-canvas" data-draw-target="annexRoofInsulationDraw"></canvas>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card section-gray" open>
            <summary><span>Anlagentechnik</span></summary>
            <div class="section-body">
            <div class="field-row dual">
                <label for="systemManufacturer">Hersteller</label>
                <select id="systemManufacturer" name="systemManufacturer">
                    <option value="" selected disabled>Hersteller w&auml;hlen &hellip;</option>
                    <option>Viesmann</option>
                    <option>Bosch</option>
                    <option>Buderus</option>
                    <option>Junkers</option>
                </select>
                <span class="field-spacer" aria-hidden="true"></span>
                <div class="draw-wrap">
                    <input type="hidden" id="systemManufacturerDraw" name="systemManufacturerDraw">
                    <canvas class="draw-canvas" data-draw-target="systemManufacturerDraw"></canvas>
                </div>
            </div>
            <div class="field-row dual type-row">
                <label for="systemTypeDraw">Typ</label>
                <div class="draw-wrap">
                    <input type="hidden" id="systemTypeDraw" name="systemTypeDraw">
                    <canvas class="draw-canvas" data-draw-target="systemTypeDraw"></canvas>
                </div>
                <label for="systemPowerDraw" class="label-shift-right">Leistung</label>
                <div class="draw-wrap">
                    <input type="hidden" id="systemPowerDraw" name="systemPowerDraw">
                    <canvas class="draw-canvas" data-draw-target="systemPowerDraw"></canvas>
                </div>
            </div>
            <div class="field-row dual">
                <label for="systemYear">Baujahr</label>
                <select id="systemYear" name="systemYear">
                    <option value="" selected disabled>Baujahr w&auml;hlen &hellip;</option>
                    <option>2028</option>
                    <option>2027</option>
                    <option>2026</option>
                    <option>2025</option>
                    <option>2024</option>
                    <option>2023</option>
                    <option>2022</option>
                    <option>2021</option>
                    <option>2020</option>
                    <option>2019</option>
                    <option>2018</option>
                    <option>2017</option>
                    <option>2016</option>
                    <option>2015</option>
                    <option>2014</option>
                    <option>2013</option>
                    <option>2012</option>
                    <option>2011</option>
                    <option>2010</option>
                    <option>2009</option>
                    <option>2008</option>
                    <option>2007</option>
                    <option>2006</option>
                    <option>2005</option>
                    <option>2004</option>
                    <option>2003</option>
                    <option>2002</option>
                    <option>2001</option>
                    <option>2000</option>
                    <option>1999</option>
                    <option>1998</option>
                    <option>1997</option>
                    <option>1996</option>
                    <option>1995</option>
                    <option>1994</option>
                    <option>1993</option>
                    <option>1992</option>
                    <option>1991</option>
                    <option>1990</option>
                    <option>1989</option>
                    <option>1988</option>
                    <option>1987</option>
                    <option>1986</option>
                    <option>1985</option>
                    <option>1984</option>
                    <option>1983</option>
                    <option>1982</option>
                    <option>1981</option>
                    <option>1980</option>
                    <option>1979</option>
                    <option>1978</option>
                    <option>1977</option>
                    <option>1976</option>
                    <option>1975</option>
                    <option>1974</option>
                    <option>1973</option>
                    <option>1972</option>
                    <option>1971</option>
                    <option>1970</option>
                    <option>1969</option>
                    <option>1968</option>
                    <option>1967</option>
                    <option>1966</option>
                    <option>1965</option>
                    <option>1964</option>
                    <option>1963</option>
                    <option>1962</option>
                    <option>1961</option>
                    <option>1960</option>
                    <option>1959</option>
                    <option>1958</option>
                    <option>1957</option>
                    <option>1956</option>
                    <option>1955</option>
                    <option>1954</option>
                    <option>1953</option>
                    <option>1952</option>
                    <option>1951</option>
                    <option>1950</option>
                    <option>1949</option>
                    <option>1948</option>
                    <option>1947</option>
                    <option>1946</option>
                    <option>1945</option>
                    <option>1944</option>
                    <option>1943</option>
                    <option>1942</option>
                    <option>1941</option>
                    <option>1940</option>
                </select>
                <label for="systemFuel" class="label-shift-right">Brennstoff</label>
                <select id="systemFuel" name="systemFuel">
                    <option value="" selected disabled>Brennstoff w&auml;hlen &hellip;</option>
                    <option>Erdgas</option>
                    <option>&Ouml;l</option>
                    <option>Pellet</option>
                </select>
            </div>
            <div class="field-row single">
                <label for="systemLocation">Aufstellort der Heizung</label>
                <select id="systemLocation" name="systemLocation">
                    <option value="" selected disabled>Aufstellort w&auml;hlen &hellip;</option>
                    <option>Keller</option>
                    <option>Dachboden</option>
                    <option>In H&uuml;llfl&auml;che</option>
                    <option>Au&szlig;erhalb H&uuml;llfl&auml;che</option>
                </select>
            </div>
            <div class="field-row single">
                <label>Optionen</label>
                <div class="check-grid">
                    <label><input type="checkbox" name="optionNightReduction">Nachtabsenkung</label>
                    <label><input type="checkbox" name="optionHydraulicBalance">Hydr. Abgleich</label>
                    <label><input type="checkbox" name="optionHeaterNiches">Heizk&ouml;rpernieschen</label>
                    <label><input type="checkbox" name="optionCirculationTimed">Zirku. Zeitgesteuert</label>
                </div>
            </div>
            <div class="field-row dual">
                <label for="systemThermostatValves">Thermostatventile</label>
                <select id="systemThermostatValves" name="systemThermostatValves">
                    <option value="" selected disabled>Ventile w&auml;hlen &hellip;</option>
                    <option>1K</option>
                    <option>2K</option>
                    <option>Digital</option>
                </select>
                <label for="heatingCircuits">Anzahl Heizkreise</label>
                <select id="heatingCircuits" name="heatingCircuits">
                    <option value="" selected disabled>Anzahl w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <h3 style="margin:6px 0 0;font-size:16px;">Pumpen</h3>
            <div class="field-row pump">
                <label for="pumpCirculationDraw">Umw&auml;lzpumpe</label>
                <div class="draw-wrap">
                    <input type="hidden" id="pumpCirculationDraw" name="pumpCirculationDraw">
                    <canvas class="draw-canvas" data-draw-target="pumpCirculationDraw"></canvas>
                </div>
                <label><input type="checkbox" name="pumpCirculationHe">HE?</label>
                <select id="pumpCirculationStf" name="pumpCirculationStf">
                    <option value="" selected disabled>Stf w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <div class="field-row pump">
                <label for="pumpStorageDraw">Speicherladepumpe</label>
                <div class="draw-wrap">
                    <input type="hidden" id="pumpStorageDraw" name="pumpStorageDraw">
                    <canvas class="draw-canvas" data-draw-target="pumpStorageDraw"></canvas>
                </div>
                <label><input type="checkbox" name="pumpStorageHe">HE?</label>
                <select id="pumpStorageStf" name="pumpStorageStf">
                    <option value="" selected disabled>Stf w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <div class="field-row pump">
                <label for="pumpRecircDraw">Zirkulationspumpe</label>
                <div class="draw-wrap">
                    <input type="hidden" id="pumpRecircDraw" name="pumpRecircDraw">
                    <canvas class="draw-canvas" data-draw-target="pumpRecircDraw"></canvas>
                </div>
                <label><input type="checkbox" name="pumpRecircHe">HE?</label>
                <select id="pumpRecircStf" name="pumpRecircStf">
                    <option value="" selected disabled>Stf w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <div class="field-row dual">
                <label for="heatDistribution">W&auml;rmeverteilung</label>
                <select id="heatDistribution" name="heatDistribution">
                    <option value="" selected disabled>Verteilung w&auml;hlen &hellip;</option>
                    <option>Fu&szlig;bodenheizung</option>
                    <option>Heizk&ouml;rper</option>
                </select>
                <label for="pipeInsulation">D&auml;mmung der Rohrleitung</label>
                <select id="pipeInsulation" name="pipeInsulation">
                    <option value="" selected disabled>D&auml;mmung w&auml;hlen &hellip;</option>
                    <option>Keine D&auml;mmung</option>
                    <option>halbe GEG</option>
                    <option>ganze GEG</option>
                </select>
            </div>
            <h3 style="margin:6px 0 0;font-size:16px;">Brauchwasser</h3>
            <div class="system-row">
                <div class="inline-options">
                    <label><input type="radio" name="hotWaterType" value="Direkt">Direkt</label>
                    <label><input type="radio" name="hotWaterType" value="Indirekt">Indirekt</label>
                </div>
            </div>
            <table class="matrix-table">
                <thead>
                    <tr>
                        <th>Hersteller</th>
                        <th>Typ</th>
                        <th>Leistung</th>
                        <th>Brennstoff</th>
                        <th>Speicher in L</th>
                        <th>D&auml;mmung Leitung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="hotWaterManufacturerDraw" name="hotWaterManufacturerDraw">
                                <canvas class="draw-canvas" data-draw-target="hotWaterManufacturerDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="hotWaterTypeDraw" name="hotWaterTypeDraw">
                                <canvas class="draw-canvas" data-draw-target="hotWaterTypeDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="hotWaterPowerDraw" name="hotWaterPowerDraw">
                                <canvas class="draw-canvas" data-draw-target="hotWaterPowerDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="hotWaterFuelDraw" name="hotWaterFuelDraw">
                                <canvas class="draw-canvas" data-draw-target="hotWaterFuelDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="hotWaterStorageDraw" name="hotWaterStorageDraw">
                                <canvas class="draw-canvas" data-draw-target="hotWaterStorageDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <select id="hotWaterPipeInsulation" name="hotWaterPipeInsulation">
                                <option value="" selected disabled>D&auml;mmung &hellip;</option>
                                <option>Keine D&auml;mmung</option>
                                <option>halbe GEG</option>
                                <option>ganze GEG</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3 style="margin:6px 0 0;font-size:16px;">Zus&auml;tzlicher W&auml;rmeerzeuger</h3>
            <div class="field-row">
                <label>Kaminofen?</label>
                <div class="inline-options">
                    <label><input type="radio" name="extraHeaterStove" value="Ja">Ja</label>
                    <label><input type="radio" name="extraHeaterStove" value="Nein">Nein</label>
                </div>
                <div class="inline-options">
                    <label><input type="radio" name="extraHeaterType" value="Zentral">Zentral</label>
                    <label><input type="radio" name="extraHeaterType" value="Dezentral">Dezentral</label>
                </div>
            </div>
            <table class="matrix-table">
                <thead>
                    <tr>
                        <th>Hersteller</th>
                        <th>Typ</th>
                        <th>Leistung</th>
                        <th>Baujahr</th>
                        <th>Brennstoff</th>
                        <th>Brauchwasserbereitung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="extraHeaterManufacturerDraw" name="extraHeaterManufacturerDraw">
                                <canvas class="draw-canvas" data-draw-target="extraHeaterManufacturerDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="extraHeaterTypeDraw" name="extraHeaterTypeDraw">
                                <canvas class="draw-canvas" data-draw-target="extraHeaterTypeDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="extraHeaterPowerDraw" name="extraHeaterPowerDraw">
                                <canvas class="draw-canvas" data-draw-target="extraHeaterPowerDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="extraHeaterYearDraw" name="extraHeaterYearDraw">
                                <canvas class="draw-canvas" data-draw-target="extraHeaterYearDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="draw-wrap">
                                <input type="hidden" id="extraHeaterFuelDraw" name="extraHeaterFuelDraw">
                                <canvas class="draw-canvas" data-draw-target="extraHeaterFuelDraw"></canvas>
                            </div>
                        </td>
                        <td>
                            <select id="extraHeaterHotWater" name="extraHeaterHotWater">
                                <option value="" selected disabled>Auswahl &hellip;</option>
                                <option>Ja</option>
                                <option>Nein</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3 style="margin:6px 0 0;font-size:16px;">Fu&szlig;bodenheizung</h3>
            <div class="system-row" id="surfaceHeatingDetails">
                <div class="inline-options">
                    <label><input type="checkbox" name="surfaceHeatingDistributorPhoto">Foto vom Verteiler</label>
                </div>
                <div class="field-row single">
                    <label for="distributorDn">Verteiler DN</label>
                    <input type="hidden" id="distributorDn" name="distributorDn">
                    <div class="draw-wrap">
                        <canvas id="distributorDnDraw" class="draw-canvas" data-draw-target="distributorDn"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="layingSpacing">Verlegeabstand</label>
                    <select id="layingSpacing" name="layingSpacing">
                        <option value="" selected disabled>Abstand w&auml;hlen &hellip;</option>
                        <option>5</option>
                        <option>5.5</option>
                        <option>7.5</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12.5</option>
                        <option>15</option>
                        <option>16.5</option>
                        <option>20</option>
                        <option>22.5</option>
                        <option>25</option>
                        <option>27.5</option>
                        <option>30</option>
                    </select>
                </div>
                <div class="field-row single">
                    <label for="fBHLineDiameter">Durchmesser Leitung FBH</label>
                    <select id="fBHLineDiameter" name="fBHLineDiameter">
                        <option value="" selected disabled>Durchmesser w&auml;hlen &hellip;</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                        <option>32</option>
                        <option>33</option>
                        <option>34</option>
                        <option>35</option>
                        <option>36</option>
                        <option>37</option>
                        <option>38</option>
                        <option>39</option>
                        <option>40</option>
                        <option>41</option>
                        <option>42</option>
                        <option>43</option>
                        <option>44</option>
                        <option>45</option>
                        <option>46</option>
                        <option>47</option>
                        <option>48</option>
                        <option>49</option>
                        <option>50</option>
                    </select>
                </div>
            </div>
            </div>
        </details>
        <details class="system-card">
            <summary><span>Sonstiges</span></summary>
            <div class="section-body">
                <h3 style="margin:6px 0 0;font-size:16px;">Solarthermie</h3>
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Baujahr</th>
                            <th>Speicher</th>
                            <th>Pumpe</th>
                            <th>Module</th>
                            <th>Module m&sup2;</th>
                            <th>Ausrichtung</th>
                            <th>Kollektorart</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="solarYearDraw" name="solarYearDraw">
                                    <canvas class="draw-canvas" data-draw-target="solarYearDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="solarStorageDraw" name="solarStorageDraw">
                                    <canvas class="draw-canvas" data-draw-target="solarStorageDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="solarPumpDraw" name="solarPumpDraw">
                                    <canvas class="draw-canvas" data-draw-target="solarPumpDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="solarModulesDraw" name="solarModulesDraw">
                                    <canvas class="draw-canvas" data-draw-target="solarModulesDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="solarModulesAreaDraw" name="solarModulesAreaDraw">
                                    <canvas class="draw-canvas" data-draw-target="solarModulesAreaDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <select id="solarOrientation" name="solarOrientation">
                                    <option value="" selected disabled>Ausrichtung</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td>
                                <select id="solarCollectorType" name="solarCollectorType">
                                    <option value="" selected disabled>Auswahl &hellip;</option>
                                    <option>Flachkollektor</option>
                                    <option>R&ouml;hrenkollektor</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <h3 style="margin:6px 0 0;font-size:16px;">Photovoltaik</h3>
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Module</th>
                            <th>Module m&sup2;</th>
                            <th>Leistung</th>
                            <th>Bel&uuml;ftung</th>
                            <th>Ausrichtung</th>
                            <th>Batteriespeicher</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="pvModulesDraw" name="pvModulesDraw">
                                    <canvas class="draw-canvas" data-draw-target="pvModulesDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="pvModulesAreaDraw" name="pvModulesAreaDraw">
                                    <canvas class="draw-canvas" data-draw-target="pvModulesAreaDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="pvPowerDraw" name="pvPowerDraw">
                                    <canvas class="draw-canvas" data-draw-target="pvPowerDraw"></canvas>
                                </div>
                            </td>
                            <td>
                                <select id="pvVentilation" name="pvVentilation">
                                    <option value="" selected disabled>Bel&uuml;ftung</option>
                                    <option>Unbel&uuml;ftet</option>
                                    <option>M&auml;&szlig;ig</option>
                                    <option>Stark</option>
                                </select>
                            </td>
                            <td>
                                <select id="pvOrientation" name="pvOrientation">
                                    <option value="" selected disabled>Ausrichtung</option>
                                    <option>N</option>
                                    <option>O</option>
                                    <option>S</option>
                                    <option>W</option>
                                </select>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="pvBatteryDraw" name="pvBatteryDraw">
                                    <canvas class="draw-canvas" data-draw-target="pvBatteryDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </details>
        <details class="system-card">
            <summary><span>R&auml;ume</span></summary>
            <div class="section-body">
        <section class="room-card">
            <details open>
                <summary><span data-room-label data-default="Raum 1">Raum 1 <small>Geschoss zuerst w&auml;hlen</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room1Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room1Floor" name="room1Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room1Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room1Name" name="room1Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm1">Platte</label>
                                    <label><input type="radio" name="room1HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm2">Platte</label>
                                    <label><input type="radio" name="room1HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm3">Platte</label>
                                    <label><input type="radio" name="room1HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 2">Raum 2 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room2Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room2Floor" name="room2Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room2Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room2Name" name="room2Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm1">Platte</label>
                                    <label><input type="radio" name="room2HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm2">Platte</label>
                                    <label><input type="radio" name="room2HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm3">Platte</label>
                                    <label><input type="radio" name="room2HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 3">Raum 3 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room3Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room3Floor" name="room3Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room3Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room3Name" name="room3Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm1">Platte</label>
                                    <label><input type="radio" name="room3HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm2">Platte</label>
                                    <label><input type="radio" name="room3HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm3">Platte</label>
                                    <label><input type="radio" name="room3HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 4">Raum 4 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room4Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room4Floor" name="room4Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room4Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room4Name" name="room4Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm1">Platte</label>
                                    <label><input type="radio" name="room4HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm2">Platte</label>
                                    <label><input type="radio" name="room4HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm3">Platte</label>
                                    <label><input type="radio" name="room4HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 5">Raum 5 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room5Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room5Floor" name="room5Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room5Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room5Name" name="room5Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm1">Platte</label>
                                    <label><input type="radio" name="room5HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm2">Platte</label>
                                    <label><input type="radio" name="room5HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm3">Platte</label>
                                    <label><input type="radio" name="room5HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>                                    <option>400</option>                                    <option>600</option>                                    <option>800</option>                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>                                    <option>500</option>                                    <option>600</option>                                    <option>700</option>                                    <option>800</option>                                    <option>900</option>                                    <option>1100</option>                                    <option>1200</option>                                    <option>1300</option>                                    <option>1400</option>                                    <option>1600</option>                                    <option>1800</option>                                    <option>2000</option>                                    <option>2300</option>                                    <option>2400</option>                                    <option>2600</option>                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <button type="button" class="add-room-btn">+ Raum hinzuf&uuml;gen</button>
            </div>
        </details>
        <details class="system-card">
            <summary><span>Notizen</span></summary>
            <div class="section-body">
                <div class="draw-wrap">
                    <input type="hidden" id="notesLargeDraw" name="notesLargeDraw">
                    <canvas class="draw-canvas large" data-draw-target="notesLargeDraw"></canvas>
                </div>
            </div>
        </details>
        <button type="button" class="share-btn">Teilen</button>
        <button type="button" class="eraser-btn">Radierer</button>
        <button type="button" class="reset-btn">Alles reseten</button>
    </form>
</main>
<button type="button" class="eraser-btn floating-eraser">R</button>
<div id="printView" class="print-view" aria-hidden="true"></div>
<script>
(function(){
  const STORAGE_KEY = "hkFormStateV1";
  const APP_VERSION = "v43";
  let saveTimer = null;
  let eraserMode = false;
  let shareErrorShown = false;
  let shareHtmlCache = "";
  let shareHasData = false;
  let gaubes = [];
  let windows = [];
  let gaubeWindows = [];
  let roofWindows = [];
  const eraserButtons = document.querySelectorAll(".eraser-btn");
  window.addEventListener("error", event => {
    if(shareErrorShown) return;
    shareErrorShown = true;
    const message = event && event.message ? event.message : "Unbekannter Fehler";
    const file = event && event.filename ? event.filename : "";
    const line = event && event.lineno ? event.lineno : "";
    const col = event && event.colno ? event.colno : "";
    const stack = event && event.error && event.error.stack ? event.error.stack : "";
    alert(
      "Fehler (" + APP_VERSION + "): " + message +
      (file || line ? "\nQuelle: " + file + ":" + line + ":" + col : "") +
      (stack ? "\nStack: " + stack : "")
    );
  });
  window.addEventListener("unhandledrejection", event => {
    if(shareErrorShown) return;
    shareErrorShown = true;
    const msg = event && event.reason ? (event.reason.message || String(event.reason)) : "Unbekannter Fehler";
    alert("Fehler: " + msg);
  });
  if(eraserButtons.length){
    eraserButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        eraserMode = !eraserMode;
        eraserButtons.forEach(b => b.classList.toggle("active", eraserMode));
      });
    });
  }
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js?v=46").then(reg => {
        reg.update().catch(() => {});
      }).catch(() => {});
    });
  }
  function updateLabels(){
    const cards = document.querySelectorAll(".room-card");
    const seen = {};
    cards.forEach(card => {
      const label = card.querySelector("[data-room-label]");
      const roomSel = card.querySelector('select[name$="Name"]');
      const floorSel = card.querySelector('select[name$="Floor"]');
      if(!label || !roomSel || !floorSel) return;
      const base = label.dataset.default || label.textContent.trim();
      const room = roomSel.value;
      const floor = floorSel.value;
      let text = base;
      if(room){
        seen[room] = (seen[room] || 0) + 1;
        const suffix = seen[room] > 1 ? seen[room] : "";
        text = room + suffix + (floor ? ` (${floor})` : "");
      }
      const small = label.querySelector("small");
      label.textContent = "";
      label.append(document.createTextNode(text + " "));
      if(small) label.append(small);
    });
  }

  function attachRoomListeners(card){
    const roomSel = card.querySelector('select[name$="Name"]');
    const floorSel = card.querySelector('select[name$="Floor"]');
    roomSel && roomSel.addEventListener("change", updateLabels);
    floorSel && floorSel.addEventListener("change", updateLabels);
  }

  function cacheDefaults(hk){
    hk.querySelectorAll("label").forEach(label => {
      if(!label.dataset.defaultLabel) label.dataset.defaultLabel = label.innerHTML;
    });
    hk.querySelectorAll("select").forEach(sel => {
      if(sel.dataset.defaultOptions) return;
      const opts = Array.from(sel.options).map(opt => ({
        value: opt.value,
        text: opt.text,
        disabled: opt.disabled
      }));
      sel.dataset.defaultOptions = JSON.stringify(opts);
    });
    hk.querySelectorAll('input[type="text"]').forEach(inp => {
      if(!inp.dataset.defaultPlaceholder) inp.dataset.defaultPlaceholder = inp.placeholder || "";
    });
  }

  function restoreSelect(sel){
    if(!sel || !sel.dataset.defaultOptions) return;
    let opts = [];
    try { opts = JSON.parse(sel.dataset.defaultOptions); } catch(e){ opts = []; }
    sel.innerHTML = "";
    opts.forEach(opt => {
      const el = document.createElement("option");
      el.value = opt.value;
      el.textContent = opt.text;
      if(opt.disabled) el.disabled = true;
      sel.appendChild(el);
    });
    sel.selectedIndex = 0;
  }

  function setSelectOptions(sel, placeholder, values){
    if(!sel) return;
    sel.innerHTML = "";
    const first = document.createElement("option");
    first.value = "";
    first.textContent = placeholder;
    first.disabled = true;
    first.selected = true;
    sel.appendChild(first);
    values.forEach(val => {
      const opt = document.createElement("option");
      opt.value = val;
      opt.textContent = val;
      sel.appendChild(opt);
    });
  }

  function applyBauform(hk){
    const checked = hk.querySelector('input[type="radio"][name*="HkForm"]:checked');
    const checkedText = checked && checked.parentElement ? checked.parentElement.textContent : "";
    const isRippen = !!(checked && /Rippen/i.test(checkedText));
    cacheDefaults(hk);
    const heightSel = hk.querySelector('select[name*="HkHeight"]');
    const widthSel = hk.querySelector('select[name*="HkWidth"]');
    const dnSel = hk.querySelector('select[name*="HkDn"]');
    const typeSel = hk.querySelector('select[name*="HkType"]');
    const heightRow = heightSel ? heightSel.closest(".field-row") : null;
    const widthRow = widthSel ? widthSel.closest(".field-row") : null;
    const dnRow = dnSel ? dnSel.closest(".field-row") : null;
    const typeRow = typeSel ? typeSel.closest(".field-row") : null;
    const heightInput = hk.querySelector('input[name*="HkHeight"]');
    const widthInput = hk.querySelector('input[name*="HkWidth"]');
    const dnInput = hk.querySelector('input[name*="HkDn"]');

    if(isRippen){
      if(typeRow){
        const label = typeRow.querySelector("label");
        if(label) label.innerHTML = "HK Typ<small>Guss, Stahl</small>";
      }
      if(heightRow){
        const label = heightRow.querySelector("label");
        if(label) label.innerHTML = "H\u00f6he [mm]<small>280, 430, 580, 680, 880, 980</small>";
      }
      if(widthRow){
        const label = widthRow.querySelector("label");
        if(label) label.innerHTML = "Tiefe [mm]<small>70, 110, 160, 220, 250</small>";
      }
      if(dnRow){
        const label = dnRow.querySelector("label");
        if(label) label.innerHTML = "Gliederzahl<small>1 bis 100</small>";
      }
      setSelectOptions(typeSel, "Typ w\u00e4hlen ...", ["Guss","Stahl"]);
      setSelectOptions(heightSel, "H\u00f6he w\u00e4hlen ...", ["280","430","580","680","880","980"]);
      setSelectOptions(widthSel, "Tiefe w\u00e4hlen ...", ["70","110","160","220","250"]);
      const glieder = Array.from({length: 100}, (_, i) => String(i + 1));
      setSelectOptions(dnSel, "Gliederzahl w\u00e4hlen ...", glieder);
      if(heightInput) { heightInput.placeholder = "andere H\u00f6he"; heightInput.value = ""; }
      if(widthInput) { widthInput.placeholder = "andere Tiefe"; widthInput.value = ""; }
      if(dnInput) { dnInput.placeholder = "andere Gliederzahl"; dnInput.value = ""; }
    } else {
      if(typeRow){
        const label = typeRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(heightRow){
        const label = heightRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(widthRow){
        const label = widthRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(dnRow){
        const label = dnRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      restoreSelect(typeSel);
      restoreSelect(heightSel);
      restoreSelect(widthSel);
      restoreSelect(dnSel);
      if(heightInput && heightInput.dataset.defaultPlaceholder) heightInput.placeholder = heightInput.dataset.defaultPlaceholder;
      if(widthInput && widthInput.dataset.defaultPlaceholder) widthInput.placeholder = widthInput.dataset.defaultPlaceholder;
      if(dnInput && dnInput.dataset.defaultPlaceholder) dnInput.placeholder = dnInput.dataset.defaultPlaceholder;
    }
  }

  function attachBauformListeners(container){
    const hkCards = container.classList && container.classList.contains("hk-card")
      ? [container]
      : Array.from(container.querySelectorAll(".hk-card"));
    hkCards.forEach(hk => {
      hk.querySelectorAll('input[type="radio"][name*="HkForm"]').forEach(radio => {
        if(radio.dataset.bound) return;
        radio.dataset.bound = "1";
        if(!radio.hasAttribute("value") || radio.value === "on"){
          const text = radio.parentElement ? radio.parentElement.textContent : "";
          radio.value = /Rippen/i.test(text) ? "Rippen" : "Platte";
        }
        radio.addEventListener("change", () => applyBauform(hk));
      });
      applyBauform(hk);
    });
  }

  document.querySelectorAll(".room-card").forEach(attachRoomListeners);
  attachBauformListeners(document);
  updateLabels();

  function isLikelyStylusPointer(e){
    if(typeof e.pointerType !== "string") return false;
    if(e.pointerType === "pen") return true;
    if(e.pointerType !== "touch") return false;
    const w = typeof e.width === "number" ? e.width : 0;
    const h = typeof e.height === "number" ? e.height : 0;
    const pressure = typeof e.pressure === "number" ? e.pressure : 0;
    const tilt = (typeof e.tiltX === "number" ? Math.abs(e.tiltX) : 0) +
      (typeof e.tiltY === "number" ? Math.abs(e.tiltY) : 0);
    if(tilt > 0) return true;
    if(w && h && Math.max(w, h) <= 10 && pressure >= 0.2) return true;
    return false;
  }

  function isLikelyStylusTouch(e){
    if(!e.touches || !e.touches[0]) return false;
    const touch = e.touches[0];
    if(typeof touch.touchType === "string") return touch.touchType === "stylus";
    const radius = Math.max(touch.radiusX || 0, touch.radiusY || 0);
    const force = typeof touch.force === "number" ? touch.force : 0;
    if(radius && radius <= 8 && force >= 0.2) return true;
    return false;
  }

  function isStylusEvent(e){
    if(isLikelyStylusPointer(e)) return true;
    if(isLikelyStylusTouch(e)) return true;
    return false;
  }

  function setupDrawingInputs(container){
    const inputs = (container || document).querySelectorAll('input[type="text"][name$="Custom"]');
    inputs.forEach(input => {
      if(input.dataset.drawEnhanced) return;
      input.dataset.drawEnhanced = "1";
      const wrap = document.createElement("div");
      wrap.className = "draw-wrap";
      const canvas = document.createElement("canvas");
      canvas.className = "draw-canvas";
      wrap.append(canvas);

      const hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = input.name;
      hidden.dataset.drawing = "";
      input.insertAdjacentElement("afterend", wrap);
      input.replaceWith(hidden);

      const ctx = canvas.getContext("2d");
      function resizeCanvas(){
        const rect = canvas.getBoundingClientRect();
        const dpr = (window.devicePixelRatio || 1) * 2;
        canvas.width = Math.max(1, Math.floor(rect.width * dpr));
        canvas.height = Math.max(1, Math.floor(rect.height * dpr));
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.lineWidth = 1.5;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.strokeStyle = "#0f172a";
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      let drawing = false;
      function posFromEvent(e){
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }
      function applyMode(){
        const erasing = eraserMode;
        ctx.globalCompositeOperation = erasing ? "destination-out" : "source-over";
        ctx.lineWidth = erasing ? 6 : 1.5;
      }
      function start(e){
        if(!isStylusEvent(e)) return;
        drawing = true;
        applyMode();
        const p = posFromEvent(e);
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        e.preventDefault();
      }
      function move(e){
        if(!drawing || !isStylusEvent(e)) return;
        const p = posFromEvent(e);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        e.preventDefault();
      }
      function end(){
        if(!drawing) return;
        drawing = false;
        hidden.dataset.drawing = canvas.toDataURL("image/png");
        scheduleSave();
      }
      canvas.addEventListener("pointerdown", start);
      canvas.addEventListener("pointermove", move);
      canvas.addEventListener("pointerup", end);
      canvas.addEventListener("pointerleave", end);
      canvas.addEventListener("touchstart", start, { passive: false });
      canvas.addEventListener("touchmove", move, { passive: false });
      canvas.addEventListener("touchend", end);

      // keine Loeschen-Aktion
    });
  }

  setupDrawingInputs(document);

  function resizeDrawCanvas(canvas, ctx){
    const rect = canvas.getBoundingClientRect();
    if(rect.width < 1 || rect.height < 1) return;
    const dpr = (window.devicePixelRatio || 1) * 2;
    canvas.width = Math.max(1, Math.floor(rect.width * dpr));
    canvas.height = Math.max(1, Math.floor(rect.height * dpr));
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    ctx.lineWidth = 1.5;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.strokeStyle = "#0f172a";
  }


  function initDrawCanvas(canvas, hidden){
    const ctx = canvas.getContext("2d");
    function resizeCanvas(){
      resizeDrawCanvas(canvas, ctx);
    }
    resizeCanvas();
    canvas.dataset.resizeHook = "1";
    window.addEventListener("resize", resizeCanvas);

    let drawing = false;
    function posFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      return { x: clientX - rect.left, y: clientY - rect.top };
    }
    function applyMode(){
      const erasing = eraserMode;
      ctx.globalCompositeOperation = erasing ? "destination-out" : "source-over";
      ctx.lineWidth = erasing ? 6 : 1.5;
    }
    function start(e){
      if(!isStylusEvent(e)) return;
      drawing = true;
      applyMode();
      const p = posFromEvent(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
      e.preventDefault();
    }
    function move(e){
      if(!drawing || !isStylusEvent(e)) return;
      const p = posFromEvent(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      e.preventDefault();
    }
    function end(){
      if(!drawing) return;
      drawing = false;
      hidden.dataset.drawing = canvas.toDataURL("image/png");
      scheduleSave();
    }
    canvas.addEventListener("pointerdown", start);
    canvas.addEventListener("pointermove", move);
    canvas.addEventListener("pointerup", end);
    canvas.addEventListener("pointerleave", end);
    canvas.addEventListener("touchstart", start, { passive: false });
    canvas.addEventListener("touchmove", move, { passive: false });
    canvas.addEventListener("touchend", end);
  }

  document.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
    const targetId = canvas.getAttribute("data-draw-target");
    const hidden = targetId ? document.getElementById(targetId) : null;
    if(hidden) initDrawCanvas(canvas, hidden);
  });

  const surfaceHeatingRadios = document.querySelectorAll('input[name="surfaceHeating"]');
  const surfaceHeatingDetails = document.getElementById("surfaceHeatingDetails");
  function toggleSurfaceHeating(){
    if(!surfaceHeatingDetails) return;
    surfaceHeatingDetails.classList.remove("hidden");
    surfaceHeatingDetails.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
      const ctx = canvas.getContext("2d");
      if(ctx) resizeDrawCanvas(canvas, ctx);
    });
  }
  surfaceHeatingRadios.forEach(r => r.addEventListener("change", toggleSurfaceHeating));
  const buildingDataRadios = document.querySelectorAll('input[name="buildingData"]');
  const buildingDataDetails = document.getElementById("buildingDataDetails");
  function toggleBuildingData(){
    if(!buildingDataDetails) return;
    const checked = document.querySelector('input[name="buildingData"]:checked');
    buildingDataDetails.classList.toggle("hidden", !(checked && checked.value === "Nein"));
    if(checked && checked.value === "Nein"){
      buildingDataDetails.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
        const ctx = canvas.getContext("2d");
        if(ctx) resizeDrawCanvas(canvas, ctx);
      });
    }
  }
  buildingDataRadios.forEach(r => r.addEventListener("change", toggleBuildingData));

  function collectFormState(){
    const roomCount = document.querySelectorAll(".room-card").length;
    const hkCounts = {};
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      hkCounts[String(idx + 1)] = card.querySelectorAll(".hk-card").length;
    });
    const windowCount = document.querySelectorAll(".window-row").length;
    const gaubeWindowCount = document.querySelectorAll(".gaube-window-row").length;
    const roofWindowCount = document.querySelectorAll(".roof-window-row").length;
    const values = {};
    document.querySelectorAll("input, select, textarea").forEach(el => {
      if(!el.name) return;
      if(el.type === "radio"){
        if(el.checked) values[el.name] = { type: "radio", value: el.value };
        return;
      }
      if(el.type === "checkbox"){
        values[el.name] = { type: "checkbox", checked: el.checked };
        return;
      }
      if(el.type === "hidden" && el.dataset.drawing){
        values[el.name] = { type: "hidden", value: el.value || "", drawing: el.dataset.drawing };
        return;
      }
      values[el.name] = { type: el.type, value: el.value };
    });
    return { roomCount, hkCounts, windowCount, gaubeWindowCount, roofWindowCount, values };
  }

  function scheduleSave(){
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(() => {
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(collectFormState()));
      } catch(e){}
      updateShareCache();
    }, 300);
  }

  function findCanvasForHidden(hidden){
    if(hidden.id){
      const byId = document.querySelector('canvas[data-draw-target="' + hidden.id + '"]');
      if(byId) return byId;
    }
    const next = hidden.nextElementSibling;
    if(next && next.classList && next.classList.contains("draw-wrap")){
      const canvas = next.querySelector("canvas");
      if(canvas) return canvas;
    }
    return null;
  }

  function drawDataUrl(canvas, dataUrl){
    if(!canvas || !dataUrl) return;
    const ctx = canvas.getContext("2d");
    resizeDrawCanvas(canvas, ctx);
    const rect = canvas.getBoundingClientRect();
    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 0, 0, rect.width, rect.height);
    };
    img.src = dataUrl;
  }

  function refreshDrawCanvases(){
    document.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
      const targetId = canvas.getAttribute("data-draw-target");
      const hidden = targetId ? document.getElementById(targetId) : null;
      const dataUrl = hidden && hidden.dataset ? hidden.dataset.drawing : "";
      if(dataUrl){
        drawDataUrl(canvas, dataUrl);
      } else {
        const ctx = canvas.getContext("2d");
        if(ctx) resizeDrawCanvas(canvas, ctx);
      }
    });
  }

  function scheduleCanvasRefresh(){
    requestAnimationFrame(() => {
      requestAnimationFrame(refreshDrawCanvases);
    });
  }

  window.addEventListener("pageshow", scheduleCanvasRefresh);
  window.addEventListener("orientationchange", scheduleCanvasRefresh);
  document.addEventListener("visibilitychange", () => {
    if(!document.hidden) scheduleCanvasRefresh();
  });
  if(window.visualViewport){
    window.visualViewport.addEventListener("resize", scheduleCanvasRefresh);
  }
  document.querySelectorAll("details").forEach(detail => {
    detail.addEventListener("toggle", () => {
      if(detail.open) scheduleCanvasRefresh();
    });
  });

  function restoreFormState(){
    let raw = null;
    try { raw = localStorage.getItem(STORAGE_KEY); } catch(e) { raw = null; }
    if(!raw) return;
    let state = null;
    try { state = JSON.parse(raw); } catch(e){ state = null; }
    if(!state) return;
    const currentRooms = document.querySelectorAll(".room-card").length;
    const addRoomBtnLocal = document.querySelector(".add-room-btn");
    if(addRoomBtnLocal && state.roomCount && state.roomCount > currentRooms){
      for(let i = currentRooms; i < state.roomCount; i++){
        addRoomBtnLocal.click();
      }
    }
    const addWindowBtnLocal = document.querySelector(".add-window-btn");
    if(addWindowBtnLocal && state.windowCount){
      const currentWindows = document.querySelectorAll(".window-row").length;
      if(state.windowCount > currentWindows){
        for(let i = currentWindows; i < state.windowCount; i++){
          addWindowBtnLocal.click();
        }
      }
    }
    const addGaubeWindowBtnLocal = document.querySelector(".add-gaube-window-btn");
    if(addGaubeWindowBtnLocal && state.gaubeWindowCount){
      const currentGaubeWindows = document.querySelectorAll(".gaube-window-row").length;
      if(state.gaubeWindowCount > currentGaubeWindows){
        for(let i = currentGaubeWindows; i < state.gaubeWindowCount; i++){
          addGaubeWindowBtnLocal.click();
        }
      }
    }
    const addRoofWindowBtnLocal = document.querySelector(".add-roof-window-btn");
    if(addRoofWindowBtnLocal && state.roofWindowCount){
      const currentRoofWindows = document.querySelectorAll(".roof-window-row").length;
      if(state.roofWindowCount > currentRoofWindows){
        for(let i = currentRoofWindows; i < state.roofWindowCount; i++){
          addRoofWindowBtnLocal.click();
        }
      }
    }
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      const target = state.hkCounts ? state.hkCounts[String(idx + 1)] : null;
      if(!target) return;
      const stack = card.querySelector(".hk-stack");
      if(!stack) return;
      while(stack.querySelectorAll(".hk-card").length < target){
        addHeater(stack);
      }
    });
    const values = state.values || {};
    Object.keys(values).forEach(name => {
      const data = values[name];
      const els = document.querySelectorAll('[name="' + name + '"]');
      if(!els.length) return;
      if(data.type === "radio"){
        els.forEach(el => { el.checked = (el.value === data.value); });
        return;
      }
      if(data.type === "checkbox"){
        els.forEach(el => { el.checked = !!data.checked; });
        return;
      }
      els.forEach(el => {
        if(data.type === "hidden" && data.drawing){
          el.dataset.drawing = data.drawing;
          const canvas = findCanvasForHidden(el);
          if(canvas) drawDataUrl(canvas, data.drawing);
        } else if("value" in data){
          el.value = data.value;
        }
      });
    });
    toggleSurfaceHeating();
    updateLabels();
  }

  document.addEventListener("input", scheduleSave, true);
  document.addEventListener("change", scheduleSave, true);
  window.addEventListener("beforeunload", scheduleSave);

  function addHeater(stack){
    const heaters = stack.querySelectorAll(".hk-card");
    if(!heaters.length) return;
    const template = heaters[heaters.length - 1];
    const clone = template.cloneNode(true);
    const nextIndex = heaters.length + 1;
    const title = clone.querySelector("h3");
    if(title) title.textContent = "Heizk\u00f6rper " + nextIndex;
    clone.querySelectorAll("select").forEach(sel => sel.selectedIndex = 0);
    clone.querySelectorAll("input").forEach(inp => inp.value = "");
    clone.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    clone.querySelectorAll(".draw-wrap").forEach(wrap => wrap.remove());
    clone.querySelectorAll('input[type="hidden"][name$="Custom"]').forEach(inp => {
      delete inp.dataset.drawing;
      delete inp.dataset.drawEnhanced;
    });
    clone.querySelectorAll("select,input").forEach(el => {
      const name = el.getAttribute("name");
      if(!name) return;
      const match = name.match(/^(room\d+Hk[A-Za-z]+?)(\d+)$/);
      if(match) el.setAttribute("name", match[1] + nextIndex);
    });
    stack.appendChild(clone);
    attachBauformListeners(clone);
    setupDrawingInputs(clone);
    scheduleSave();
  }

  function enhanceStack(stack){
    if(!stack || stack.dataset.enhanced) return;
    stack.dataset.enhanced = "1";
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "add-hk-btn";
    btn.textContent = "+ Heizk\u00f6rper hinzuf\u00fcgen";
    btn.addEventListener("click", () => addHeater(stack));
    const parent = stack.parentNode;
    if(parent){
      parent.querySelectorAll(".add-hk-btn").forEach(x => x.remove());
      parent.appendChild(btn);
    }
  }

  document.querySelectorAll(".hk-stack").forEach(enhanceStack);

  function resetRoomCard(card, index){
    card.querySelectorAll(".add-hk-btn").forEach(btn => btn.remove());
    card.querySelectorAll(".hk-stack").forEach(stack => stack.removeAttribute("data-enhanced"));
    card.querySelectorAll("details").forEach(det => det.open = false);
    const label = card.querySelector("[data-room-label]");
    if(label){
      const small = label.querySelector("small");
      label.dataset.default = "Raum " + index;
      label.textContent = "";
      label.append(document.createTextNode("Raum " + index + " "));
      if(small) label.append(small);
    }
    card.querySelectorAll("input").forEach(inp => inp.value = "");
    card.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    card.querySelectorAll("select").forEach(sel => sel.selectedIndex = 0);
    card.querySelectorAll(".draw-wrap").forEach(wrap => wrap.remove());
    card.querySelectorAll('input[type="hidden"][name$="Custom"]').forEach(inp => {
      delete inp.dataset.drawing;
      delete inp.dataset.drawEnhanced;
    });
    card.querySelectorAll("h3").forEach((h3, i) => h3.textContent = "Heizk\u00f6rper " + (i + 1));
    card.querySelectorAll("[id]").forEach(el => {
      const id = el.id;
      if(id) el.id = id.replace(/room\d+/, "room" + index);
    });
    card.querySelectorAll("label[for]").forEach(lab => {
      if(lab.htmlFor) lab.htmlFor = lab.htmlFor.replace(/room\d+/, "room" + index);
    });
    card.querySelectorAll("[name]").forEach(el => {
      const name = el.getAttribute("name");
      if(name) el.setAttribute("name", name.replace(/room\d+/, "room" + index));
    });
  }

  const addRoomBtn = document.querySelector(".add-room-btn");
  const form = document.querySelector("form");
  const roomTemplate = document.querySelector(".room-card");
  if(addRoomBtn && form && roomTemplate){
    addRoomBtn.addEventListener("click", () => {
      const nextIndex = document.querySelectorAll(".room-card").length + 1;
      const clone = roomTemplate.cloneNode(true);
      resetRoomCard(clone, nextIndex);
      form.insertBefore(clone, addRoomBtn);
      attachRoomListeners(clone);
      clone.querySelectorAll(".hk-stack").forEach(enhanceStack);
      attachBauformListeners(clone);
      setupDrawingInputs(clone);
      updateLabels();
      scheduleSave();
    });
  }

  function resetWindowRow(row, index, sourceRow){
    row.dataset.windowIndex = String(index);
    row.querySelectorAll("[data-window-field]").forEach(el => {
      const base = el.getAttribute("data-window-field");
      if(!base) return;
      const nextId = base + index;
      el.id = nextId;
      el.name = nextId;
      if(el.tagName.toLowerCase() === "input" && el.type === "hidden"){
        el.dataset.drawing = "";
      }
      if(el.tagName.toLowerCase() === "select"){
        const sourceSelect = sourceRow
          ? sourceRow.querySelector('select[data-window-field="' + base + '"]')
          : null;
        el.value = sourceSelect ? sourceSelect.value : "";
      }
    });
    row.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
      const wrap = canvas.closest(".draw-wrap");
      const hidden = wrap ? wrap.querySelector("input[type=\"hidden\"][data-window-field]") : null;
      if(hidden){
        canvas.setAttribute("data-draw-target", hidden.id);
        const ctx = canvas.getContext("2d");
        if(ctx){
          resizeDrawCanvas(canvas, ctx);
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        initDrawCanvas(canvas, hidden);
      }
    });
  }

  const addWindowBtn = document.querySelector(".add-window-btn");
  if(addWindowBtn){
    addWindowBtn.addEventListener("click", () => {
      const tbody = document.querySelector(".window-table tbody");
      if(!tbody) return;
      const rows = tbody.querySelectorAll(".window-row");
      const nextIndex = rows.length + 1;
      const template = rows[0];
      if(!template) return;
      const lastRow = rows[rows.length - 1];
      const clone = template.cloneNode(true);
      tbody.appendChild(clone);
      resetWindowRow(clone, nextIndex, lastRow);
      scheduleSave();
    });
  }

  function resetGaubeWindowRow(row, index, sourceRow){
    row.dataset.gaubeWindowIndex = String(index);
    row.querySelectorAll("[data-gaube-window-field]").forEach(el => {
      const base = el.getAttribute("data-gaube-window-field");
      if(!base) return;
      const nextId = base + index;
      el.id = nextId;
      el.name = nextId;
      if(el.tagName.toLowerCase() === "input" && el.type === "hidden"){
        el.dataset.drawing = "";
      }
      if(el.tagName.toLowerCase() === "select"){
        const sourceSelect = sourceRow
          ? sourceRow.querySelector('select[data-gaube-window-field="' + base + '"]')
          : null;
        el.value = sourceSelect ? sourceSelect.value : "";
      }
    });
    row.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
      const wrap = canvas.closest(".draw-wrap");
      const hidden = wrap ? wrap.querySelector("input[type=\"hidden\"][data-gaube-window-field]") : null;
      if(hidden){
        canvas.setAttribute("data-draw-target", hidden.id);
        const ctx = canvas.getContext("2d");
        if(ctx){
          resizeDrawCanvas(canvas, ctx);
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        initDrawCanvas(canvas, hidden);
      }
    });
  }

  const addGaubeWindowBtn = document.querySelector(".add-gaube-window-btn");
  if(addGaubeWindowBtn){
    addGaubeWindowBtn.addEventListener("click", () => {
      const tbody = document.querySelector(".gaube-window-table tbody");
      if(!tbody) return;
      const rows = tbody.querySelectorAll(".gaube-window-row");
      const nextIndex = rows.length + 1;
      const template = rows[0];
      if(!template) return;
      const lastRow = rows[rows.length - 1];
      const clone = template.cloneNode(true);
      tbody.appendChild(clone);
      resetGaubeWindowRow(clone, nextIndex, lastRow);
      scheduleSave();
    });
  }

  function resetRoofWindowRow(row, index, sourceRow){
    row.dataset.roofWindowIndex = String(index);
    row.querySelectorAll("[data-roof-window-field]").forEach(el => {
      const base = el.getAttribute("data-roof-window-field");
      if(!base) return;
      const nextId = base + index;
      el.id = nextId;
      el.name = nextId;
      if(el.tagName.toLowerCase() === "input" && el.type === "hidden"){
        el.dataset.drawing = "";
      }
      if(el.tagName.toLowerCase() === "select"){
        const sourceSelect = sourceRow
          ? sourceRow.querySelector('select[data-roof-window-field="' + base + '"]')
          : null;
        el.value = sourceSelect ? sourceSelect.value : "";
      }
    });
    row.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
      const wrap = canvas.closest(".draw-wrap");
      const hidden = wrap ? wrap.querySelector("input[type=\"hidden\"][data-roof-window-field]") : null;
      if(hidden){
        canvas.setAttribute("data-draw-target", hidden.id);
        const ctx = canvas.getContext("2d");
        if(ctx){
          resizeDrawCanvas(canvas, ctx);
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        initDrawCanvas(canvas, hidden);
      }
    });
  }

  const addRoofWindowBtn = document.querySelector(".add-roof-window-btn");
  if(addRoofWindowBtn){
    addRoofWindowBtn.addEventListener("click", () => {
      const tbody = document.querySelector(".roof-window-table tbody");
      if(!tbody) return;
      const rows = tbody.querySelectorAll(".roof-window-row");
      const nextIndex = rows.length + 1;
      const template = rows[0];
      if(!template) return;
      const lastRow = rows[rows.length - 1];
      const clone = template.cloneNode(true);
      tbody.appendChild(clone);
      resetRoofWindowRow(clone, nextIndex, lastRow);
      scheduleSave();
    });
  }

  restoreFormState();
  toggleSurfaceHeating();
  toggleBuildingData();
  updateShareCache();

  function pickField(selectEl, customEl){
    const selectVal = selectEl && selectEl.value ? selectEl.value : "";
    if(selectVal) return { value: selectVal, draw: "" };
    const draw = customEl && customEl.dataset.drawing ? customEl.dataset.drawing : "";
    if(draw) return { value: "", draw };
    return { value: "", draw: "" };
  }

  function collectData(){
    const rooms = [];
    const surfaceHeating = document.querySelector('input[name="surfaceHeating"]:checked');
    const surfaceDetails = document.getElementById("surfaceHeatingDetails");
    const detailsOpen = surfaceDetails && !surfaceDetails.classList.contains("hidden");
    const addressNameDraw = (document.getElementById("addressNameDraw") || {}).dataset ? (document.getElementById("addressNameDraw").dataset.drawing || "") : "";
    const addressStreetDraw = (document.getElementById("addressStreetDraw") || {}).dataset ? (document.getElementById("addressStreetDraw").dataset.drawing || "") : "";
    const addressCityDraw = (document.getElementById("addressCityDraw") || {}).dataset ? (document.getElementById("addressCityDraw").dataset.drawing || "") : "";
    const addressPhoneDraw = (document.getElementById("addressPhoneDraw") || {}).dataset ? (document.getElementById("addressPhoneDraw").dataset.drawing || "") : "";
    const addressEmailDraw = (document.getElementById("addressEmailDraw") || {}).dataset ? (document.getElementById("addressEmailDraw").dataset.drawing || "") : "";
    const buildingData = (document.querySelector('input[name="buildingData"]:checked') || {}).value || "";
    const buildingStreetDraw = (document.getElementById("buildingStreetDraw") || {}).dataset ? (document.getElementById("buildingStreetDraw").dataset.drawing || "") : "";
    const buildingCityDraw = (document.getElementById("buildingCityDraw") || {}).dataset ? (document.getElementById("buildingCityDraw").dataset.drawing || "") : "";
    const buildingYearDraw = (document.getElementById("buildingYearDraw") || {}).dataset ? (document.getElementById("buildingYearDraw").dataset.drawing || "") : "";
    const buildingUnits = (document.getElementById("buildingUnits") || {}).value || "";
    const buildingTypeDetached = !!document.querySelector('input[name="buildingTypeDetached"]:checked');
    const buildingTypeMultiFamily = !!document.querySelector('input[name="buildingTypeMultiFamily"]:checked');
    const buildingTypeEndTerrace = !!document.querySelector('input[name="buildingTypeEndTerrace"]:checked');
    const buildingTypeMidTerrace = !!document.querySelector('input[name="buildingTypeMidTerrace"]:checked');
    const floorHeightBasementDraw = (document.getElementById("floorHeightBasementDraw") || {}).dataset ? (document.getElementById("floorHeightBasementDraw").dataset.drawing || "") : "";
    const floorHeightGroundDraw = (document.getElementById("floorHeightGroundDraw") || {}).dataset ? (document.getElementById("floorHeightGroundDraw").dataset.drawing || "") : "";
    const floorHeight1OgDraw = (document.getElementById("floorHeight1OgDraw") || {}).dataset ? (document.getElementById("floorHeight1OgDraw").dataset.drawing || "") : "";
    const floorHeight2OgDraw = (document.getElementById("floorHeight2OgDraw") || {}).dataset ? (document.getElementById("floorHeight2OgDraw").dataset.drawing || "") : "";
    const floorHeight3OgDraw = (document.getElementById("floorHeight3OgDraw") || {}).dataset ? (document.getElementById("floorHeight3OgDraw").dataset.drawing || "") : "";
    const floorHeightDgDraw = (document.getElementById("floorHeightDgDraw") || {}).dataset ? (document.getElementById("floorHeightDgDraw").dataset.drawing || "") : "";
    const structureMassive = !!document.querySelector('input[name="structureMassive"]:checked');
    const structureWooden = !!document.querySelector('input[name="structureWooden"]:checked');
    const basementHeated = (document.querySelector('input[name="basementHeated"]:checked') || {}).value || "";
    const notesDraw = (document.getElementById("notesDraw") || {}).dataset ? (document.getElementById("notesDraw").dataset.drawing || "") : "";
    const wallNorthL1Draw = (document.getElementById("wallNorthL1Draw") || {}).dataset ? (document.getElementById("wallNorthL1Draw").dataset.drawing || "") : "";
    const wallNorthL2Draw = (document.getElementById("wallNorthL2Draw") || {}).dataset ? (document.getElementById("wallNorthL2Draw").dataset.drawing || "") : "";
    const wallNorthL3Draw = (document.getElementById("wallNorthL3Draw") || {}).dataset ? (document.getElementById("wallNorthL3Draw").dataset.drawing || "") : "";
    const wallNorthL4Draw = (document.getElementById("wallNorthL4Draw") || {}).dataset ? (document.getElementById("wallNorthL4Draw").dataset.drawing || "") : "";
    const wallNorthL5Draw = (document.getElementById("wallNorthL5Draw") || {}).dataset ? (document.getElementById("wallNorthL5Draw").dataset.drawing || "") : "";
    const wallNorthTotalDraw = (document.getElementById("wallNorthTotalDraw") || {}).dataset ? (document.getElementById("wallNorthTotalDraw").dataset.drawing || "") : "";
    const wallEastL1Draw = (document.getElementById("wallEastL1Draw") || {}).dataset ? (document.getElementById("wallEastL1Draw").dataset.drawing || "") : "";
    const wallEastL2Draw = (document.getElementById("wallEastL2Draw") || {}).dataset ? (document.getElementById("wallEastL2Draw").dataset.drawing || "") : "";
    const wallEastL3Draw = (document.getElementById("wallEastL3Draw") || {}).dataset ? (document.getElementById("wallEastL3Draw").dataset.drawing || "") : "";
    const wallEastL4Draw = (document.getElementById("wallEastL4Draw") || {}).dataset ? (document.getElementById("wallEastL4Draw").dataset.drawing || "") : "";
    const wallEastL5Draw = (document.getElementById("wallEastL5Draw") || {}).dataset ? (document.getElementById("wallEastL5Draw").dataset.drawing || "") : "";
    const wallEastTotalDraw = (document.getElementById("wallEastTotalDraw") || {}).dataset ? (document.getElementById("wallEastTotalDraw").dataset.drawing || "") : "";
    const wallSouthL1Draw = (document.getElementById("wallSouthL1Draw") || {}).dataset ? (document.getElementById("wallSouthL1Draw").dataset.drawing || "") : "";
    const wallSouthL2Draw = (document.getElementById("wallSouthL2Draw") || {}).dataset ? (document.getElementById("wallSouthL2Draw").dataset.drawing || "") : "";
    const wallSouthL3Draw = (document.getElementById("wallSouthL3Draw") || {}).dataset ? (document.getElementById("wallSouthL3Draw").dataset.drawing || "") : "";
    const wallSouthL4Draw = (document.getElementById("wallSouthL4Draw") || {}).dataset ? (document.getElementById("wallSouthL4Draw").dataset.drawing || "") : "";
    const wallSouthL5Draw = (document.getElementById("wallSouthL5Draw") || {}).dataset ? (document.getElementById("wallSouthL5Draw").dataset.drawing || "") : "";
    const wallSouthTotalDraw = (document.getElementById("wallSouthTotalDraw") || {}).dataset ? (document.getElementById("wallSouthTotalDraw").dataset.drawing || "") : "";
    const wallWestL1Draw = (document.getElementById("wallWestL1Draw") || {}).dataset ? (document.getElementById("wallWestL1Draw").dataset.drawing || "") : "";
    const wallWestL2Draw = (document.getElementById("wallWestL2Draw") || {}).dataset ? (document.getElementById("wallWestL2Draw").dataset.drawing || "") : "";
    const wallWestL3Draw = (document.getElementById("wallWestL3Draw") || {}).dataset ? (document.getElementById("wallWestL3Draw").dataset.drawing || "") : "";
    const wallWestL4Draw = (document.getElementById("wallWestL4Draw") || {}).dataset ? (document.getElementById("wallWestL4Draw").dataset.drawing || "") : "";
    const wallWestL5Draw = (document.getElementById("wallWestL5Draw") || {}).dataset ? (document.getElementById("wallWestL5Draw").dataset.drawing || "") : "";
    const wallWestTotalDraw = (document.getElementById("wallWestTotalDraw") || {}).dataset ? (document.getElementById("wallWestTotalDraw").dataset.drawing || "") : "";
    const wallNotesDraw = (document.getElementById("wallNotesDraw") || {}).dataset ? (document.getElementById("wallNotesDraw").dataset.drawing || "") : "";
    const notesLargeDraw = (document.getElementById("notesLargeDraw") || {}).dataset ? (document.getElementById("notesLargeDraw").dataset.drawing || "") : "";
    const gaubeWindows = collectGaubeWindowsFromDom();
    const roofWindows = collectRoofWindowsFromDom();
    const solarYearDraw = (document.getElementById("solarYearDraw") || {}).dataset ? (document.getElementById("solarYearDraw").dataset.drawing || "") : "";
    const solarStorageDraw = (document.getElementById("solarStorageDraw") || {}).dataset ? (document.getElementById("solarStorageDraw").dataset.drawing || "") : "";
    const solarPumpDraw = (document.getElementById("solarPumpDraw") || {}).dataset ? (document.getElementById("solarPumpDraw").dataset.drawing || "") : "";
    const solarModulesDraw = (document.getElementById("solarModulesDraw") || {}).dataset ? (document.getElementById("solarModulesDraw").dataset.drawing || "") : "";
    const solarModulesAreaDraw = (document.getElementById("solarModulesAreaDraw") || {}).dataset ? (document.getElementById("solarModulesAreaDraw").dataset.drawing || "") : "";
    const solarOrientation = ((document.getElementById("solarOrientation") || {}).value || "").trim();
    const solarCollectorType = ((document.getElementById("solarCollectorType") || {}).value || "").trim();
    const pvModulesDraw = (document.getElementById("pvModulesDraw") || {}).dataset ? (document.getElementById("pvModulesDraw").dataset.drawing || "") : "";
    const pvModulesAreaDraw = (document.getElementById("pvModulesAreaDraw") || {}).dataset ? (document.getElementById("pvModulesAreaDraw").dataset.drawing || "") : "";
    const pvPowerDraw = (document.getElementById("pvPowerDraw") || {}).dataset ? (document.getElementById("pvPowerDraw").dataset.drawing || "") : "";
    const pvVentilation = ((document.getElementById("pvVentilation") || {}).value || "").trim();
    const pvOrientation = ((document.getElementById("pvOrientation") || {}).value || "").trim();
    const pvBatteryDraw = (document.getElementById("pvBatteryDraw") || {}).dataset ? (document.getElementById("pvBatteryDraw").dataset.drawing || "") : "";
    const ogdStructure = ((document.getElementById("ogdStructure") || {}).value || "").trim();
    const ogdStructureDraw = (document.getElementById("ogdStructureDraw") || {}).dataset ? (document.getElementById("ogdStructureDraw").dataset.drawing || "") : "";
    const ogdInsulationDraw = (document.getElementById("ogdInsulationDraw") || {}).dataset ? (document.getElementById("ogdInsulationDraw").dataset.drawing || "") : "";
    const roofTypeSatteldach = !!document.querySelector('input[name="roofTypeSatteldach"]:checked');
    const roofTypeWalmdach = !!document.querySelector('input[name="roofTypeWalmdach"]:checked');
    const roofTypeKruppelwalmdach = !!document.querySelector('input[name="roofTypeKruppelwalmdach"]:checked');
    const roofTypeMansardendach = !!document.querySelector('input[name="roofTypeMansardendach"]:checked');
    const roofTypePultdach = !!document.querySelector('input[name="roofTypePultdach"]:checked');
    const roofTypeFlachdach = !!document.querySelector('input[name="roofTypeFlachdach"]:checked');
    const roofTypeSheddach = !!document.querySelector('input[name="roofTypeSheddach"]:checked');
    const roofDepthDraw = (document.getElementById("roofDepthDraw") || {}).dataset ? (document.getElementById("roofDepthDraw").dataset.drawing || "") : "";
    const roofWidthDraw = (document.getElementById("roofWidthDraw") || {}).dataset ? (document.getElementById("roofWidthDraw").dataset.drawing || "") : "";
    const roofSpacingDraw = (document.getElementById("roofSpacingDraw") || {}).dataset ? (document.getElementById("roofSpacingDraw").dataset.drawing || "") : "";
    const roofAngleDraw = (document.getElementById("roofAngleDraw") || {}).dataset ? (document.getElementById("roofAngleDraw").dataset.drawing || "") : "";
    const roofDepthDraw2 = (document.getElementById("roofDepthDraw2") || {}).dataset ? (document.getElementById("roofDepthDraw2").dataset.drawing || "") : "";
    const roofWidthDraw2 = (document.getElementById("roofWidthDraw2") || {}).dataset ? (document.getElementById("roofWidthDraw2").dataset.drawing || "") : "";
    const roofSpacingDraw2 = (document.getElementById("roofSpacingDraw2") || {}).dataset ? (document.getElementById("roofSpacingDraw2").dataset.drawing || "") : "";
    const roofAngleDraw2 = (document.getElementById("roofAngleDraw2") || {}).dataset ? (document.getElementById("roofAngleDraw2").dataset.drawing || "") : "";
    const roofInsulationDraw = (document.getElementById("roofInsulationDraw") || {}).dataset ? (document.getElementById("roofInsulationDraw").dataset.drawing || "") : "";
    const annexExists = ((document.querySelector('input[name="annexExists"]:checked') || {}).value || "").trim();
    const annexYearDraw = (document.getElementById("annexYearDraw") || {}).dataset ? (document.getElementById("annexYearDraw").dataset.drawing || "") : "";
    const annexType = ((document.getElementById("annexType") || {}).value || "").trim();
    const annexWallNorthL1Draw = (document.getElementById("annexWallNorthL1Draw") || {}).dataset ? (document.getElementById("annexWallNorthL1Draw").dataset.drawing || "") : "";
    const annexWallNorthL2Draw = (document.getElementById("annexWallNorthL2Draw") || {}).dataset ? (document.getElementById("annexWallNorthL2Draw").dataset.drawing || "") : "";
    const annexWallNorthL3Draw = (document.getElementById("annexWallNorthL3Draw") || {}).dataset ? (document.getElementById("annexWallNorthL3Draw").dataset.drawing || "") : "";
    const annexWallNorthL4Draw = (document.getElementById("annexWallNorthL4Draw") || {}).dataset ? (document.getElementById("annexWallNorthL4Draw").dataset.drawing || "") : "";
    const annexWallNorthL5Draw = (document.getElementById("annexWallNorthL5Draw") || {}).dataset ? (document.getElementById("annexWallNorthL5Draw").dataset.drawing || "") : "";
    const annexWallNorthTotalDraw = (document.getElementById("annexWallNorthTotalDraw") || {}).dataset ? (document.getElementById("annexWallNorthTotalDraw").dataset.drawing || "") : "";
    const annexWallEastL1Draw = (document.getElementById("annexWallEastL1Draw") || {}).dataset ? (document.getElementById("annexWallEastL1Draw").dataset.drawing || "") : "";
    const annexWallEastL2Draw = (document.getElementById("annexWallEastL2Draw") || {}).dataset ? (document.getElementById("annexWallEastL2Draw").dataset.drawing || "") : "";
    const annexWallEastL3Draw = (document.getElementById("annexWallEastL3Draw") || {}).dataset ? (document.getElementById("annexWallEastL3Draw").dataset.drawing || "") : "";
    const annexWallEastL4Draw = (document.getElementById("annexWallEastL4Draw") || {}).dataset ? (document.getElementById("annexWallEastL4Draw").dataset.drawing || "") : "";
    const annexWallEastL5Draw = (document.getElementById("annexWallEastL5Draw") || {}).dataset ? (document.getElementById("annexWallEastL5Draw").dataset.drawing || "") : "";
    const annexWallEastTotalDraw = (document.getElementById("annexWallEastTotalDraw") || {}).dataset ? (document.getElementById("annexWallEastTotalDraw").dataset.drawing || "") : "";
    const annexWallSouthL1Draw = (document.getElementById("annexWallSouthL1Draw") || {}).dataset ? (document.getElementById("annexWallSouthL1Draw").dataset.drawing || "") : "";
    const annexWallSouthL2Draw = (document.getElementById("annexWallSouthL2Draw") || {}).dataset ? (document.getElementById("annexWallSouthL2Draw").dataset.drawing || "") : "";
    const annexWallSouthL3Draw = (document.getElementById("annexWallSouthL3Draw") || {}).dataset ? (document.getElementById("annexWallSouthL3Draw").dataset.drawing || "") : "";
    const annexWallSouthL4Draw = (document.getElementById("annexWallSouthL4Draw") || {}).dataset ? (document.getElementById("annexWallSouthL4Draw").dataset.drawing || "") : "";
    const annexWallSouthL5Draw = (document.getElementById("annexWallSouthL5Draw") || {}).dataset ? (document.getElementById("annexWallSouthL5Draw").dataset.drawing || "") : "";
    const annexWallSouthTotalDraw = (document.getElementById("annexWallSouthTotalDraw") || {}).dataset ? (document.getElementById("annexWallSouthTotalDraw").dataset.drawing || "") : "";
    const annexWallWestL1Draw = (document.getElementById("annexWallWestL1Draw") || {}).dataset ? (document.getElementById("annexWallWestL1Draw").dataset.drawing || "") : "";
    const annexWallWestL2Draw = (document.getElementById("annexWallWestL2Draw") || {}).dataset ? (document.getElementById("annexWallWestL2Draw").dataset.drawing || "") : "";
    const annexWallWestL3Draw = (document.getElementById("annexWallWestL3Draw") || {}).dataset ? (document.getElementById("annexWallWestL3Draw").dataset.drawing || "") : "";
    const annexWallWestL4Draw = (document.getElementById("annexWallWestL4Draw") || {}).dataset ? (document.getElementById("annexWallWestL4Draw").dataset.drawing || "") : "";
    const annexWallWestL5Draw = (document.getElementById("annexWallWestL5Draw") || {}).dataset ? (document.getElementById("annexWallWestL5Draw").dataset.drawing || "") : "";
    const annexWallWestTotalDraw = (document.getElementById("annexWallWestTotalDraw") || {}).dataset ? (document.getElementById("annexWallWestTotalDraw").dataset.drawing || "") : "";
    const annexRoofTypeSatteldach = !!document.querySelector('input[name="annexRoofTypeSatteldach"]:checked');
    const annexRoofTypeWalmdach = !!document.querySelector('input[name="annexRoofTypeWalmdach"]:checked');
    const annexRoofTypeKruppelwalmdach = !!document.querySelector('input[name="annexRoofTypeKruppelwalmdach"]:checked');
    const annexRoofTypeMansardendach = !!document.querySelector('input[name="annexRoofTypeMansardendach"]:checked');
    const annexRoofTypePultdach = !!document.querySelector('input[name="annexRoofTypePultdach"]:checked');
    const annexRoofTypeFlachdach = !!document.querySelector('input[name="annexRoofTypeFlachdach"]:checked');
    const annexRoofTypeSheddach = !!document.querySelector('input[name="annexRoofTypeSheddach"]:checked');
    const annexRoofDepthDraw = (document.getElementById("annexRoofDepthDraw") || {}).dataset ? (document.getElementById("annexRoofDepthDraw").dataset.drawing || "") : "";
    const annexRoofWidthDraw = (document.getElementById("annexRoofWidthDraw") || {}).dataset ? (document.getElementById("annexRoofWidthDraw").dataset.drawing || "") : "";
    const annexRoofSpacingDraw = (document.getElementById("annexRoofSpacingDraw") || {}).dataset ? (document.getElementById("annexRoofSpacingDraw").dataset.drawing || "") : "";
    const annexRoofAngleDraw = (document.getElementById("annexRoofAngleDraw") || {}).dataset ? (document.getElementById("annexRoofAngleDraw").dataset.drawing || "") : "";
    const annexRoofDepthDraw2 = (document.getElementById("annexRoofDepthDraw2") || {}).dataset ? (document.getElementById("annexRoofDepthDraw2").dataset.drawing || "") : "";
    const annexRoofWidthDraw2 = (document.getElementById("annexRoofWidthDraw2") || {}).dataset ? (document.getElementById("annexRoofWidthDraw2").dataset.drawing || "") : "";
    const annexRoofSpacingDraw2 = (document.getElementById("annexRoofSpacingDraw2") || {}).dataset ? (document.getElementById("annexRoofSpacingDraw2").dataset.drawing || "") : "";
    const annexRoofAngleDraw2 = (document.getElementById("annexRoofAngleDraw2") || {}).dataset ? (document.getElementById("annexRoofAngleDraw2").dataset.drawing || "") : "";
    const annexRoofInsulationDraw = (document.getElementById("annexRoofInsulationDraw") || {}).dataset ? (document.getElementById("annexRoofInsulationDraw").dataset.drawing || "") : "";
    const systemManufacturer = (document.getElementById("systemManufacturer") || {}).value || "";
    const systemManufacturerDraw = (document.getElementById("systemManufacturerDraw") || {}).dataset ? (document.getElementById("systemManufacturerDraw").dataset.drawing || "") : "";
    const systemTypeDraw = (document.getElementById("systemTypeDraw") || {}).dataset ? (document.getElementById("systemTypeDraw").dataset.drawing || "") : "";
    const systemPowerDraw = (document.getElementById("systemPowerDraw") || {}).dataset ? (document.getElementById("systemPowerDraw").dataset.drawing || "") : "";
    const systemYear = (document.getElementById("systemYear") || {}).value || "";
    const systemFuel = (document.getElementById("systemFuel") || {}).value || "";
    const systemLocation = (document.getElementById("systemLocation") || {}).value || "";
    const heatDistribution = (document.getElementById("heatDistribution") || {}).value || "";
    const pipeInsulation = (document.getElementById("pipeInsulation") || {}).value || "";
    const pumpCirculationDraw = (document.getElementById("pumpCirculationDraw") || {}).dataset ? (document.getElementById("pumpCirculationDraw").dataset.drawing || "") : "";
    const pumpCirculationHe = !!document.querySelector('input[name="pumpCirculationHe"]:checked');
    const pumpCirculationStf = (document.getElementById("pumpCirculationStf") || {}).value || "";
    const pumpStorageDraw = (document.getElementById("pumpStorageDraw") || {}).dataset ? (document.getElementById("pumpStorageDraw").dataset.drawing || "") : "";
    const pumpStorageHe = !!document.querySelector('input[name="pumpStorageHe"]:checked');
    const pumpStorageStf = (document.getElementById("pumpStorageStf") || {}).value || "";
    const pumpRecircDraw = (document.getElementById("pumpRecircDraw") || {}).dataset ? (document.getElementById("pumpRecircDraw").dataset.drawing || "") : "";
    const pumpRecircHe = !!document.querySelector('input[name="pumpRecircHe"]:checked');
    const pumpRecircStf = (document.getElementById("pumpRecircStf") || {}).value || "";
    const optionNightReduction = !!document.querySelector('input[name="optionNightReduction"]:checked');
    const optionHydraulicBalance = !!document.querySelector('input[name="optionHydraulicBalance"]:checked');
    const optionHeaterNiches = !!document.querySelector('input[name="optionHeaterNiches"]:checked');
    const optionCirculationTimed = !!document.querySelector('input[name="optionCirculationTimed"]:checked');
    const systemThermostatValves = (document.getElementById("systemThermostatValves") || {}).value || "";
    const system = {
      addressNameDraw,
      addressStreetDraw,
      addressCityDraw,
      addressPhoneDraw,
      addressEmailDraw,
      buildingData,
      buildingStreetDraw,
      buildingCityDraw,
      buildingYearDraw,
      buildingUnits,
      buildingTypeDetached,
      buildingTypeMultiFamily,
      buildingTypeEndTerrace,
      buildingTypeMidTerrace,
      floorHeightBasementDraw,
      floorHeightGroundDraw,
      floorHeight1OgDraw,
      floorHeight2OgDraw,
      floorHeight3OgDraw,
      floorHeightDgDraw,
      structureMassive,
      structureWooden,
      basementHeated,
      notesDraw,
      wallNorthL1Draw,
      wallNorthL2Draw,
      wallNorthL3Draw,
      wallNorthL4Draw,
      wallNorthL5Draw,
      wallNorthTotalDraw,
      wallEastL1Draw,
      wallEastL2Draw,
      wallEastL3Draw,
      wallEastL4Draw,
      wallEastL5Draw,
      wallEastTotalDraw,
      wallSouthL1Draw,
      wallSouthL2Draw,
      wallSouthL3Draw,
      wallSouthL4Draw,
      wallSouthL5Draw,
      wallSouthTotalDraw,
      wallWestL1Draw,
      wallWestL2Draw,
      wallWestL3Draw,
      wallWestL4Draw,
      wallWestL5Draw,
      wallWestTotalDraw,
      wallNotesDraw,
      notesLargeDraw,
      gaubes: collectGaubesFromDom(),
      windows: collectWindowsFromDom(),
      gaubeWindows,
      roofWindows,
      solarYearDraw,
      solarStorageDraw,
      solarPumpDraw,
      solarModulesDraw,
      solarModulesAreaDraw,
      solarOrientation,
      solarCollectorType,
      pvModulesDraw,
      pvModulesAreaDraw,
      pvPowerDraw,
      pvVentilation,
      pvOrientation,
      pvBatteryDraw,
      ogdStructure,
      ogdStructureDraw,
      ogdInsulationDraw,
      roofTypeSatteldach: !!document.querySelector('input[name="roofTypeSatteldach"]:checked'),
      roofTypeWalmdach: !!document.querySelector('input[name="roofTypeWalmdach"]:checked'),
      roofTypeKruppelwalmdach: !!document.querySelector('input[name="roofTypeKruppelwalmdach"]:checked'),
      roofTypeMansardendach: !!document.querySelector('input[name="roofTypeMansardendach"]:checked'),
      roofTypePultdach: !!document.querySelector('input[name="roofTypePultdach"]:checked'),
      roofTypeFlachdach: !!document.querySelector('input[name="roofTypeFlachdach"]:checked'),
      roofTypeSheddach: !!document.querySelector('input[name="roofTypeSheddach"]:checked'),
      roofDepthDraw,
      roofWidthDraw,
      roofSpacingDraw,
      roofAngleDraw,
      roofDepthDraw2,
      roofWidthDraw2,
      roofSpacingDraw2,
      roofAngleDraw2,
      roofInsulationDraw,
      annexExists: ((document.querySelector('input[name="annexExists"]:checked') || {}).value || "").trim(),
      annexYearDraw,
      annexType,
      annexWallNorthL1Draw,
      annexWallNorthL2Draw,
      annexWallNorthL3Draw,
      annexWallNorthL4Draw,
      annexWallNorthL5Draw,
      annexWallNorthTotalDraw,
      annexWallEastL1Draw,
      annexWallEastL2Draw,
      annexWallEastL3Draw,
      annexWallEastL4Draw,
      annexWallEastL5Draw,
      annexWallEastTotalDraw,
      annexWallSouthL1Draw,
      annexWallSouthL2Draw,
      annexWallSouthL3Draw,
      annexWallSouthL4Draw,
      annexWallSouthL5Draw,
      annexWallSouthTotalDraw,
      annexWallWestL1Draw,
      annexWallWestL2Draw,
      annexWallWestL3Draw,
      annexWallWestL4Draw,
      annexWallWestL5Draw,
      annexWallWestTotalDraw,
      annexRoofTypeSatteldach: !!document.querySelector('input[name="annexRoofTypeSatteldach"]:checked'),
      annexRoofTypeWalmdach: !!document.querySelector('input[name="annexRoofTypeWalmdach"]:checked'),
      annexRoofTypeKruppelwalmdach: !!document.querySelector('input[name="annexRoofTypeKruppelwalmdach"]:checked'),
      annexRoofTypeMansardendach: !!document.querySelector('input[name="annexRoofTypeMansardendach"]:checked'),
      annexRoofTypePultdach: !!document.querySelector('input[name="annexRoofTypePultdach"]:checked'),
      annexRoofTypeFlachdach: !!document.querySelector('input[name="annexRoofTypeFlachdach"]:checked'),
      annexRoofTypeSheddach: !!document.querySelector('input[name="annexRoofTypeSheddach"]:checked'),
      annexRoofDepthDraw,
      annexRoofWidthDraw,
      annexRoofSpacingDraw,
      annexRoofAngleDraw,
      annexRoofDepthDraw2,
      annexRoofWidthDraw2,
      annexRoofSpacingDraw2,
      annexRoofAngleDraw2,
      annexRoofInsulationDraw,
      surfaceHeating: surfaceHeating ? surfaceHeating.value : (detailsOpen ? "Ja" : ""),
      distributorPhoto: !!document.querySelector('input[name="surfaceHeatingDistributorPhoto"]:checked'),
      distributorDn: (document.getElementById("distributorDn") || {}).value || "",
      layingSpacing: (document.getElementById("layingSpacing") || {}).value || ""
      ,
      fbhLineDiameter: (document.getElementById("fBHLineDiameter") || {}).value || "",
      heatingCircuits: (document.getElementById("heatingCircuits") || {}).value || "",
      systemManufacturer,
      systemManufacturerDraw,
      systemTypeDraw,
      systemPowerDraw,
      systemYear,
      systemFuel,
      systemLocation,
      heatDistribution,
      pipeInsulation,
      optionNightReduction,
      optionHydraulicBalance,
      optionHeaterNiches,
      optionCirculationTimed,
      systemThermostatValves,
      pumpCirculationDraw,
      pumpCirculationHe,
      pumpCirculationStf,
      pumpStorageDraw,
      pumpStorageHe,
      pumpStorageStf,
      pumpRecircDraw,
      pumpRecircHe,
      pumpRecircStf
    };
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      const roomSel = card.querySelector('select[name$="Name"]');
      const floorSel = card.querySelector('select[name$="Floor"]');
      const roomName = roomSel ? roomSel.value.trim() : "";
      const floor = floorSel ? floorSel.value.trim() : "";
      const heaters = [];
      card.querySelectorAll(".hk-card").forEach(hk => {
        const formChecked = hk.querySelector('input[type="radio"][name*="HkForm"]:checked');
        const formText = formChecked && formChecked.parentElement ? formChecked.parentElement.textContent : "";
        const bauform = /Rippen/i.test(formText) ? "Rippen" : (/Platte/i.test(formText) ? "Platte" : "");
        const typeSel = hk.querySelector('select[name*="HkType"]');
        const typeCustom = hk.querySelector('input[name*="HkType"]');
        const heightSel = hk.querySelector('select[name*="HkHeight"]');
        const heightCustom = hk.querySelector('input[name*="HkHeight"]');
        const widthSel = hk.querySelector('select[name*="HkWidth"]');
        const widthCustom = hk.querySelector('input[name*="HkWidth"]');
        const dnSel = hk.querySelector('select[name*="HkDn"]');
        const dnCustom = hk.querySelector('input[name*="HkDn"]');
        const typeField = pickField(typeSel, typeCustom);
        const heightField = pickField(heightSel, heightCustom);
        const widthField = pickField(widthSel, widthCustom);
        const dnField = pickField(dnSel, dnCustom);
        const entry = {
          bauform,
          type: typeField.value,
          typeDraw: typeField.draw,
          height: heightField.value,
          heightDraw: heightField.draw,
          width: widthField.value,
          widthDraw: widthField.draw,
          dn: dnField.value,
          dnDraw: dnField.draw
        };
        const hasData = !!(entry.type || entry.typeDraw || entry.height || entry.heightDraw || entry.width || entry.widthDraw || entry.dn || entry.dnDraw);
        if(hasData) heaters.push(entry);
      });
      if(roomName || floor || heaters.length){
        rooms.push({ index: idx + 1, roomName, floor, heaters });
      }
    });
    return { system, rooms, detailsOpen };
  }

  function collectWindowsFromDom(){
    const windows = [];
    const readDraw = (row, field) => {
      const hidden = row.querySelector('input[type="hidden"][data-window-field="' + field + '"]');
      return hidden && hidden.dataset ? (hidden.dataset.drawing || "") : "";
    };
    document.querySelectorAll(".window-row").forEach(row => {
      const hr = (row.querySelector('select[data-window-field="windowHr"]') || {}).value || "";
      const vg = (row.querySelector('select[data-window-field="windowVg"]') || {}).value || "";
      const material = (row.querySelector('select[data-window-field="windowMaterial"]') || {}).value || "";
      const roomDraw = readDraw(row, "windowRoomDraw");
      const sizeDraw = readDraw(row, "windowSizeDraw");
      const yearDraw = readDraw(row, "windowYearDraw");
      windows.push({ hr, roomDraw, vg, material, sizeDraw, yearDraw });
    });
    return windows;
  }

  function collectGaubeWindowsFromDom(){
    const windows = [];
    const readDraw = (row, field) => {
      const hidden = row.querySelector('input[type="hidden"][data-gaube-window-field="' + field + '"]');
      return hidden && hidden.dataset ? (hidden.dataset.drawing || "") : "";
    };
    document.querySelectorAll(".gaube-window-row").forEach(row => {
      const hr = (row.querySelector('select[data-gaube-window-field="gaubeWindowHr"]') || {}).value || "";
      const vg = (row.querySelector('select[data-gaube-window-field="gaubeWindowVg"]') || {}).value || "";
      const material = (row.querySelector('select[data-gaube-window-field="gaubeWindowMaterial"]') || {}).value || "";
      const roomDraw = readDraw(row, "gaubeWindowRoomDraw");
      const sizeDraw = readDraw(row, "gaubeWindowSizeDraw");
      const yearDraw = readDraw(row, "gaubeWindowYearDraw");
      windows.push({ hr, roomDraw, vg, material, sizeDraw, yearDraw });
    });
    return windows;
  }

  function collectRoofWindowsFromDom(){
    const windows = [];
    const readDraw = (row, field) => {
      const hidden = row.querySelector('input[type="hidden"][data-roof-window-field="' + field + '"]');
      return hidden && hidden.dataset ? (hidden.dataset.drawing || "") : "";
    };
    document.querySelectorAll(".roof-window-row").forEach(row => {
      const hr = (row.querySelector('select[data-roof-window-field="roofWindowHr"]') || {}).value || "";
      const vg = (row.querySelector('select[data-roof-window-field="roofWindowVg"]') || {}).value || "";
      const material = (row.querySelector('select[data-roof-window-field="roofWindowMaterial"]') || {}).value || "";
      const roomDraw = readDraw(row, "roofWindowRoomDraw");
      const sizeDraw = readDraw(row, "roofWindowSizeDraw");
      const yearDraw = readDraw(row, "roofWindowYearDraw");
      windows.push({ hr, roomDraw, vg, material, sizeDraw, yearDraw });
    });
    return windows;
  }

  function hasWindowData(windows){
    if(!Array.isArray(windows)) return false;
    return windows.some(entry => entry && (
      entry.hr || entry.vg || entry.material || entry.roomDraw || entry.sizeDraw || entry.yearDraw
    ));
  }

  function collectGaubesFromDom(){
    const gaubes = [];
    const readDrawById = id => {
      const hidden = document.getElementById(id);
      return hidden && hidden.dataset ? (hidden.dataset.drawing || "") : "";
    };
    for(let i = 1; i <= 4; i++){
      const hr = ((document.getElementById("gaube" + i + "Hr") || {}).value || "").trim();
      const angle = ((document.getElementById("gaube" + i + "Angle") || {}).value || "").trim();
      const widthDraw = readDrawById("gaube" + i + "WidthDraw");
      const heightDraw = readDrawById("gaube" + i + "HeightDraw");
      gaubes.push({ hr, widthDraw, heightDraw, angle });
    }
    return gaubes;
  }

  function hasGaubeData(gaubes){
    if(!Array.isArray(gaubes)) return false;
    return gaubes.some(entry => entry && (
      entry.hr || entry.angle || entry.widthDraw || entry.heightDraw
    ));
  }

  function hasAnyData(data){
    if(!data) return false;
    const system = data.system || {};
    return !!(
      data.rooms.length ||
      system.addressNameDraw || system.addressStreetDraw ||
      system.addressCityDraw || system.buildingData ||
      system.buildingStreetDraw || system.buildingCityDraw ||
      system.buildingYearDraw || system.buildingUnits ||
      system.buildingTypeDetached || system.buildingTypeMultiFamily ||
      system.buildingTypeEndTerrace || system.buildingTypeMidTerrace ||
      system.floorHeightBasementDraw || system.floorHeightGroundDraw ||
      system.floorHeight1OgDraw || system.floorHeight2OgDraw ||
      system.floorHeight3OgDraw || system.floorHeightDgDraw ||
      system.structureMassive || system.structureWooden ||
      system.basementHeated ||
      system.notesDraw ||
      system.wallNorthL1Draw || system.wallNorthL2Draw ||
      system.wallNorthL3Draw || system.wallNorthL4Draw ||
      system.wallNorthL5Draw || system.wallNorthTotalDraw ||
      system.wallEastL1Draw || system.wallEastL2Draw ||
      system.wallEastL3Draw || system.wallEastL4Draw ||
      system.wallEastL5Draw || system.wallEastTotalDraw ||
      system.wallSouthL1Draw || system.wallSouthL2Draw ||
      system.wallSouthL3Draw || system.wallSouthL4Draw ||
      system.wallSouthL5Draw || system.wallSouthTotalDraw ||
      system.wallWestL1Draw || system.wallWestL2Draw ||
      system.wallWestL3Draw || system.wallWestL4Draw ||
      system.wallWestL5Draw || system.wallWestTotalDraw ||
      system.wallNotesDraw ||
      system.notesLargeDraw ||
      hasWindowData(system.windows) ||
      hasWindowData(system.gaubeWindows) ||
      hasWindowData(system.roofWindows) ||
      hasGaubeData(system.gaubes) ||
      system.addressPhoneDraw || system.addressEmailDraw ||
      system.systemManufacturer || system.systemManufacturerDraw ||
      system.systemTypeDraw ||
      system.systemPowerDraw ||
      system.systemYear || system.systemFuel || system.systemLocation || system.heatDistribution || system.pipeInsulation ||
      system.optionNightReduction || system.optionHydraulicBalance || system.optionHeaterNiches || system.optionCirculationTimed ||
      system.systemThermostatValves ||
      system.surfaceHeating || system.distributorPhoto ||
      system.heatingCircuits || system.distributorDn ||
      system.layingSpacing || system.fbhLineDiameter ||
      system.pumpCirculationDraw || system.pumpCirculationHe || system.pumpCirculationStf ||
      system.pumpStorageDraw || system.pumpStorageHe || system.pumpStorageStf ||
      system.pumpRecircDraw || system.pumpRecircHe || system.pumpRecircStf ||
      system.solarYearDraw || system.solarStorageDraw || system.solarPumpDraw ||
      system.solarModulesDraw || system.solarModulesAreaDraw || system.solarOrientation || system.solarCollectorType ||
      system.pvModulesDraw || system.pvModulesAreaDraw || system.pvPowerDraw ||
      system.pvVentilation || system.pvOrientation || system.pvBatteryDraw ||
      system.ogdStructure || system.ogdStructureDraw || system.ogdInsulationDraw ||
      system.roofTypeSatteldach || system.roofTypeWalmdach || system.roofTypeKruppelwalmdach ||
      system.roofTypeMansardendach || system.roofTypePultdach || system.roofTypeFlachdach || system.roofTypeSheddach ||
      system.roofDepthDraw || system.roofWidthDraw || system.roofSpacingDraw || system.roofAngleDraw ||
      system.roofDepthDraw2 || system.roofWidthDraw2 || system.roofSpacingDraw2 || system.roofAngleDraw2 ||
      system.roofInsulationDraw ||
      system.annexExists || system.annexYearDraw || system.annexType ||
      system.annexWallNorthL1Draw || system.annexWallNorthL2Draw || system.annexWallNorthL3Draw ||
      system.annexWallNorthL4Draw || system.annexWallNorthL5Draw || system.annexWallNorthTotalDraw ||
      system.annexWallEastL1Draw || system.annexWallEastL2Draw || system.annexWallEastL3Draw ||
      system.annexWallEastL4Draw || system.annexWallEastL5Draw || system.annexWallEastTotalDraw ||
      system.annexWallSouthL1Draw || system.annexWallSouthL2Draw || system.annexWallSouthL3Draw ||
      system.annexWallSouthL4Draw || system.annexWallSouthL5Draw || system.annexWallSouthTotalDraw ||
      system.annexWallWestL1Draw || system.annexWallWestL2Draw || system.annexWallWestL3Draw ||
      system.annexWallWestL4Draw || system.annexWallWestL5Draw || system.annexWallWestTotalDraw ||
      system.annexRoofTypeSatteldach || system.annexRoofTypeWalmdach || system.annexRoofTypeKruppelwalmdach ||
      system.annexRoofTypeMansardendach || system.annexRoofTypePultdach || system.annexRoofTypeFlachdach ||
      system.annexRoofTypeSheddach ||
      system.annexRoofDepthDraw || system.annexRoofWidthDraw || system.annexRoofSpacingDraw || system.annexRoofAngleDraw ||
      system.annexRoofDepthDraw2 || system.annexRoofWidthDraw2 || system.annexRoofSpacingDraw2 || system.annexRoofAngleDraw2 ||
      system.annexRoofInsulationDraw
    );
  }

  function isValidDraw(draw){
    return typeof draw === "string" && draw.startsWith("data:image/");
  }

  function renderCell(value, draw){
    if(isValidDraw(draw)) return '<img class="draw-img" src="' + draw + '" alt="Zeichnung">';
    return value || "";
  }

  function renderPrint(data, skipPrint){
    const now = new Date().toLocaleString();
    const container = document.getElementById("printView");
    if(!container) return;
    const domWindows = collectWindowsFromDom();
    if(domWindows.length){
      data.system.windows = domWindows;
    }
    const domGaubes = collectGaubesFromDom();
    if(domGaubes.length){
      data.system.gaubes = domGaubes;
    }
    const domGaubeWindows = collectGaubeWindowsFromDom();
    if(domGaubeWindows.length){
      data.system.gaubeWindows = domGaubeWindows;
    }
    const domRoofWindows = collectRoofWindowsFromDom();
    if(domRoofWindows.length){
      data.system.roofWindows = domRoofWindows;
    }
    const gaubes = Array.isArray(data.system.gaubes) ? data.system.gaubes : [];
    const windows = Array.isArray(data.system.windows) ? data.system.windows : [];
    const gaubeWindows = Array.isArray(data.system.gaubeWindows) ? data.system.gaubeWindows : [];
    const roofWindows = Array.isArray(data.system.roofWindows) ? data.system.roofWindows : [];
    const surfaceHeating = document.querySelector('input[name="surfaceHeating"]:checked');
    const surfaceDetails = document.getElementById("surfaceHeatingDetails");
    const detailsOpen = surfaceDetails && !surfaceDetails.classList.contains("hidden");
    const distributorPhotoChecked = !!document.querySelector('input[name="surfaceHeatingDistributorPhoto"]:checked');
    const distributorDnInput = document.getElementById("distributorDn");
    const distributorDnValue = (distributorDnInput && distributorDnInput.value ? distributorDnInput.value : "").trim();
    const distributorDnDraw = distributorDnInput && distributorDnInput.dataset.drawing ? distributorDnInput.dataset.drawing : "";
    const layingSpacingValue = ((document.getElementById("layingSpacing") || {}).value || "").trim();
    const addressNameDraw = (document.getElementById("addressNameDraw") || {}).dataset ? (document.getElementById("addressNameDraw").dataset.drawing || "") : "";
    const addressStreetDraw = (document.getElementById("addressStreetDraw") || {}).dataset ? (document.getElementById("addressStreetDraw").dataset.drawing || "") : "";
    const addressCityDraw = (document.getElementById("addressCityDraw") || {}).dataset ? (document.getElementById("addressCityDraw").dataset.drawing || "") : "";
    const addressPhoneDraw = (document.getElementById("addressPhoneDraw") || {}).dataset ? (document.getElementById("addressPhoneDraw").dataset.drawing || "") : "";
    const addressEmailDraw = (document.getElementById("addressEmailDraw") || {}).dataset ? (document.getElementById("addressEmailDraw").dataset.drawing || "") : "";
    const buildingData = ((document.querySelector('input[name="buildingData"]:checked') || {}).value || "").trim();
    const buildingStreetDraw = (document.getElementById("buildingStreetDraw") || {}).dataset ? (document.getElementById("buildingStreetDraw").dataset.drawing || "") : "";
    const buildingCityDraw = (document.getElementById("buildingCityDraw") || {}).dataset ? (document.getElementById("buildingCityDraw").dataset.drawing || "") : "";
    const buildingYearDraw = (document.getElementById("buildingYearDraw") || {}).dataset ? (document.getElementById("buildingYearDraw").dataset.drawing || "") : "";
    const buildingUnits = ((document.getElementById("buildingUnits") || {}).value || "").trim();
    const buildingTypeDetached = !!document.querySelector('input[name="buildingTypeDetached"]:checked');
    const buildingTypeMultiFamily = !!document.querySelector('input[name="buildingTypeMultiFamily"]:checked');
    const buildingTypeEndTerrace = !!document.querySelector('input[name="buildingTypeEndTerrace"]:checked');
    const buildingTypeMidTerrace = !!document.querySelector('input[name="buildingTypeMidTerrace"]:checked');
    const floorHeightBasementDraw = (document.getElementById("floorHeightBasementDraw") || {}).dataset ? (document.getElementById("floorHeightBasementDraw").dataset.drawing || "") : "";
    const floorHeightGroundDraw = (document.getElementById("floorHeightGroundDraw") || {}).dataset ? (document.getElementById("floorHeightGroundDraw").dataset.drawing || "") : "";
    const floorHeight1OgDraw = (document.getElementById("floorHeight1OgDraw") || {}).dataset ? (document.getElementById("floorHeight1OgDraw").dataset.drawing || "") : "";
    const floorHeight2OgDraw = (document.getElementById("floorHeight2OgDraw") || {}).dataset ? (document.getElementById("floorHeight2OgDraw").dataset.drawing || "") : "";
    const floorHeight3OgDraw = (document.getElementById("floorHeight3OgDraw") || {}).dataset ? (document.getElementById("floorHeight3OgDraw").dataset.drawing || "") : "";
    const floorHeightDgDraw = (document.getElementById("floorHeightDgDraw") || {}).dataset ? (document.getElementById("floorHeightDgDraw").dataset.drawing || "") : "";
    const structureMassive = !!document.querySelector('input[name="structureMassive"]:checked');
    const structureWooden = !!document.querySelector('input[name="structureWooden"]:checked');
    const basementHeated = ((document.querySelector('input[name="basementHeated"]:checked') || {}).value || "").trim();
    const notesDraw = (document.getElementById("notesDraw") || {}).dataset ? (document.getElementById("notesDraw").dataset.drawing || "") : "";
    const wallNorthL1Draw = (document.getElementById("wallNorthL1Draw") || {}).dataset ? (document.getElementById("wallNorthL1Draw").dataset.drawing || "") : "";
    const wallNorthL2Draw = (document.getElementById("wallNorthL2Draw") || {}).dataset ? (document.getElementById("wallNorthL2Draw").dataset.drawing || "") : "";
    const wallNorthL3Draw = (document.getElementById("wallNorthL3Draw") || {}).dataset ? (document.getElementById("wallNorthL3Draw").dataset.drawing || "") : "";
    const wallNorthL4Draw = (document.getElementById("wallNorthL4Draw") || {}).dataset ? (document.getElementById("wallNorthL4Draw").dataset.drawing || "") : "";
    const wallNorthL5Draw = (document.getElementById("wallNorthL5Draw") || {}).dataset ? (document.getElementById("wallNorthL5Draw").dataset.drawing || "") : "";
    const wallNorthTotalDraw = (document.getElementById("wallNorthTotalDraw") || {}).dataset ? (document.getElementById("wallNorthTotalDraw").dataset.drawing || "") : "";
    const wallEastL1Draw = (document.getElementById("wallEastL1Draw") || {}).dataset ? (document.getElementById("wallEastL1Draw").dataset.drawing || "") : "";
    const wallEastL2Draw = (document.getElementById("wallEastL2Draw") || {}).dataset ? (document.getElementById("wallEastL2Draw").dataset.drawing || "") : "";
    const wallEastL3Draw = (document.getElementById("wallEastL3Draw") || {}).dataset ? (document.getElementById("wallEastL3Draw").dataset.drawing || "") : "";
    const wallEastL4Draw = (document.getElementById("wallEastL4Draw") || {}).dataset ? (document.getElementById("wallEastL4Draw").dataset.drawing || "") : "";
    const wallEastL5Draw = (document.getElementById("wallEastL5Draw") || {}).dataset ? (document.getElementById("wallEastL5Draw").dataset.drawing || "") : "";
    const wallEastTotalDraw = (document.getElementById("wallEastTotalDraw") || {}).dataset ? (document.getElementById("wallEastTotalDraw").dataset.drawing || "") : "";
    const wallSouthL1Draw = (document.getElementById("wallSouthL1Draw") || {}).dataset ? (document.getElementById("wallSouthL1Draw").dataset.drawing || "") : "";
    const wallSouthL2Draw = (document.getElementById("wallSouthL2Draw") || {}).dataset ? (document.getElementById("wallSouthL2Draw").dataset.drawing || "") : "";
    const wallSouthL3Draw = (document.getElementById("wallSouthL3Draw") || {}).dataset ? (document.getElementById("wallSouthL3Draw").dataset.drawing || "") : "";
    const wallSouthL4Draw = (document.getElementById("wallSouthL4Draw") || {}).dataset ? (document.getElementById("wallSouthL4Draw").dataset.drawing || "") : "";
    const wallSouthL5Draw = (document.getElementById("wallSouthL5Draw") || {}).dataset ? (document.getElementById("wallSouthL5Draw").dataset.drawing || "") : "";
    const wallSouthTotalDraw = (document.getElementById("wallSouthTotalDraw") || {}).dataset ? (document.getElementById("wallSouthTotalDraw").dataset.drawing || "") : "";
    const wallWestL1Draw = (document.getElementById("wallWestL1Draw") || {}).dataset ? (document.getElementById("wallWestL1Draw").dataset.drawing || "") : "";
    const wallWestL2Draw = (document.getElementById("wallWestL2Draw") || {}).dataset ? (document.getElementById("wallWestL2Draw").dataset.drawing || "") : "";
    const wallWestL3Draw = (document.getElementById("wallWestL3Draw") || {}).dataset ? (document.getElementById("wallWestL3Draw").dataset.drawing || "") : "";
    const wallWestL4Draw = (document.getElementById("wallWestL4Draw") || {}).dataset ? (document.getElementById("wallWestL4Draw").dataset.drawing || "") : "";
    const wallWestL5Draw = (document.getElementById("wallWestL5Draw") || {}).dataset ? (document.getElementById("wallWestL5Draw").dataset.drawing || "") : "";
    const wallWestTotalDraw = (document.getElementById("wallWestTotalDraw") || {}).dataset ? (document.getElementById("wallWestTotalDraw").dataset.drawing || "") : "";
    const wallNotesDraw = (document.getElementById("wallNotesDraw") || {}).dataset ? (document.getElementById("wallNotesDraw").dataset.drawing || "") : "";
    const systemManufacturer = ((document.getElementById("systemManufacturer") || {}).value || "").trim();
    const systemManufacturerDraw = (document.getElementById("systemManufacturerDraw") || {}).dataset ? (document.getElementById("systemManufacturerDraw").dataset.drawing || "") : "";
    const systemTypeDraw = (document.getElementById("systemTypeDraw") || {}).dataset ? (document.getElementById("systemTypeDraw").dataset.drawing || "") : "";
    const systemPowerDraw = (document.getElementById("systemPowerDraw") || {}).dataset ? (document.getElementById("systemPowerDraw").dataset.drawing || "") : "";
    const systemYear = ((document.getElementById("systemYear") || {}).value || "").trim();
    const systemFuel = ((document.getElementById("systemFuel") || {}).value || "").trim();
    const systemLocation = ((document.getElementById("systemLocation") || {}).value || "").trim();
    const heatDistribution = ((document.getElementById("heatDistribution") || {}).value || "").trim();
    const pipeInsulation = ((document.getElementById("pipeInsulation") || {}).value || "").trim();
    const systemThermostatValves = ((document.getElementById("systemThermostatValves") || {}).value || "").trim();
    const system = {
      addressNameDraw,
      addressStreetDraw,
      addressCityDraw,
      addressPhoneDraw,
      addressEmailDraw,
      buildingData,
      buildingStreetDraw,
      buildingCityDraw,
      buildingYearDraw,
      buildingUnits,
      buildingTypeDetached,
      buildingTypeMultiFamily,
      buildingTypeEndTerrace,
      buildingTypeMidTerrace,
      floorHeightBasementDraw,
      floorHeightGroundDraw,
      floorHeight1OgDraw,
      floorHeight2OgDraw,
      floorHeight3OgDraw,
      floorHeightDgDraw,
      structureMassive,
      structureWooden,
      basementHeated,
      notesDraw,
      wallNorthL1Draw,
      wallNorthL2Draw,
      wallNorthL3Draw,
      wallNorthL4Draw,
      wallNorthL5Draw,
      wallNorthTotalDraw,
      wallEastL1Draw,
      wallEastL2Draw,
      wallEastL3Draw,
      wallEastL4Draw,
      wallEastL5Draw,
      wallEastTotalDraw,
      wallSouthL1Draw,
      wallSouthL2Draw,
      wallSouthL3Draw,
      wallSouthL4Draw,
      wallSouthL5Draw,
      wallSouthTotalDraw,
      wallWestL1Draw,
      wallWestL2Draw,
      wallWestL3Draw,
      wallWestL4Draw,
      wallWestL5Draw,
      wallWestTotalDraw,
      wallNotesDraw,
      notesLargeDraw,
      gaubes: Array.isArray(data.system.gaubes) ? data.system.gaubes : [],
      windows: Array.isArray(data.system.windows) ? data.system.windows : [],
      gaubeWindows: Array.isArray(data.system.gaubeWindows) ? data.system.gaubeWindows : [],
      roofWindows: Array.isArray(data.system.roofWindows) ? data.system.roofWindows : [],
      solarYearDraw,
      solarStorageDraw,
      solarPumpDraw,
      solarModulesDraw,
      solarModulesAreaDraw,
      solarOrientation,
      solarCollectorType,
      pvModulesDraw,
      pvModulesAreaDraw,
      pvPowerDraw,
      pvVentilation,
      pvOrientation,
      pvBatteryDraw,
      ogdStructure,
      ogdStructureDraw,
      ogdInsulationDraw,
      roofTypeSatteldach: !!document.querySelector('input[name="roofTypeSatteldach"]:checked'),
      roofTypeWalmdach: !!document.querySelector('input[name="roofTypeWalmdach"]:checked'),
      roofTypeKruppelwalmdach: !!document.querySelector('input[name="roofTypeKruppelwalmdach"]:checked'),
      roofTypeMansardendach: !!document.querySelector('input[name="roofTypeMansardendach"]:checked'),
      roofTypePultdach: !!document.querySelector('input[name="roofTypePultdach"]:checked'),
      roofTypeFlachdach: !!document.querySelector('input[name="roofTypeFlachdach"]:checked'),
      roofTypeSheddach: !!document.querySelector('input[name="roofTypeSheddach"]:checked'),
      roofDepthDraw,
      roofWidthDraw,
      roofSpacingDraw,
      roofAngleDraw,
      roofDepthDraw2,
      roofWidthDraw2,
      roofSpacingDraw2,
      roofAngleDraw2,
      roofInsulationDraw,
      annexExists: ((document.querySelector('input[name="annexExists"]:checked') || {}).value || "").trim(),
      annexYearDraw,
      annexType,
      annexWallNorthL1Draw,
      annexWallNorthL2Draw,
      annexWallNorthL3Draw,
      annexWallNorthL4Draw,
      annexWallNorthL5Draw,
      annexWallNorthTotalDraw,
      annexWallEastL1Draw,
      annexWallEastL2Draw,
      annexWallEastL3Draw,
      annexWallEastL4Draw,
      annexWallEastL5Draw,
      annexWallEastTotalDraw,
      annexWallSouthL1Draw,
      annexWallSouthL2Draw,
      annexWallSouthL3Draw,
      annexWallSouthL4Draw,
      annexWallSouthL5Draw,
      annexWallSouthTotalDraw,
      annexWallWestL1Draw,
      annexWallWestL2Draw,
      annexWallWestL3Draw,
      annexWallWestL4Draw,
      annexWallWestL5Draw,
      annexWallWestTotalDraw,
      annexRoofTypeSatteldach: !!document.querySelector('input[name="annexRoofTypeSatteldach"]:checked'),
      annexRoofTypeWalmdach: !!document.querySelector('input[name="annexRoofTypeWalmdach"]:checked'),
      annexRoofTypeKruppelwalmdach: !!document.querySelector('input[name="annexRoofTypeKruppelwalmdach"]:checked'),
      annexRoofTypeMansardendach: !!document.querySelector('input[name="annexRoofTypeMansardendach"]:checked'),
      annexRoofTypePultdach: !!document.querySelector('input[name="annexRoofTypePultdach"]:checked'),
      annexRoofTypeFlachdach: !!document.querySelector('input[name="annexRoofTypeFlachdach"]:checked'),
      annexRoofTypeSheddach: !!document.querySelector('input[name="annexRoofTypeSheddach"]:checked'),
      annexRoofDepthDraw,
      annexRoofWidthDraw,
      annexRoofSpacingDraw,
      annexRoofAngleDraw,
      annexRoofDepthDraw2,
      annexRoofWidthDraw2,
      annexRoofSpacingDraw2,
      annexRoofAngleDraw2,
      annexRoofInsulationDraw,
      systemManufacturer,
      systemManufacturerDraw,
      systemTypeDraw,
      systemPowerDraw,
      systemYear,
      systemFuel,
      systemLocation,
      heatDistribution,
      pipeInsulation,
      optionNightReduction: !!document.querySelector('input[name="optionNightReduction"]:checked'),
      optionHydraulicBalance: !!document.querySelector('input[name="optionHydraulicBalance"]:checked'),
      optionHeaterNiches: !!document.querySelector('input[name="optionHeaterNiches"]:checked'),
      optionCirculationTimed: !!document.querySelector('input[name="optionCirculationTimed"]:checked'),
      systemThermostatValves,
      pumpCirculationDraw: (document.getElementById("pumpCirculationDraw") || {}).dataset ? (document.getElementById("pumpCirculationDraw").dataset.drawing || "") : "",
      pumpCirculationHe: !!document.querySelector('input[name="pumpCirculationHe"]:checked'),
      pumpCirculationStf: ((document.getElementById("pumpCirculationStf") || {}).value || "").trim(),
      pumpStorageDraw: (document.getElementById("pumpStorageDraw") || {}).dataset ? (document.getElementById("pumpStorageDraw").dataset.drawing || "") : "",
      pumpStorageHe: !!document.querySelector('input[name="pumpStorageHe"]:checked'),
      pumpStorageStf: ((document.getElementById("pumpStorageStf") || {}).value || "").trim(),
      pumpRecircDraw: (document.getElementById("pumpRecircDraw") || {}).dataset ? (document.getElementById("pumpRecircDraw").dataset.drawing || "") : "",
      pumpRecircHe: !!document.querySelector('input[name="pumpRecircHe"]:checked'),
      pumpRecircStf: ((document.getElementById("pumpRecircStf") || {}).value || "").trim(),
      heatingCircuits: ((document.getElementById("heatingCircuits") || {}).value || "").trim(),
      surfaceHeating: surfaceHeating ? surfaceHeating.value : (detailsOpen ? "Ja" : ""),
      distributorPhoto: distributorPhotoChecked,
      distributorDn: distributorDnValue,
      distributorDnDraw: distributorDnDraw,
      layingSpacing: layingSpacingValue,
      fbhLineDiameter: ((document.getElementById("fBHLineDiameter") || {}).value || "").trim()
    };
    const hasSystem = !!(
      system.systemManufacturer || system.systemManufacturerDraw ||
      system.systemType || system.systemTypeDraw ||
      system.systemPowerDraw || system.systemYear || system.systemFuel || system.systemLocation || system.heatDistribution || system.pipeInsulation ||
      system.pumpCirculationDraw || system.pumpCirculationHe || system.pumpCirculationStf ||
      system.pumpStorageDraw || system.pumpStorageHe || system.pumpStorageStf ||
      system.pumpRecircDraw || system.pumpRecircHe || system.pumpRecircStf ||
      system.optionNightReduction || system.optionHydraulicBalance || system.optionHeaterNiches || system.optionCirculationTimed ||
      system.systemThermostatValves || system.heatingCircuits ||
      system.surfaceHeating || system.distributorPhoto || system.distributorDn || system.distributorDnDraw ||
      system.layingSpacing || system.fbhLineDiameter || detailsOpen
    );
    const sections = [];
    const hasAddress = !!(
      system.addressNameDraw || system.addressStreetDraw ||
      system.addressCityDraw || system.addressPhoneDraw || system.addressEmailDraw ||
      system.buildingData || system.buildingStreetDraw || system.buildingCityDraw ||
      system.buildingYearDraw || system.buildingUnits ||
      system.buildingTypeDetached || system.buildingTypeMultiFamily ||
      system.buildingTypeEndTerrace || system.buildingTypeMidTerrace
    );
    if(hasAddress){
      const rows = [];
      const addRowDraw = (label, draw) => {
        if(draw){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell("", draw) + '</td></tr>');
        }
      };
      const addRowValue = (label, value) => {
        if(value){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell(value, "") + '</td></tr>');
        }
      };
      const addFlag = (label, flag) => {
        if(flag) rows.push('<tr><td>' + label + '</td><td>Ja</td></tr>');
      };
      addRowDraw("Name", system.addressNameDraw);
      addRowDraw("Stra\u00dfe, Nr.", system.addressStreetDraw);
      addRowDraw("PLZ/Ort", system.addressCityDraw);
      addRowDraw("Telefon", system.addressPhoneDraw);
      addRowDraw("Email", system.addressEmailDraw);
      addRowValue("Geb\u00e4udedaten wie oben", system.buildingData);
      addRowDraw("Geb\u00e4ude Stra\u00dfe, Nr.", system.buildingStreetDraw);
      addRowDraw("Geb\u00e4ude PLZ/Ort", system.buildingCityDraw);
      addRowDraw("Geb\u00e4ude Baujahr", system.buildingYearDraw);
      addRowValue("Wohneinheiten", system.buildingUnits);
      addFlag("Geb\u00e4udetyp freistehend", system.buildingTypeDetached);
      addFlag("Geb\u00e4udetyp Mehrfamilienhaus", system.buildingTypeMultiFamily);
      addFlag("Geb\u00e4udetyp Reihenendhaus", system.buildingTypeEndTerrace);
      addFlag("Geb\u00e4udetyp Reihenmittelhaus", system.buildingTypeMidTerrace);
      if(rows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Anschrift</div><div class="room-sub">Stammdaten</div></div>',
          '<div class="badge">Adresse</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          rows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
    }
    const hasStructure = !!(
      system.floorHeightBasementDraw || system.floorHeightGroundDraw ||
      system.floorHeight1OgDraw || system.floorHeight2OgDraw ||
      system.floorHeight3OgDraw || system.floorHeightDgDraw ||
      system.structureMassive || system.structureWooden || system.basementHeated ||
      system.notesDraw
    );
    if(hasStructure){
      const rows = [];
      const addRowDraw = (label, draw) => {
        if(draw){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell("", draw) + '</td></tr>');
        }
      };
      const addRowValue = (label, value) => {
        if(value){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell(value, "") + '</td></tr>');
        }
      };
      const addFlag = (label, flag) => {
        if(flag) rows.push('<tr><td>' + label + '</td><td>Ja</td></tr>');
      };
      addRowDraw("Keller", system.floorHeightBasementDraw);
      addRowDraw("Erdgeschoss", system.floorHeightGroundDraw);
      addRowDraw("1.OG", system.floorHeight1OgDraw);
      addRowDraw("2.OG", system.floorHeight2OgDraw);
      addRowDraw("3.OG", system.floorHeight3OgDraw);
      addRowDraw("DG", system.floorHeightDgDraw);
      addFlag("Massiv", system.structureMassive);
      addFlag("Holzbalken", system.structureWooden);
      addRowValue("Keller beheizt", system.basementHeated);
      addRowDraw("Notizen", system.notesDraw);
      if(rows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Geschossh&ouml;he, Kellerdecke/Bodenplatte, Au&szlig;enw&auml;nde</div><div class="room-sub">Art/Aufbau/Material</div></div>',
          '<div class="badge">Geb&auml;ude</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          rows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
    }
    const hasWalls = !!(
      system.wallNorthL1Draw || system.wallNorthL2Draw || system.wallNorthL3Draw ||
      system.wallNorthL4Draw || system.wallNorthL5Draw || system.wallNorthTotalDraw ||
      system.wallEastL1Draw || system.wallEastL2Draw || system.wallEastL3Draw ||
      system.wallEastL4Draw || system.wallEastL5Draw || system.wallEastTotalDraw ||
      system.wallSouthL1Draw || system.wallSouthL2Draw || system.wallSouthL3Draw ||
      system.wallSouthL4Draw || system.wallSouthL5Draw || system.wallSouthTotalDraw ||
      system.wallWestL1Draw || system.wallWestL2Draw || system.wallWestL3Draw ||
      system.wallWestL4Draw || system.wallWestL5Draw || system.wallWestTotalDraw ||
      system.wallNotesDraw
    );
    if(hasWalls){
      const buildRow = (label, values) => (
        '<tr>' +
        '<td>' + label + '</td>' +
        values.map(draw => '<td>' + renderCell("", draw) + '</td>').join("") +
        '</tr>'
      );
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Au\u00dfenw\u00e4nde</div><div class="room-sub">Aufbau / Himmelsrichtungen</div></div>',
        '<div class="badge">Wand</div>',
        '</div>',
        '<table class="hk-table">',
        '<thead><tr><th>Aufbau</th><th>Schicht 1</th><th>Schicht 2</th><th>Schicht 3</th><th>Schicht 4</th><th>Schicht 5</th><th>Gesamtdicke</th></tr></thead>',
        '<tbody>',
        buildRow("Nord", [
          system.wallNorthL1Draw,
          system.wallNorthL2Draw,
          system.wallNorthL3Draw,
          system.wallNorthL4Draw,
          system.wallNorthL5Draw,
          system.wallNorthTotalDraw
        ]),
        buildRow("Ost", [
          system.wallEastL1Draw,
          system.wallEastL2Draw,
          system.wallEastL3Draw,
          system.wallEastL4Draw,
          system.wallEastL5Draw,
          system.wallEastTotalDraw
        ]),
        buildRow("S\u00fcd", [
          system.wallSouthL1Draw,
          system.wallSouthL2Draw,
          system.wallSouthL3Draw,
          system.wallSouthL4Draw,
          system.wallSouthL5Draw,
          system.wallSouthTotalDraw
        ]),
        buildRow("West", [
          system.wallWestL1Draw,
          system.wallWestL2Draw,
          system.wallWestL3Draw,
          system.wallWestL4Draw,
          system.wallWestL5Draw,
          system.wallWestTotalDraw
        ]),
        '</tbody></table></section>'
      ].join(""));
      if(system.wallNotesDraw){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Au\u00dfenw\u00e4nde</div><div class="room-sub">Notizen</div></div>',
          '<div class="badge">Notiz</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Notizen</th></tr></thead>',
          '<tbody><tr><td>' + renderCell("", system.wallNotesDraw) + '</td></tr></tbody>',
          '</table></section>'
        ].join(""));
      }
    }
    const normalizeText = value => {
      if(value && typeof value === "object" && "value" in value) return String(value.value || "");
      return value ? String(value) : "";
    };
    const normalizeDraw = value => {
      if(value && typeof value === "object" && value.dataset && value.dataset.drawing){
        return isValidDraw(value.dataset.drawing) ? value.dataset.drawing : "";
      }
      if(isValidDraw(value)) return value;
      return "";
    };
    const filteredWindows = Array.isArray(data.system.windows)
      ? data.system.windows.filter(entry => entry && (
        entry.hr || entry.vg || entry.material || entry.roomDraw || entry.sizeDraw || entry.yearDraw
      ))
      : [];
    if(filteredWindows.length){
      const windowRows = filteredWindows.map(entry => [
        '<tr>',
        '<td>' + renderCell(normalizeText(entry.hr), "") + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.roomDraw)) + '</td>',
        '<td>' + renderCell(normalizeText(entry.vg), "") + '</td>',
        '<td>' + renderCell(normalizeText(entry.material), "") + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.sizeDraw)) + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.yearDraw)) + '</td>',
        '</tr>'
      ].join("")).join("");
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Fenster</div><div class="room-sub">Himmelsrichtung / Material</div></div>',
        '<div class="badge">Fenster</div>',
        '</div>',
        '<table class="hk-table window-table">',
        '<thead><tr><th>HR</th><th>Raum</th><th>VG</th><th>Stoff</th><th>Ma\u00dfe</th><th>Bj.</th></tr></thead>',
        '<tbody>',
        windowRows,
        '</tbody></table></section>'
      ].join(""));
    }
    const filteredGaubeWindows = Array.isArray(data.system.gaubeWindows)
      ? data.system.gaubeWindows.filter(entry => entry && (
        entry.hr || entry.vg || entry.material || entry.roomDraw || entry.sizeDraw || entry.yearDraw
      ))
      : [];
    if(filteredGaubeWindows.length){
      const windowRows = filteredGaubeWindows.map(entry => [
        '<tr>',
        '<td>' + renderCell(normalizeText(entry.hr), "") + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.roomDraw)) + '</td>',
        '<td>' + renderCell(normalizeText(entry.vg), "") + '</td>',
        '<td>' + renderCell(normalizeText(entry.material), "") + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.sizeDraw)) + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.yearDraw)) + '</td>',
        '</tr>'
      ].join("")).join("");
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Gaubenfenster</div><div class="room-sub">Dachgaube</div></div>',
        '<div class="badge">Fenster</div>',
        '</div>',
        '<table class="hk-table window-table">',
        '<thead><tr><th>HR</th><th>Raum</th><th>VG</th><th>Stoff</th><th>Ma\u00dfe</th><th>Bj.</th></tr></thead>',
        '<tbody>',
        windowRows,
        '</tbody></table></section>'
      ].join(""));
    }
    const filteredRoofWindows = Array.isArray(data.system.roofWindows)
      ? data.system.roofWindows.filter(entry => entry && (
        entry.hr || entry.vg || entry.material || entry.roomDraw || entry.sizeDraw || entry.yearDraw
      ))
      : [];
    if(filteredRoofWindows.length){
      const windowRows = filteredRoofWindows.map(entry => [
        '<tr>',
        '<td>' + renderCell(normalizeText(entry.hr), "") + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.roomDraw)) + '</td>',
        '<td>' + renderCell(normalizeText(entry.vg), "") + '</td>',
        '<td>' + renderCell(normalizeText(entry.material), "") + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.sizeDraw)) + '</td>',
        '<td>' + renderCell("", normalizeDraw(entry.yearDraw)) + '</td>',
        '</tr>'
      ].join("")).join("");
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Dachfl\u00e4chenfenster</div><div class="room-sub">Dach/OGD</div></div>',
        '<div class="badge">Fenster</div>',
        '</div>',
        '<table class="hk-table window-table">',
        '<thead><tr><th>HR</th><th>Raum</th><th>VG</th><th>Stoff</th><th>Ma\u00dfe</th><th>Bj.</th></tr></thead>',
        '<tbody>',
        windowRows,
        '</tbody></table></section>'
      ].join(""));
    }
    const filteredGaubes = Array.isArray(data.system.gaubes)
      ? data.system.gaubes.filter(entry => entry && (
        entry.hr || entry.angle || entry.widthDraw || entry.heightDraw
      ))
      : [];
    if(filteredGaubes.length){
      const headerTitles = ["Gaube1", "Gaube2", "Gaube3", "Gaube4"];
      const cells = (key, isDraw) => filteredGaubes.map(entry => (
        '<td>' + renderCell(isDraw ? "" : (entry[key] || ""), isDraw ? (entry[key] || "") : "") + '</td>'
      )).join("");
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Dachgaube</div><div class="room-sub">HR / Breite / H\u00f6he / Winkel</div></div>',
        '<div class="badge">Dach</div>',
        '</div>',
        '<table class="hk-table">',
        '<thead><tr><th></th>' + headerTitles.map(title => '<th>' + title + '</th>').join("") + '</tr></thead>',
        '<tbody>',
        '<tr><td>HR</td>' + cells("hr", false) + '</tr>',
        '<tr><td>Breite</td>' + cells("widthDraw", true) + '</tr>',
        '<tr><td>H\u00f6he</td>' + cells("heightDraw", true) + '</tr>',
        '<tr><td>Winkel</td>' + cells("angle", false) + '</tr>',
        '</tbody></table></section>'
      ].join(""));
    }
    const roofTypes = [];
    if(system.roofTypeSatteldach) roofTypes.push("Satteldach");
    if(system.roofTypeWalmdach) roofTypes.push("Walmdach");
    if(system.roofTypeKruppelwalmdach) roofTypes.push("Kr\u00fcppelwalmdach");
    if(system.roofTypeMansardendach) roofTypes.push("Mansardendach");
    if(system.roofTypePultdach) roofTypes.push("Pultdach");
    if(system.roofTypeFlachdach) roofTypes.push("Flachdach");
    if(system.roofTypeSheddach) roofTypes.push("Sheddach");
    const hasOgd = !!(
      system.ogdStructure || system.ogdStructureDraw || system.ogdInsulationDraw ||
      roofTypes.length ||
      system.roofDepthDraw || system.roofWidthDraw || system.roofSpacingDraw || system.roofAngleDraw ||
      system.roofDepthDraw2 || system.roofWidthDraw2 || system.roofSpacingDraw2 || system.roofAngleDraw2 ||
      system.roofInsulationDraw
    );
    if(hasOgd){
      const ogdRows = [];
      if(system.ogdStructure || system.ogdStructureDraw){
        ogdRows.push('<tr><td>Art/Aufbau/Material</td><td>' + renderCell(system.ogdStructure || "", system.ogdStructureDraw || "") + '</td></tr>');
      }
      if(system.ogdInsulationDraw){
        ogdRows.push('<tr><td>D\u00e4mmung</td><td>' + renderCell("", system.ogdInsulationDraw) + '</td></tr>');
      }
      const roofRows = [];
      if(roofTypes.length){
        roofRows.push('<tr><td>Dachform</td><td>' + roofTypes.join(", ") + '</td></tr>');
      }
      if(system.roofDepthDraw || system.roofWidthDraw || system.roofSpacingDraw || system.roofAngleDraw){
        roofRows.push(
          '<tr>' +
          '<td>Tiefe</td><td>' + renderCell("", system.roofDepthDraw) + '</td>' +
          '<td>Breite</td><td>' + renderCell("", system.roofWidthDraw) + '</td>' +
          '</tr>' +
          '<tr>' +
          '<td>Abstand</td><td>' + renderCell("", system.roofSpacingDraw) + '</td>' +
          '<td>Winkel</td><td>' + renderCell("", system.roofAngleDraw) + '</td>' +
          '</tr>'
        );
      }
      if(system.roofDepthDraw2 || system.roofWidthDraw2 || system.roofSpacingDraw2 || system.roofAngleDraw2){
        roofRows.push(
          '<tr>' +
          '<td>Tiefe</td><td>' + renderCell("", system.roofDepthDraw2) + '</td>' +
          '<td>Breite</td><td>' + renderCell("", system.roofWidthDraw2) + '</td>' +
          '</tr>' +
          '<tr>' +
          '<td>Abstand</td><td>' + renderCell("", system.roofSpacingDraw2) + '</td>' +
          '<td>Winkel</td><td>' + renderCell("", system.roofAngleDraw2) + '</td>' +
          '</tr>'
        );
      }
      if(system.roofInsulationDraw){
        roofRows.push('<tr><td>D\u00e4mmung</td><td colspan="3">' + renderCell("", system.roofInsulationDraw) + '</td></tr>');
      }
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Dach/OGD</div><div class="room-sub">Aufbau / Dach</div></div>',
        '<div class="badge">Dach</div>',
        '</div>',
        (ogdRows.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>OGD</th><th>Wert</th></tr></thead>',
          '<tbody>',
          ogdRows.join(""),
          '</tbody></table>'
        ].join("") : ""),
        (roofRows.length ? [
          '<table class="hk-table" style="margin-top:10px;">',
          '<thead><tr><th colspan="4">Dach</th></tr></thead>',
          '<tbody>',
          roofRows.join(""),
          '</tbody></table>'
        ].join("") : ""),
        '</section>'
      ].join(""));
    }
    const annexRoofTypes = [];
    if(system.annexRoofTypeSatteldach) annexRoofTypes.push("Satteldach");
    if(system.annexRoofTypeWalmdach) annexRoofTypes.push("Walmdach");
    if(system.annexRoofTypeKruppelwalmdach) annexRoofTypes.push("Kr\u00fcppelwalmdach");
    if(system.annexRoofTypeMansardendach) annexRoofTypes.push("Mansardendach");
    if(system.annexRoofTypePultdach) annexRoofTypes.push("Pultdach");
    if(system.annexRoofTypeFlachdach) annexRoofTypes.push("Flachdach");
    if(system.annexRoofTypeSheddach) annexRoofTypes.push("Sheddach");
    const hasAnnexWalls = !!(
      system.annexWallNorthL1Draw || system.annexWallNorthL2Draw || system.annexWallNorthL3Draw ||
      system.annexWallNorthL4Draw || system.annexWallNorthL5Draw || system.annexWallNorthTotalDraw ||
      system.annexWallEastL1Draw || system.annexWallEastL2Draw || system.annexWallEastL3Draw ||
      system.annexWallEastL4Draw || system.annexWallEastL5Draw || system.annexWallEastTotalDraw ||
      system.annexWallSouthL1Draw || system.annexWallSouthL2Draw || system.annexWallSouthL3Draw ||
      system.annexWallSouthL4Draw || system.annexWallSouthL5Draw || system.annexWallSouthTotalDraw ||
      system.annexWallWestL1Draw || system.annexWallWestL2Draw || system.annexWallWestL3Draw ||
      system.annexWallWestL4Draw || system.annexWallWestL5Draw || system.annexWallWestTotalDraw
    );
    const hasAnnexRoof = !!(
      annexRoofTypes.length ||
      system.annexRoofDepthDraw || system.annexRoofWidthDraw || system.annexRoofSpacingDraw || system.annexRoofAngleDraw ||
      system.annexRoofDepthDraw2 || system.annexRoofWidthDraw2 || system.annexRoofSpacingDraw2 || system.annexRoofAngleDraw2 ||
      system.annexRoofInsulationDraw
    );
    const hasAnnex = !!(system.annexExists || system.annexYearDraw || system.annexType || hasAnnexWalls || hasAnnexRoof);
    if(hasAnnex){
      const annexRows = [];
      if(system.annexExists) annexRows.push('<tr><td>Anbau vorhanden</td><td>' + system.annexExists + '</td></tr>');
      if(system.annexYearDraw) annexRows.push('<tr><td>Baujahr</td><td>' + renderCell("", system.annexYearDraw) + '</td></tr>');
      if(system.annexType) annexRows.push('<tr><td>Bodenplatte</td><td>' + renderCell(system.annexType, "") + '</td></tr>');
      if(annexRows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Anbau</div><div class="room-sub">Stammdaten</div></div>',
          '<div class="badge">Anbau</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          annexRows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
      if(hasAnnexWalls){
        const buildRow = (label, values) => (
          '<tr>' +
          '<td>' + label + '</td>' +
          values.map(draw => '<td>' + renderCell("", draw) + '</td>').join("") +
          '</tr>'
        );
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Anbau Au\u00dfenw\u00e4nde</div><div class="room-sub">Aufbau</div></div>',
          '<div class="badge">Anbau</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Aufbau</th><th>Schicht 1</th><th>Schicht 2</th><th>Schicht 3</th><th>Schicht 4</th><th>Schicht 5</th><th>Gesamtdicke</th></tr></thead>',
          '<tbody>',
          buildRow("Nord", [
            system.annexWallNorthL1Draw,
            system.annexWallNorthL2Draw,
            system.annexWallNorthL3Draw,
            system.annexWallNorthL4Draw,
            system.annexWallNorthL5Draw,
            system.annexWallNorthTotalDraw
          ]),
          buildRow("Ost", [
            system.annexWallEastL1Draw,
            system.annexWallEastL2Draw,
            system.annexWallEastL3Draw,
            system.annexWallEastL4Draw,
            system.annexWallEastL5Draw,
            system.annexWallEastTotalDraw
          ]),
          buildRow("S\u00fcd", [
            system.annexWallSouthL1Draw,
            system.annexWallSouthL2Draw,
            system.annexWallSouthL3Draw,
            system.annexWallSouthL4Draw,
            system.annexWallSouthL5Draw,
            system.annexWallSouthTotalDraw
          ]),
          buildRow("West", [
            system.annexWallWestL1Draw,
            system.annexWallWestL2Draw,
            system.annexWallWestL3Draw,
            system.annexWallWestL4Draw,
            system.annexWallWestL5Draw,
            system.annexWallWestTotalDraw
          ]),
          '</tbody></table></section>'
        ].join(""));
      }
      if(hasAnnexRoof){
        const roofRows = [];
        if(annexRoofTypes.length){
          roofRows.push('<tr><td>Dachform</td><td>' + annexRoofTypes.join(", ") + '</td></tr>');
        }
        if(system.annexRoofDepthDraw || system.annexRoofWidthDraw || system.annexRoofSpacingDraw || system.annexRoofAngleDraw){
          roofRows.push(
            '<tr>' +
            '<td>Tiefe</td><td>' + renderCell("", system.annexRoofDepthDraw) + '</td>' +
            '<td>Breite</td><td>' + renderCell("", system.annexRoofWidthDraw) + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>Abstand</td><td>' + renderCell("", system.annexRoofSpacingDraw) + '</td>' +
            '<td>Winkel</td><td>' + renderCell("", system.annexRoofAngleDraw) + '</td>' +
            '</tr>'
          );
        }
        if(system.annexRoofDepthDraw2 || system.annexRoofWidthDraw2 || system.annexRoofSpacingDraw2 || system.annexRoofAngleDraw2){
          roofRows.push(
            '<tr>' +
            '<td>Tiefe</td><td>' + renderCell("", system.annexRoofDepthDraw2) + '</td>' +
            '<td>Breite</td><td>' + renderCell("", system.annexRoofWidthDraw2) + '</td>' +
            '</tr>' +
            '<tr>' +
            '<td>Abstand</td><td>' + renderCell("", system.annexRoofSpacingDraw2) + '</td>' +
            '<td>Winkel</td><td>' + renderCell("", system.annexRoofAngleDraw2) + '</td>' +
            '</tr>'
          );
        }
        if(system.annexRoofInsulationDraw){
          roofRows.push('<tr><td>D\u00e4mmung</td><td colspan="3">' + renderCell("", system.annexRoofInsulationDraw) + '</td></tr>');
        }
        if(roofRows.length){
          sections.push([
            '<section class="room">',
            '<div class="room-head">',
            '<div><div class="room-title">Anbau Dach</div><div class="room-sub">Aufbau</div></div>',
            '<div class="badge">Anbau</div>',
            '</div>',
            '<table class="hk-table">',
            '<thead><tr><th colspan="4">Dach</th></tr></thead>',
            '<tbody>',
            roofRows.join(""),
            '</tbody></table></section>'
          ].join(""));
        }
      }
    }
    const hasSolar = !!(
      system.solarYearDraw || system.solarStorageDraw || system.solarPumpDraw ||
      system.solarModulesDraw || system.solarModulesAreaDraw || system.solarOrientation || system.solarCollectorType
    );
    const hasPv = !!(
      system.pvModulesDraw || system.pvModulesAreaDraw || system.pvPowerDraw ||
      system.pvVentilation || system.pvOrientation || system.pvBatteryDraw
    );
    if(hasSolar || hasPv){
      const blocks = [];
      if(hasSolar){
        blocks.push([
          '<table class="hk-table">',
          '<thead><tr><th colspan="7">Solarthermie</th></tr>',
          '<tr><th>Baujahr</th><th>Speicher</th><th>Pumpe</th><th>Module</th><th>Module m\u00b2</th><th>Ausrichtung</th><th>Kollektorart</th></tr></thead>',
          '<tbody><tr>',
          '<td>' + renderCell("", system.solarYearDraw) + '</td>',
          '<td>' + renderCell("", system.solarStorageDraw) + '</td>',
          '<td>' + renderCell("", system.solarPumpDraw) + '</td>',
          '<td>' + renderCell("", system.solarModulesDraw) + '</td>',
          '<td>' + renderCell("", system.solarModulesAreaDraw) + '</td>',
          '<td>' + renderCell(system.solarOrientation || "", "") + '</td>',
          '<td>' + renderCell(system.solarCollectorType || "", "") + '</td>',
          '</tr></tbody></table>'
        ].join(""));
      }
      if(hasPv){
        blocks.push([
          '<table class="hk-table" style="margin-top:10px;">',
          '<thead><tr><th colspan="6">Photovoltaik</th></tr>',
          '<tr><th>Module</th><th>Module m\u00b2</th><th>Leistung</th><th>Bel\u00fcftung</th><th>Ausrichtung</th><th>Batteriespeicher</th></tr></thead>',
          '<tbody><tr>',
          '<td>' + renderCell("", system.pvModulesDraw) + '</td>',
          '<td>' + renderCell("", system.pvModulesAreaDraw) + '</td>',
          '<td>' + renderCell("", system.pvPowerDraw) + '</td>',
          '<td>' + renderCell(system.pvVentilation || "", "") + '</td>',
          '<td>' + renderCell(system.pvOrientation || "", "") + '</td>',
          '<td>' + renderCell("", system.pvBatteryDraw) + '</td>',
          '</tr></tbody></table>'
        ].join(""));
      }
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Sonstiges</div><div class="room-sub">Solar / PV</div></div>',
        '<div class="badge">Zusatz</div>',
        '</div>',
        blocks.join(""),
        '</section>'
      ].join(""));
    }
    if(system.notesLargeDraw){
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Notizen</div><div class="room-sub">Zusatz</div></div>',
        '<div class="badge">Notiz</div>',
        '</div>',
        '<table class="hk-table">',
        '<thead><tr><th>Notizen</th></tr></thead>',
        '<tbody><tr><td>' + renderCell("", system.notesLargeDraw) + '</td></tr></tbody>',
        '</table></section>'
      ].join(""));
    }
    if(hasSystem){
      const rows = [];
      const addRow = (label, value, draw) => {
        if((value && value !== "-") || draw){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell(value || "", draw || "") + '</td></tr>');
        }
      };
      const addFlag = (label, flag) => {
        if(flag) rows.push('<tr><td>' + label + '</td><td>Ja</td></tr>');
      };
      addRow("Hersteller", system.systemManufacturer, system.systemManufacturerDraw);
      addRow("Typ", "", system.systemTypeDraw);
      addRow("Leistung", "", system.systemPowerDraw);
      addRow("Baujahr", system.systemYear, "");
      addRow("Brennstoff", system.systemFuel, "");
      addRow("Aufstellort der Heizung", system.systemLocation, "");
      addRow("W\u00e4rmeverteilung", system.heatDistribution, "");
      addRow("D\u00e4mmung der Rohrleitung", system.pipeInsulation, "");
      addFlag("Nachtabsenkung", system.optionNightReduction);
      addFlag("Hydr. Abgleich", system.optionHydraulicBalance);
      addFlag("Heizk\u00f6rpernieschen", system.optionHeaterNiches);
      addFlag("Zirku. Zeitgesteuert", system.optionCirculationTimed);
      addRow("Thermostatventile", system.systemThermostatValves, "");
      addRow("Anzahl Heizkreise", system.heatingCircuits, "");
      addRow("Fl\u00e4chenheizung vorhanden", system.surfaceHeating, "");
      addFlag("Foto vom Verteiler", system.distributorPhoto);
      addRow("Verteiler DN", system.distributorDn, system.distributorDnDraw);
      addRow("Verlegeabstand", system.layingSpacing, "");
      addRow("Durchmesser Leitung FBH", system.fbhLineDiameter, "");
      addRow("Umw\u00e4lzpumpe", "", system.pumpCirculationDraw);
      addFlag("Umw\u00e4lzpumpe HE?", system.pumpCirculationHe);
      addRow("Umw\u00e4lzpumpe Stf", system.pumpCirculationStf, "");
      addRow("Speicherladepumpe", "", system.pumpStorageDraw);
      addFlag("Speicherladepumpe HE?", system.pumpStorageHe);
      addRow("Speicherladepumpe Stf", system.pumpStorageStf, "");
      addRow("Zirkulationspumpe", "", system.pumpRecircDraw);
      addFlag("Zirkulationspumpe HE?", system.pumpRecircHe);
      addRow("Zirkulationspumpe Stf", system.pumpRecircStf, "");
      if(rows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Anlagentechnik</div><div class="room-sub">Hersteller: ' + (system.systemManufacturer || "-") + '</div></div>',
          '<div class="badge">System</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          rows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
    }
    data.rooms.forEach(room => {
      const plate = [];
      const rippen = [];
      room.heaters.forEach(hk => {
        if((hk.bauform || "").toLowerCase() === "rippen") rippen.push(hk);
        else plate.push(hk);
      });
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">' + (room.roomName || "Raum " + room.index) + '</div><div class="room-sub">Geschoss: ' + (room.floor || "-") + '</div></div>',
        '<div class="badge">Raum ' + room.index + '</div>',
        '</div>',
        (plate.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>#</th><th>Bauform</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Breite [mm]</th><th>DN</th></tr></thead>',
          '<tbody>',
          plate.map((hk, i) => (
            '<tr>' +
            '<td>' + (i + 1) + '</td>' +
            '<td>' + (hk.bauform || "Platte") + '</td>' +
            '<td>' + renderCell(hk.type, hk.typeDraw) + '</td>' +
            '<td>' + renderCell(hk.height, hk.heightDraw) + '</td>' +
            '<td>' + renderCell(hk.width, hk.widthDraw) + '</td>' +
            '<td>' + renderCell(hk.dn, hk.dnDraw) + '</td>' +
            '</tr>'
          )).join(""),
          '</tbody></table>'
        ].join("") : ""),
        (rippen.length ? [
          '<table class="hk-table" style="margin-top:10px;">',
          '<thead><tr><th>#</th><th>Bauform</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Tiefe [mm]</th><th>Gliederzahl</th></tr></thead>',
          '<tbody>',
          rippen.map((hk, i) => (
            '<tr>' +
            '<td>' + (i + 1) + '</td>' +
            '<td>' + (hk.bauform || "Rippen") + '</td>' +
            '<td>' + renderCell(hk.type, hk.typeDraw) + '</td>' +
            '<td>' + renderCell(hk.height, hk.heightDraw) + '</td>' +
            '<td>' + renderCell(hk.width, hk.widthDraw) + '</td>' +
            '<td>' + renderCell(hk.dn, hk.dnDraw) + '</td>' +
            '</tr>'
          )).join(""),
          '</tbody></table>'
        ].join("") : ""),
        (!plate.length && !rippen.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>#</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Breite [mm]</th><th>DN</th></tr></thead>',
          '<tbody><tr><td>1</td><td>-</td><td>-</td><td>-</td><td>-</td></tr></tbody></table>'
        ].join("") : ""),
        '</section>'
      ].join(""));
    });
    container.innerHTML = [
      '<div class="doc-head"><h1>Aufnahme HK Daten</h1><div class="meta">Erstellt: ' + now + '</div></div>',
      sections.join("")
    ].join("");
    if(skipPrint) {
      document.body.classList.remove("show-print");
      return;
    }
    document.body.classList.add("show-print");
    // Force reflow before printing (iOS WebView)
    void container.offsetHeight;
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        setTimeout(() => window.print(), 300);
      });
    });
  }

  function updateShareCache(){
    const data = collectData();
    data.system.windows = collectWindowsFromDom();
    data.system.gaubes = collectGaubesFromDom();
    if(!hasAnyData(data)){
      shareHasData = false;
      shareHtmlCache = "";
      return;
    }
    renderPrint(data, true);
    const container = document.getElementById("printView");
    shareHtmlCache = container ? container.innerHTML : "";
    shareHasData = !!shareHtmlCache;
  }

  function buildShareHtml(reportMarkup){
    return [
      '<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>HK-Uebersicht</title>',
      '<style>',
      'body { font-family: "Segoe UI", Arial, sans-serif; margin: 24px; color: #0f172a; }',
      '.doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 14px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }',
      'h1 { margin: 0; font-size: 22px; }',
      '.meta { color: #6b7280; font-size: 13px; }',
      '.room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin: 0 0 14px; background: #fff; }',
      '.room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }',
      '.room-title { font-size: 18px; font-weight: 700; }',
      '.room-sub { color: #6b7280; font-size: 14px; }',
      '.badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }',
      'table { width: 100%; border-collapse: collapse; }',
      'th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }',
      '.window-table th, .window-table td { padding: 4px 6px; }',
      '.window-table .draw-img { max-height: 36px; max-width: 120px; }',
      'th { background: #f8fafc; font-weight: 700; }',
      '.draw-img { display: block; max-height: 60px; max-width: 140px; }',
      '</style></head><body>',
      reportMarkup || "",
      '</body></html>'
    ].join("");
  }

  function downloadFile(data){
    const now = new Date().toLocaleString();
    const markup = buildReportMarkup(data, now);
    const html = [
      '<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>HK-Erfassung</title>',
      '<style>',
      'body { font-family: "Segoe UI", Arial, sans-serif; margin: 24px; color: #0f172a; }',
      '.doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; }',
      'h1 { margin: 0; font-size: 22px; }',
      '.meta { color: #6b7280; font-size: 13px; }',
      '.room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin-bottom: 14px; background: #fff; }',
      '.room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }',
      '.room-title { font-size: 18px; font-weight: 700; }',
      '.room-sub { color: #6b7280; font-size: 14px; }',
      '.badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }',
      'table { width: 100%; border-collapse: collapse; }',
      'th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }',
      'th { background: #f8fafc; font-weight: 700; }',
      'td { background: #fff; }',
      '</style></head><body>',
      markup,
      '</body></html>'
    ].join("");
    const blob = new Blob([html], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "hk-daten.html";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 15000);
  }

  function downloadHtml(html, filename){
    const blob = new Blob([html], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename || "hk-uebersicht.html";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 15000);
  }

  const shareBtn = document.querySelector(".share-btn");
  const resetBtn = document.querySelector(".reset-btn");
  window.addEventListener("afterprint", () => {
    document.body.classList.remove("show-print");
  });
  if(shareBtn){
    shareBtn.addEventListener("click", async (event) => {
      event.preventDefault();
      event.stopPropagation();
      if(!shareHasData){
        updateShareCache();
      }
      if(!shareHasData){
        alert("Keine Daten erfasst.");
        return;
      }
      const html = buildShareHtml(shareHtmlCache);
      if(!navigator.share){
        downloadHtml(html, "hk-uebersicht.html");
        alert("Teilen ist auf diesem Ger\u00e4t nicht verf\u00fcgbar. Datei wurde heruntergeladen.");
        return;
      }
      try{
        const file = new File([html], "hk-uebersicht.html", { type: "text/html" });
        await navigator.share({ files: [file], title: "HK-\u00dcbersicht", text: "HK-\u00dcbersicht" });
      } catch(e){
        if(e && e.name === "AbortError") return;
        downloadHtml(html, "hk-uebersicht.html");
        alert("Teilen konnte nicht ge\u00f6ffnet werden. Datei wurde heruntergeladen.");
      }
    });
  }
  if(resetBtn){
    resetBtn.addEventListener("click", () => {
      if(confirm("Alle Eingaben zuruecksetzen?")){
        try { localStorage.removeItem(STORAGE_KEY); } catch(e){}
        location.reload();
      }
    });
  }
})();
</script>
</body>
</html>

