<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Aufnahme HK Daten</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="manifest.webmanifest">
    <style>
        :root { font-family: "Segoe UI", Arial, sans-serif; -webkit-text-size-adjust: 100%; }
        body { margin: 0; padding: calc(24px + env(safe-area-inset-top)) 16px calc(36px + env(safe-area-inset-bottom)); background: #f4f5f7; color: #1f2933; display: flex; justify-content: center; }
        .card { width: min(940px, 100%); background: #fff; border-radius: 16px; padding: 28px; box-shadow: 0 18px 40px rgba(15,23,42,0.12); border: 1px solid #e5e7eb; }
        h1 { margin: 0 0 6px; }
        p { margin: 0 0 20px; color: #4b5563; }
        form { display: flex; flex-direction: column; gap: 18px; }
        .room-card { border: 1px solid #d1d5db; border-radius: 14px; background: #fcfdff; }
        .system-card { border: 1px solid #d1d5db; border-radius: 14px; background: #fcfdff; }
        .system-row { display: flex; flex-direction: column; gap: 10px; }
        textarea { width: 100%; min-height: 72px; padding: 10px 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 16px; background: #fff; resize: vertical; }
        .hidden { display: none; }
        details { border-radius: 14px; }
        summary { list-style: none; cursor: pointer; padding: 18px 20px; display: flex; justify-content: space-between; align-items: center; color: #111827; font-weight: 600; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: "+"; font-size: 20px; transition: transform 0.2s; }
        details[open] summary::after { transform: rotate(45deg); }
        summary span { display: flex; flex-direction: column; }
        summary small { font-weight: normal; color: #6b7280; }
        .section-body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 16px; }
        .room-body { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 18px; }
        .field-row { display: grid; grid-template-columns: 170px 1fr 1fr; gap: 12px; align-items: center; }
        .field-row.single { grid-template-columns: 170px 1fr; }
        .field-row.dual { grid-template-columns: 170px 0.8fr 170px 0.8fr; column-gap: 2px; }
        .field-row.dual.type-row { grid-template-columns: 170px 1fr 170px 0.6fr; }
        .field-row.pump { grid-template-columns: 170px 1fr 70px 1fr; column-gap: 8px; }
        .label-shift-right { margin-left: 10px; }
        label { font-weight: 600; color: #1f2933; }
        select, input[type="text"] { width: 100%; padding: 10px 12px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 16px; background: #fff; }
        .inline-options { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
        .inline-options label { display: flex; align-items: center; gap: 6px; font-weight: 600; }
        .inline-options input { width: auto; }
        .inline-right { margin-left: auto; display: inline-flex; gap: 16px; align-items: center; }
        .check-grid { display: grid; grid-template-columns: repeat(2, minmax(160px, 1fr)); gap: 8px 16px; }
        .matrix-table { width: 100%; border-collapse: collapse; }
        .matrix-table th, .matrix-table td { border: 1px solid #e5e7eb; padding: 8px; vertical-align: top; text-align: left; }
        .matrix-table th { background: #f8fafc; font-weight: 700; }
        .draw-wrap { margin-top: 6px; display: flex; flex-direction: column; gap: 6px; }
        .draw-canvas { width: 100%; height: 44px; border: 1px dashed #cbd5e1; border-radius: 6px; background: #fff; touch-action: none; }
        .draw-wrap { margin-top: 0; }
        .draw-actions { justify-content: flex-end; }
        .draw-actions { display: none; }
        .draw-action { display: none; }
        .draw-toggle { display: none; }
        .draw-toggle.active { display: none; }
        small { display: none; margin-top: 4px; color: #64748b; font-weight: normal; }
        .hk-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 16px; background: #fff; display: flex; flex-direction: column; gap: 12px; }
        .hk-card h3 { margin: 0; font-size: 16px; color: #0f172a; }
        .hk-toggle { border: none; margin: 0; }
        .hk-toggle summary { padding: 12px 16px; border: 1px dashed #94a3b8; border-radius: 10px; font-weight: 600; font-size: 15px; color: #1d4ed8; background: #f8fafc; }
        .hk-toggle summary::after { content: "+"; font-size: 16px; }
        .hk-toggle[open] summary::after { content: "-"; }
        .hk-toggle .hk-card { margin-top: 10px; }
        .add-hk-btn, .add-room-btn, .export-btn, .reset-btn, .eraser-btn, .share-btn { margin: 10px 0 0; padding: 10px 14px; border-radius: 10px; border: 1px dashed #9ca3af; background: #f9fafb; color: #111827; font-weight: 600; cursor: pointer; width: 100%; text-align: center; }
        .add-hk-btn:active, .add-room-btn:active, .export-btn:active, .reset-btn:active, .eraser-btn:active, .share-btn:active { transform: translateY(1px); }
        .add-room-btn { margin-top: 16px; }
        .export-btn { border-color: #2563eb; color: #1d4ed8; background: #eef2ff; }
        .eraser-btn { border-color: #f59e0b; color: #92400e; background: #fef3c7; }
        .eraser-btn.active { background: #fee2e2; border-color: #fecaca; color: #991b1b; }
        .share-btn { border-color: #16a34a; color: #14532d; background: #dcfce7; }
        .share-btn.active { background: #bbf7d0; border-color: #86efac; }
        .reset-btn { border-color: #ef4444; color: #991b1b; background: #fef2f2; }
        .print-view { display: block; visibility: hidden; height: 0; overflow: hidden; }
        .print-view { font-family: "Segoe UI", Arial, sans-serif; color: #0f172a; padding: 18px; }
        .print-view .doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 14px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }
        .print-view h1 { margin: 0; font-size: 22px; }
        .print-view .meta { color: #6b7280; font-size: 13px; }
        .print-view .room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin: 0 0 14px; background: #fff; }
        .print-view .room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .print-view .room-title { font-size: 18px; font-weight: 700; }
        .print-view .room-sub { color: #6b7280; font-size: 14px; }
        .print-view .badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }
        .print-view table { width: 100%; border-collapse: collapse; }
        .print-view th, .print-view td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }
        .print-view th { background: #f8fafc; font-weight: 700; }
        .print-view .draw-img { display: block; max-height: 60px; max-width: 140px; }
        body.show-print .card { display: none; }
        body.show-print .print-view { visibility: visible; height: auto; overflow: visible; }
        @media print {
          body { background: #fff; }
          .card, .add-room-btn, .export-btn, .add-hk-btn { display: none !important; }
          .print-view { visibility: visible !important; height: auto !important; overflow: visible !important; }
          .print-view .room { break-inside: avoid; page-break-inside: avoid; }
        }
        @media (max-width: 720px) { .field-row, .field-row.single { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<main class="card">
    <header>
        <h1>Aufnahme HK Daten</h1>
    </header>
    <form>
        <details class="system-card" open>
            <summary><span>Anschrift</span></summary>
            <div class="section-body">
                <div class="field-row single">
                    <label for="addressNameDraw">Name</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressNameDraw" name="addressNameDraw">
                        <canvas class="draw-canvas" data-draw-target="addressNameDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressStreetDraw">Stra&szlig;e, Nr.</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressStreetDraw" name="addressStreetDraw">
                        <canvas class="draw-canvas" data-draw-target="addressStreetDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressCityDraw">PLZ/Ort</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressCityDraw" name="addressCityDraw">
                        <canvas class="draw-canvas" data-draw-target="addressCityDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressPhoneDraw">Telefon</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressPhoneDraw" name="addressPhoneDraw">
                        <canvas class="draw-canvas" data-draw-target="addressPhoneDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="addressEmailDraw">Email</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="addressEmailDraw" name="addressEmailDraw">
                        <canvas class="draw-canvas" data-draw-target="addressEmailDraw"></canvas>
                    </div>
                </div>
                <div class="system-row">
                    <label>Geb&auml;udedaten wie oben?</label>
                    <div class="inline-options">
                        <label><input type="radio" name="buildingData" value="Ja">Ja</label>
                        <label><input type="radio" name="buildingData" value="Nein">Nein</label>
                    </div>
                </div>
                <div class="system-row hidden" id="buildingDataDetails">
                    <div class="field-row single">
                        <label for="buildingStreetDraw">Stra&szlig;e, Nr.</label>
                        <div class="draw-wrap">
                            <input type="hidden" id="buildingStreetDraw" name="buildingStreetDraw">
                            <canvas class="draw-canvas" data-draw-target="buildingStreetDraw"></canvas>
                        </div>
                    </div>
                    <div class="field-row single">
                        <label for="buildingCityDraw">PLZ/Ort</label>
                        <div class="draw-wrap">
                            <input type="hidden" id="buildingCityDraw" name="buildingCityDraw">
                            <canvas class="draw-canvas" data-draw-target="buildingCityDraw"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card" open>
            <summary><span>Geb&auml;udetyp</span></summary>
            <div class="section-body">
                <div class="field-row dual">
                    <label for="buildingYearDraw">Baujahr</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="buildingYearDraw" name="buildingYearDraw">
                        <canvas class="draw-canvas" data-draw-target="buildingYearDraw"></canvas>
                    </div>
                    <label for="buildingUnits">Wohneinheiten</label>
                    <select id="buildingUnits" name="buildingUnits">
                        <option value="" selected disabled>Anzahl w&auml;hlen &hellip;</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                        <option>32</option>
                        <option>33</option>
                        <option>34</option>
                        <option>35</option>
                        <option>36</option>
                        <option>37</option>
                        <option>38</option>
                        <option>39</option>
                        <option>40</option>
                        <option>41</option>
                        <option>42</option>
                        <option>43</option>
                        <option>44</option>
                        <option>45</option>
                        <option>46</option>
                        <option>47</option>
                        <option>48</option>
                        <option>49</option>
                        <option>50</option>
                    </select>
                </div>
                <div class="field-row single">
                    <label>Geb&auml;udetyp</label>
                    <div class="check-grid">
                        <label><input type="checkbox" name="buildingTypeDetached">Freistehend</label>
                        <label><input type="checkbox" name="buildingTypeMultiFamily">Mehrfamilienhaus</label>
                        <label><input type="checkbox" name="buildingTypeEndTerrace">Reihenendhaus</label>
                        <label><input type="checkbox" name="buildingTypeMidTerrace">Reihenmittelhaus</label>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card" open>
            <summary><span>Geschossh&ouml;he, Kellerdecke/Bodenplatte, Au&szlig;enw&auml;nde</span></summary>
            <div class="section-body">
                <div class="field-row dual">
                    <label for="floorHeightBasementDraw">Keller</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeightBasementDraw" name="floorHeightBasementDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeightBasementDraw"></canvas>
                    </div>
                    <label for="floorHeightGroundDraw">Erdgeschoss</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeightGroundDraw" name="floorHeightGroundDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeightGroundDraw"></canvas>
                    </div>
                </div>
                <div class="field-row dual">
                    <label for="floorHeight1OgDraw">1.OG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeight1OgDraw" name="floorHeight1OgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeight1OgDraw"></canvas>
                    </div>
                    <label for="floorHeight2OgDraw">2.OG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeight2OgDraw" name="floorHeight2OgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeight2OgDraw"></canvas>
                    </div>
                </div>
                <div class="field-row dual">
                    <label for="floorHeight3OgDraw">3.OG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeight3OgDraw" name="floorHeight3OgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeight3OgDraw"></canvas>
                    </div>
                    <label for="floorHeightDgDraw">DG</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="floorHeightDgDraw" name="floorHeightDgDraw">
                        <canvas class="draw-canvas" data-draw-target="floorHeightDgDraw"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label>Art/Aufbau/Material</label>
                    <div class="inline-options">
                        <label><input type="checkbox" name="structureMassive">Massiv</label>
                        <label><input type="checkbox" name="structureWooden">Holzbalken</label>
                        <div class="inline-right">
                            <label>Keller beheizt</label>
                            <label><input type="radio" name="basementHeated" value="Ja">Ja</label>
                            <label><input type="radio" name="basementHeated" value="Nein">Nein</label>
                        </div>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="notesDraw">Notizen</label>
                    <div class="draw-wrap">
                        <input type="hidden" id="notesDraw" name="notesDraw">
                        <canvas class="draw-canvas" data-draw-target="notesDraw"></canvas>
                    </div>
                </div>
            </div>
        </details>
        <details class="system-card" open>
            <summary><span>Au&szlig;enw&auml;nde</span></summary>
            <div class="section-body">
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Aufbau</th>
                            <th>Schicht 1</th>
                            <th>Schicht 2</th>
                            <th>Schicht 3</th>
                            <th>Schicht 4</th>
                            <th>Schicht 5</th>
                            <th>Gesamtdicke</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Nord</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL1Draw" name="wallNorthL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL2Draw" name="wallNorthL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL3Draw" name="wallNorthL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL4Draw" name="wallNorthL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthL5Draw" name="wallNorthL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallNorthTotalDraw" name="wallNorthTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallNorthTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Ost</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL1Draw" name="wallEastL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL2Draw" name="wallEastL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL3Draw" name="wallEastL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL4Draw" name="wallEastL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastL5Draw" name="wallEastL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallEastTotalDraw" name="wallEastTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallEastTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>S&uuml;d</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL1Draw" name="wallSouthL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL2Draw" name="wallSouthL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL3Draw" name="wallSouthL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL4Draw" name="wallSouthL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthL5Draw" name="wallSouthL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallSouthTotalDraw" name="wallSouthTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallSouthTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>West</td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL1Draw" name="wallWestL1Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL1Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL2Draw" name="wallWestL2Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL2Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL3Draw" name="wallWestL3Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL3Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL4Draw" name="wallWestL4Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL4Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestL5Draw" name="wallWestL5Draw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestL5Draw"></canvas>
                                </div>
                            </td>
                            <td>
                                <div class="draw-wrap">
                                    <input type="hidden" id="wallWestTotalDraw" name="wallWestTotalDraw">
                                    <canvas class="draw-canvas" data-draw-target="wallWestTotalDraw"></canvas>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </details>
        <details class="system-card" open>
            <summary><span>Anlagentechnik</span></summary>
            <div class="section-body">
            <div class="field-row">
                <label for="systemManufacturer">Hersteller</label>
                <select id="systemManufacturer" name="systemManufacturer">
                    <option value="" selected disabled>Hersteller w&auml;hlen &hellip;</option>
                    <option>Viesmann</option>
                    <option>Bosch</option>
                    <option>Buderus</option>
                    <option>Junkers</option>
                </select>
                <div class="draw-wrap">
                    <input type="hidden" id="systemManufacturerDraw" name="systemManufacturerDraw">
                    <canvas class="draw-canvas" data-draw-target="systemManufacturerDraw"></canvas>
                </div>
            </div>
            <div class="field-row dual type-row">
                <label for="systemTypeDraw">Typ</label>
                <div class="draw-wrap">
                    <input type="hidden" id="systemTypeDraw" name="systemTypeDraw">
                    <canvas class="draw-canvas" data-draw-target="systemTypeDraw"></canvas>
                </div>
                <label for="systemPowerDraw" class="label-shift-right">Leistung</label>
                <div class="draw-wrap">
                    <input type="hidden" id="systemPowerDraw" name="systemPowerDraw">
                    <canvas class="draw-canvas" data-draw-target="systemPowerDraw"></canvas>
                </div>
            </div>
            <div class="field-row dual">
                <label for="systemYear">Baujahr</label>
                <select id="systemYear" name="systemYear">
                    <option value="" selected disabled>Baujahr w&auml;hlen &hellip;</option>
                    <option>2028</option>
                    <option>2027</option>
                    <option>2026</option>
                    <option>2025</option>
                    <option>2024</option>
                    <option>2023</option>
                    <option>2022</option>
                    <option>2021</option>
                    <option>2020</option>
                    <option>2019</option>
                    <option>2018</option>
                    <option>2017</option>
                    <option>2016</option>
                    <option>2015</option>
                    <option>2014</option>
                    <option>2013</option>
                    <option>2012</option>
                    <option>2011</option>
                    <option>2010</option>
                    <option>2009</option>
                    <option>2008</option>
                    <option>2007</option>
                    <option>2006</option>
                    <option>2005</option>
                    <option>2004</option>
                    <option>2003</option>
                    <option>2002</option>
                    <option>2001</option>
                    <option>2000</option>
                    <option>1999</option>
                    <option>1998</option>
                    <option>1997</option>
                    <option>1996</option>
                    <option>1995</option>
                    <option>1994</option>
                    <option>1993</option>
                    <option>1992</option>
                    <option>1991</option>
                    <option>1990</option>
                    <option>1989</option>
                    <option>1988</option>
                    <option>1987</option>
                    <option>1986</option>
                    <option>1985</option>
                    <option>1984</option>
                    <option>1983</option>
                    <option>1982</option>
                    <option>1981</option>
                    <option>1980</option>
                    <option>1979</option>
                    <option>1978</option>
                    <option>1977</option>
                    <option>1976</option>
                    <option>1975</option>
                    <option>1974</option>
                    <option>1973</option>
                    <option>1972</option>
                    <option>1971</option>
                    <option>1970</option>
                    <option>1969</option>
                    <option>1968</option>
                    <option>1967</option>
                    <option>1966</option>
                    <option>1965</option>
                    <option>1964</option>
                    <option>1963</option>
                    <option>1962</option>
                    <option>1961</option>
                    <option>1960</option>
                    <option>1959</option>
                    <option>1958</option>
                    <option>1957</option>
                    <option>1956</option>
                    <option>1955</option>
                    <option>1954</option>
                    <option>1953</option>
                    <option>1952</option>
                    <option>1951</option>
                    <option>1950</option>
                    <option>1949</option>
                    <option>1948</option>
                    <option>1947</option>
                    <option>1946</option>
                    <option>1945</option>
                    <option>1944</option>
                    <option>1943</option>
                    <option>1942</option>
                    <option>1941</option>
                    <option>1940</option>
                </select>
                <label for="systemFuel" class="label-shift-right">Brennstoff</label>
                <select id="systemFuel" name="systemFuel">
                    <option value="" selected disabled>Brennstoff w&auml;hlen &hellip;</option>
                    <option>Erdgas</option>
                    <option>&Ouml;l</option>
                    <option>Pellet</option>
                </select>
            </div>
            <div class="field-row single">
                <label for="systemLocation">Aufstellort der Heizung</label>
                <select id="systemLocation" name="systemLocation">
                    <option value="" selected disabled>Aufstellort w&auml;hlen &hellip;</option>
                    <option>Keller</option>
                    <option>Dachboden</option>
                    <option>In H&uuml;llfl&auml;che</option>
                    <option>Au&szlig;erhalb H&uuml;llfl&auml;che</option>
                </select>
            </div>
            <div class="field-row single">
                <label>Optionen</label>
                <div class="check-grid">
                    <label><input type="checkbox" name="optionNightReduction">Nachtabsenkung</label>
                    <label><input type="checkbox" name="optionHydraulicBalance">Hydr. Abgleich</label>
                    <label><input type="checkbox" name="optionHeaterNiches">Heizk&ouml;rpernieschen</label>
                    <label><input type="checkbox" name="optionCirculationTimed">Zirku. Zeitgesteuert</label>
                </div>
            </div>
            <div class="field-row dual">
                <label for="systemThermostatValves">Thermostatventile</label>
                <select id="systemThermostatValves" name="systemThermostatValves">
                    <option value="" selected disabled>Ventile w&auml;hlen &hellip;</option>
                    <option>1K</option>
                    <option>2K</option>
                    <option>Digital</option>
                </select>
                <label for="heatingCircuits">Anzahl Heizkreise</label>
                <select id="heatingCircuits" name="heatingCircuits">
                    <option value="" selected disabled>Anzahl w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <h3 style="margin:6px 0 0;font-size:16px;">Pumpen</h3>
            <div class="field-row pump">
                <label for="pumpCirculationDraw">Umw&auml;lzpumpe</label>
                <div class="draw-wrap">
                    <input type="hidden" id="pumpCirculationDraw" name="pumpCirculationDraw">
                    <canvas class="draw-canvas" data-draw-target="pumpCirculationDraw"></canvas>
                </div>
                <label><input type="checkbox" name="pumpCirculationHe">HE?</label>
                <select id="pumpCirculationStf" name="pumpCirculationStf">
                    <option value="" selected disabled>Stf w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <div class="field-row pump">
                <label for="pumpStorageDraw">Speicherladepumpe</label>
                <div class="draw-wrap">
                    <input type="hidden" id="pumpStorageDraw" name="pumpStorageDraw">
                    <canvas class="draw-canvas" data-draw-target="pumpStorageDraw"></canvas>
                </div>
                <label><input type="checkbox" name="pumpStorageHe">HE?</label>
                <select id="pumpStorageStf" name="pumpStorageStf">
                    <option value="" selected disabled>Stf w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <div class="field-row pump">
                <label for="pumpRecircDraw">Zirkulationspumpe</label>
                <div class="draw-wrap">
                    <input type="hidden" id="pumpRecircDraw" name="pumpRecircDraw">
                    <canvas class="draw-canvas" data-draw-target="pumpRecircDraw"></canvas>
                </div>
                <label><input type="checkbox" name="pumpRecircHe">HE?</label>
                <select id="pumpRecircStf" name="pumpRecircStf">
                    <option value="" selected disabled>Stf w&auml;hlen &hellip;</option>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                </select>
            </div>
            <div class="field-row dual">
                <label for="heatDistribution">W&auml;rmeverteilung</label>
                <select id="heatDistribution" name="heatDistribution">
                    <option value="" selected disabled>Verteilung w&auml;hlen &hellip;</option>
                    <option>Fu&szlig;bodenheizung</option>
                    <option>Heizk&ouml;rper</option>
                </select>
                <label for="pipeInsulation">D&auml;mmung der Rohrleitung</label>
                <select id="pipeInsulation" name="pipeInsulation">
                    <option value="" selected disabled>D&auml;mmung w&auml;hlen &hellip;</option>
                    <option>Keine D&auml;mmung</option>
                    <option>halbe GEG</option>
                    <option>ganze GEG</option>
                </select>
            </div>
            <h3 style="margin:6px 0 0;font-size:16px;">Fu&szlig;bodenheizung</h3>
            <div class="system-row">
                <label>Fl&auml;chenheizung vorhanden?</label>
                <div class="inline-options">
                    <label><input type="radio" name="surfaceHeating" value="Ja">Ja</label>
                    <label><input type="radio" name="surfaceHeating" value="Nein">Nein</label>
                </div>
            </div>
            <div class="system-row" id="surfaceHeatingDetails">
                <div class="inline-options">
                    <label><input type="checkbox" name="surfaceHeatingDistributorPhoto">Foto vom Verteiler</label>
                </div>
                <div class="field-row single">
                    <label for="distributorDn">Verteiler DN</label>
                    <input type="hidden" id="distributorDn" name="distributorDn">
                    <div class="draw-wrap">
                        <canvas id="distributorDnDraw" class="draw-canvas" data-draw-target="distributorDn"></canvas>
                    </div>
                </div>
                <div class="field-row single">
                    <label for="layingSpacing">Verlegeabstand</label>
                    <select id="layingSpacing" name="layingSpacing">
                        <option value="" selected disabled>Abstand w&auml;hlen &hellip;</option>
                        <option>5</option>
                        <option>5.5</option>
                        <option>7.5</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12.5</option>
                        <option>15</option>
                        <option>16.5</option>
                        <option>20</option>
                        <option>22.5</option>
                        <option>25</option>
                        <option>27.5</option>
                        <option>30</option>
                    </select>
                </div>
                <div class="field-row single">
                    <label for="fBHLineDiameter">Durchmesser Leitung FBH</label>
                    <select id="fBHLineDiameter" name="fBHLineDiameter">
                        <option value="" selected disabled>Durchmesser w&auml;hlen &hellip;</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                        <option>32</option>
                        <option>33</option>
                        <option>34</option>
                        <option>35</option>
                        <option>36</option>
                        <option>37</option>
                        <option>38</option>
                        <option>39</option>
                        <option>40</option>
                        <option>41</option>
                        <option>42</option>
                        <option>43</option>
                        <option>44</option>
                        <option>45</option>
                        <option>46</option>
                        <option>47</option>
                        <option>48</option>
                        <option>49</option>
                        <option>50</option>
                    </select>
                </div>
            </div>
            </div>
        </details>
        <details class="system-card" open>
            <summary><span>R&auml;ume</span></summary>
            <div class="section-body">
        <section class="room-card">
            <details open>
                <summary><span data-room-label data-default="Raum 1">Raum 1 <small>Geschoss zuerst w&auml;hlen</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room1Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room1Floor" name="room1Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room1Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room1Name" name="room1Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm1">Platte</label>
                                    <label><input type="radio" name="room1HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm2">Platte</label>
                                    <label><input type="radio" name="room1HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room1HkForm3">Platte</label>
                                    <label><input type="radio" name="room1HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room1HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room1HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room1HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room1HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room1HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room1HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room1HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room1HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 2">Raum 2 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room2Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room2Floor" name="room2Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room2Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room2Name" name="room2Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm1">Platte</label>
                                    <label><input type="radio" name="room2HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm2">Platte</label>
                                    <label><input type="radio" name="room2HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room2HkForm3">Platte</label>
                                    <label><input type="radio" name="room2HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room2HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room2HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room2HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room2HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room2HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room2HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room2HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room2HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 3">Raum 3 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room3Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room3Floor" name="room3Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room3Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room3Name" name="room3Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm1">Platte</label>
                                    <label><input type="radio" name="room3HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm2">Platte</label>
                                    <label><input type="radio" name="room3HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room3HkForm3">Platte</label>
                                    <label><input type="radio" name="room3HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room3HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room3HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room3HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room3HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room3HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room3HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room3HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room3HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 4">Raum 4 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room4Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room4Floor" name="room4Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room4Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room4Name" name="room4Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm1">Platte</label>
                                    <label><input type="radio" name="room4HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm2">Platte</label>
                                    <label><input type="radio" name="room4HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room4HkForm3">Platte</label>
                                    <label><input type="radio" name="room4HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room4HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room4HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room4HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room4HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room4HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room4HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room4HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room4HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <section class="room-card">
            <details>
                <summary><span data-room-label data-default="Raum 5">Raum 5 <small>Optional einblendbar</small></span><span></span></summary>
                <div class="room-body">
                    <div class="field-row single"><label for="room5Floor">Geschoss<small>EG bis DG</small></label>
                        <select id="room5Floor" name="room5Floor">
                            <option value="" selected disabled>Geschoss w&auml;hlen &hellip;</option>
                            <option>EG</option>
                            <option>1.OG</option>
                            <option>2.OG</option>
                            <option>3.OG</option>
                            <option>4.OG</option>
                            <option>5.OG</option>
                            <option>DG</option>
                        </select></div>
                    <div class="field-row single"><label for="room5Name">Raum<small>WZ, EZ, BZ, WC, SZ, KI, AR, K&uuml;</small></label>
                        <select id="room5Name" name="room5Name">
                            <option value="" selected disabled>Raum w&auml;hlen &hellip;</option>
                            <option>WZ</option>
                            <option>EZ</option>
                            <option>BZ</option>
                            <option>WC</option>
                            <option>SZ</option>
                            <option>KI</option>
                            <option>AR</option>
                            <option>K&uuml;</option>
                        </select></div>
                    <div class="hk-stack">
                        <article class="hk-card">
                            <h3>Heizk&ouml;rper 1</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm1">Platte</label>
                                    <label><input type="radio" name="room5HkForm1">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType1">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType1Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight1">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight1Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth1">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth1Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn1">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn1Custom" placeholder="anderes DN">
                            </div>
                        </article>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 2 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 2</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm2">Platte</label>
                                    <label><input type="radio" name="room5HkForm2">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType2">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType2Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight2">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight2Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth2">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth2Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn2">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn2Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                        <details class="hk-toggle">
                            <summary>+ Heizk&ouml;rper 3 erfassen</summary>
                            <article class="hk-card">
                            <h3>Heizk&ouml;rper 3</h3>
                            <div class="field-row">
                                <label>Bauform</label>
                                <div class="inline-options">
                                    <label><input type="radio" name="room5HkForm3">Platte</label>
                                    <label><input type="radio" name="room5HkForm3">Rippen</label>
                                </div>
                            </div>
                            <div class="field-row">
                                <label>HK Typ<small>10, 11, 12, 20, 21, 22, 33, 34</small></label>
                                <select name="room5HkType3">
                                    <option value="" selected disabled>Typ w&auml;hlen &hellip;</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                                    <option>20</option>
                                    <option>21</option>
                                    <option>22</option>
                                    <option>33</option>
                                    <option>34</option>
                                    <option>Bad HK</option>
                                    <option>Sonderbauform</option>
                                    <option>FBE</option>
</select>
                                <input type="text" name="room5HkType3Custom" placeholder="eigener Typ">
                            </div>
                            <div class="field-row">
                                <label>H&ouml;he [mm]<small>400, 600, 800, 900</small></label>
                                <select name="room5HkHeight3">
                                    <option value="" selected disabled>H&ouml;he w&auml;hlen &hellip;</option>
                                    <option>300</option>`r`n                                    <option>400</option>`r`n                                    <option>600</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>
                                </select>
                                <input type="text" name="room5HkHeight3Custom" placeholder="andere H&ouml;he">
                            </div>
                            <div class="field-row">
                                <label>Breite [mm]<small>500, 600, 900, 1000, 1200, 1400</small></label>
                                <select name="room5HkWidth3">
                                    <option value="" selected disabled>Breite w&auml;hlen &hellip;</option>
                                    <option>400</option>`r`n                                    <option>500</option>`r`n                                    <option>600</option>`r`n                                    <option>700</option>`r`n                                    <option>800</option>`r`n                                    <option>900</option>`r`n                                    <option>1100</option>`r`n                                    <option>1200</option>`r`n                                    <option>1300</option>`r`n                                    <option>1400</option>`r`n                                    <option>1600</option>`r`n                                    <option>1800</option>`r`n                                    <option>2000</option>`r`n                                    <option>2300</option>`r`n                                    <option>2400</option>`r`n                                    <option>2600</option>`r`n                                    <option>3000</option></select>
                                <input type="text" name="room5HkWidth3Custom" placeholder="andere Breite">
                            </div>
                            <div class="field-row">
                                <label>DN<small>z.&nbsp;B. DN15, DN20</small></label>
                                <select name="room5HkDn3">
                                    <option value="" selected disabled>DN w&auml;hlen &hellip;</option>
                                    <option>DN10</option>
                                    <option>DN15</option>
                                    <option>DN20</option>
                                    <option>DN25</option>
                                    <option>DN32</option>
                                </select>
                                <input type="text" name="room5HkDn3Custom" placeholder="anderes DN">
                            </div>
                            </article>
                        </details>
                    </div>
                </div>
            </details>
        </section>
        <button type="button" class="add-room-btn">+ Raum hinzuf&uuml;gen</button>
            </div>
        </details>
        <button type="button" class="share-btn">Teilen</button>
        <button type="button" class="eraser-btn">Radierer</button>
        <button type="button" class="reset-btn">Alles reseten</button>
    </form>
</main>
<div id="printView" class="print-view" aria-hidden="true"></div>
<script>
(function(){
  const STORAGE_KEY = "hkFormStateV1";
  let saveTimer = null;
  let eraserMode = false;
  const eraserBtn = document.querySelector(".eraser-btn");
  if(eraserBtn){
    eraserBtn.addEventListener("click", () => {
      eraserMode = !eraserMode;
      eraserBtn.classList.toggle("active", eraserMode);
    });
  }
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js?v=5").then(reg => {
        reg.update().catch(() => {});
      }).catch(() => {});
    });
  }
  function updateLabels(){
    const cards = document.querySelectorAll(".room-card");
    const seen = {};
    cards.forEach(card => {
      const label = card.querySelector("[data-room-label]");
      const roomSel = card.querySelector('select[name$="Name"]');
      const floorSel = card.querySelector('select[name$="Floor"]');
      if(!label || !roomSel || !floorSel) return;
      const base = label.dataset.default || label.textContent.trim();
      const room = roomSel.value;
      const floor = floorSel.value;
      let text = base;
      if(room){
        seen[room] = (seen[room] || 0) + 1;
        const suffix = seen[room] > 1 ? seen[room] : "";
        text = room + suffix + (floor ? ` (${floor})` : "");
      }
      const small = label.querySelector("small");
      label.textContent = "";
      label.append(document.createTextNode(text + " "));
      if(small) label.append(small);
    });
  }

  function attachRoomListeners(card){
    const roomSel = card.querySelector('select[name$="Name"]');
    const floorSel = card.querySelector('select[name$="Floor"]');
    roomSel && roomSel.addEventListener("change", updateLabels);
    floorSel && floorSel.addEventListener("change", updateLabels);
  }

  function cacheDefaults(hk){
    hk.querySelectorAll("label").forEach(label => {
      if(!label.dataset.defaultLabel) label.dataset.defaultLabel = label.innerHTML;
    });
    hk.querySelectorAll("select").forEach(sel => {
      if(sel.dataset.defaultOptions) return;
      const opts = Array.from(sel.options).map(opt => ({
        value: opt.value,
        text: opt.text,
        disabled: opt.disabled
      }));
      sel.dataset.defaultOptions = JSON.stringify(opts);
    });
    hk.querySelectorAll('input[type="text"]').forEach(inp => {
      if(!inp.dataset.defaultPlaceholder) inp.dataset.defaultPlaceholder = inp.placeholder || "";
    });
  }

  function restoreSelect(sel){
    if(!sel || !sel.dataset.defaultOptions) return;
    let opts = [];
    try { opts = JSON.parse(sel.dataset.defaultOptions); } catch(e){ opts = []; }
    sel.innerHTML = "";
    opts.forEach(opt => {
      const el = document.createElement("option");
      el.value = opt.value;
      el.textContent = opt.text;
      if(opt.disabled) el.disabled = true;
      sel.appendChild(el);
    });
    sel.selectedIndex = 0;
  }

  function setSelectOptions(sel, placeholder, values){
    if(!sel) return;
    sel.innerHTML = "";
    const first = document.createElement("option");
    first.value = "";
    first.textContent = placeholder;
    first.disabled = true;
    first.selected = true;
    sel.appendChild(first);
    values.forEach(val => {
      const opt = document.createElement("option");
      opt.value = val;
      opt.textContent = val;
      sel.appendChild(opt);
    });
  }

  function applyBauform(hk){
    const checked = hk.querySelector('input[type="radio"][name*="HkForm"]:checked');
    const checkedText = checked && checked.parentElement ? checked.parentElement.textContent : "";
    const isRippen = !!(checked && /Rippen/i.test(checkedText));
    cacheDefaults(hk);
    const heightSel = hk.querySelector('select[name*="HkHeight"]');
    const widthSel = hk.querySelector('select[name*="HkWidth"]');
    const dnSel = hk.querySelector('select[name*="HkDn"]');
    const typeSel = hk.querySelector('select[name*="HkType"]');
    const heightRow = heightSel ? heightSel.closest(".field-row") : null;
    const widthRow = widthSel ? widthSel.closest(".field-row") : null;
    const dnRow = dnSel ? dnSel.closest(".field-row") : null;
    const typeRow = typeSel ? typeSel.closest(".field-row") : null;
    const heightInput = hk.querySelector('input[name*="HkHeight"]');
    const widthInput = hk.querySelector('input[name*="HkWidth"]');
    const dnInput = hk.querySelector('input[name*="HkDn"]');

    if(isRippen){
      if(typeRow){
        const label = typeRow.querySelector("label");
        if(label) label.innerHTML = "HK Typ<small>Guss, Stahl</small>";
      }
      if(heightRow){
        const label = heightRow.querySelector("label");
        if(label) label.innerHTML = "H\u00f6he [mm]<small>280, 430, 580, 680, 880, 980</small>";
      }
      if(widthRow){
        const label = widthRow.querySelector("label");
        if(label) label.innerHTML = "Tiefe [mm]<small>70, 110, 160, 220, 250</small>";
      }
      if(dnRow){
        const label = dnRow.querySelector("label");
        if(label) label.innerHTML = "Gliederzahl<small>1 bis 100</small>";
      }
      setSelectOptions(typeSel, "Typ w\u00e4hlen ...", ["Guss","Stahl"]);
      setSelectOptions(heightSel, "H\u00f6he w\u00e4hlen ...", ["280","430","580","680","880","980"]);
      setSelectOptions(widthSel, "Tiefe w\u00e4hlen ...", ["70","110","160","220","250"]);
      const glieder = Array.from({length: 100}, (_, i) => String(i + 1));
      setSelectOptions(dnSel, "Gliederzahl w\u00e4hlen ...", glieder);
      if(heightInput) { heightInput.placeholder = "andere H\u00f6he"; heightInput.value = ""; }
      if(widthInput) { widthInput.placeholder = "andere Tiefe"; widthInput.value = ""; }
      if(dnInput) { dnInput.placeholder = "andere Gliederzahl"; dnInput.value = ""; }
    } else {
      if(typeRow){
        const label = typeRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(heightRow){
        const label = heightRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(widthRow){
        const label = widthRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      if(dnRow){
        const label = dnRow.querySelector("label");
        if(label && label.dataset.defaultLabel) label.innerHTML = label.dataset.defaultLabel;
      }
      restoreSelect(typeSel);
      restoreSelect(heightSel);
      restoreSelect(widthSel);
      restoreSelect(dnSel);
      if(heightInput && heightInput.dataset.defaultPlaceholder) heightInput.placeholder = heightInput.dataset.defaultPlaceholder;
      if(widthInput && widthInput.dataset.defaultPlaceholder) widthInput.placeholder = widthInput.dataset.defaultPlaceholder;
      if(dnInput && dnInput.dataset.defaultPlaceholder) dnInput.placeholder = dnInput.dataset.defaultPlaceholder;
    }
  }

  function attachBauformListeners(container){
    const hkCards = container.classList && container.classList.contains("hk-card")
      ? [container]
      : Array.from(container.querySelectorAll(".hk-card"));
    hkCards.forEach(hk => {
      hk.querySelectorAll('input[type="radio"][name*="HkForm"]').forEach(radio => {
        if(radio.dataset.bound) return;
        radio.dataset.bound = "1";
        if(!radio.hasAttribute("value") || radio.value === "on"){
          const text = radio.parentElement ? radio.parentElement.textContent : "";
          radio.value = /Rippen/i.test(text) ? "Rippen" : "Platte";
        }
        radio.addEventListener("change", () => applyBauform(hk));
      });
      applyBauform(hk);
    });
  }

  document.querySelectorAll(".room-card").forEach(attachRoomListeners);
  attachBauformListeners(document);
  updateLabels();

  function isLikelyStylusPointer(e){
    if(typeof e.pointerType !== "string") return false;
    if(e.pointerType === "pen") return true;
    if(e.pointerType !== "touch") return false;
    const w = typeof e.width === "number" ? e.width : 0;
    const h = typeof e.height === "number" ? e.height : 0;
    const pressure = typeof e.pressure === "number" ? e.pressure : 0;
    const tilt = (typeof e.tiltX === "number" ? Math.abs(e.tiltX) : 0) +
      (typeof e.tiltY === "number" ? Math.abs(e.tiltY) : 0);
    if(tilt > 0) return true;
    if(w && h && Math.max(w, h) <= 10 && pressure >= 0.2) return true;
    return false;
  }

  function isLikelyStylusTouch(e){
    if(!e.touches || !e.touches[0]) return false;
    const touch = e.touches[0];
    if(typeof touch.touchType === "string") return touch.touchType === "stylus";
    const radius = Math.max(touch.radiusX || 0, touch.radiusY || 0);
    const force = typeof touch.force === "number" ? touch.force : 0;
    if(radius && radius <= 8 && force >= 0.2) return true;
    return false;
  }

  function isStylusEvent(e){
    if(isLikelyStylusPointer(e)) return true;
    if(isLikelyStylusTouch(e)) return true;
    return false;
  }

  function setupDrawingInputs(container){
    const inputs = (container || document).querySelectorAll('input[type="text"][name$="Custom"]');
    inputs.forEach(input => {
      if(input.dataset.drawEnhanced) return;
      input.dataset.drawEnhanced = "1";
      const wrap = document.createElement("div");
      wrap.className = "draw-wrap";
      const canvas = document.createElement("canvas");
      canvas.className = "draw-canvas";
      wrap.append(canvas);

      const hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = input.name;
      hidden.dataset.drawing = "";
      input.insertAdjacentElement("afterend", wrap);
      input.replaceWith(hidden);

      const ctx = canvas.getContext("2d");
      function resizeCanvas(){
        const rect = canvas.getBoundingClientRect();
        const dpr = (window.devicePixelRatio || 1) * 2;
        canvas.width = Math.max(1, Math.floor(rect.width * dpr));
        canvas.height = Math.max(1, Math.floor(rect.height * dpr));
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.lineWidth = 1.5;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.strokeStyle = "#0f172a";
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      let drawing = false;
      function posFromEvent(e){
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
      }
      function applyMode(){
        const erasing = eraserMode;
        ctx.globalCompositeOperation = erasing ? "destination-out" : "source-over";
        ctx.lineWidth = erasing ? 6 : 1.5;
      }
      function start(e){
        if(!isStylusEvent(e)) return;
        drawing = true;
        applyMode();
        const p = posFromEvent(e);
        ctx.beginPath();
        ctx.moveTo(p.x, p.y);
        e.preventDefault();
      }
      function move(e){
        if(!drawing || !isStylusEvent(e)) return;
        const p = posFromEvent(e);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        e.preventDefault();
      }
      function end(){
        if(!drawing) return;
        drawing = false;
        hidden.dataset.drawing = canvas.toDataURL("image/png");
        scheduleSave();
      }
      canvas.addEventListener("pointerdown", start);
      canvas.addEventListener("pointermove", move);
      canvas.addEventListener("pointerup", end);
      canvas.addEventListener("pointerleave", end);
      canvas.addEventListener("touchstart", start, { passive: false });
      canvas.addEventListener("touchmove", move, { passive: false });
      canvas.addEventListener("touchend", end);

      // keine Loeschen-Aktion
    });
  }

  setupDrawingInputs(document);

  function resizeDrawCanvas(canvas, ctx){
    const rect = canvas.getBoundingClientRect();
    const dpr = (window.devicePixelRatio || 1) * 2;
    canvas.width = Math.max(1, Math.floor(rect.width * dpr));
    canvas.height = Math.max(1, Math.floor(rect.height * dpr));
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    ctx.lineWidth = 1.5;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.strokeStyle = "#0f172a";
  }


  function initDrawCanvas(canvas, hidden){
    const ctx = canvas.getContext("2d");
    function resizeCanvas(){
      resizeDrawCanvas(canvas, ctx);
    }
    resizeCanvas();
    canvas.dataset.resizeHook = "1";
    window.addEventListener("resize", resizeCanvas);

    let drawing = false;
    function posFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      return { x: clientX - rect.left, y: clientY - rect.top };
    }
    function applyMode(){
      const erasing = eraserMode;
      ctx.globalCompositeOperation = erasing ? "destination-out" : "source-over";
      ctx.lineWidth = erasing ? 6 : 1.5;
    }
    function start(e){
      if(!isStylusEvent(e)) return;
      drawing = true;
      applyMode();
      const p = posFromEvent(e);
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
      e.preventDefault();
    }
    function move(e){
      if(!drawing || !isStylusEvent(e)) return;
      const p = posFromEvent(e);
      ctx.lineTo(p.x, p.y);
      ctx.stroke();
      e.preventDefault();
    }
    function end(){
      if(!drawing) return;
      drawing = false;
      hidden.dataset.drawing = canvas.toDataURL("image/png");
      scheduleSave();
    }
    canvas.addEventListener("pointerdown", start);
    canvas.addEventListener("pointermove", move);
    canvas.addEventListener("pointerup", end);
    canvas.addEventListener("pointerleave", end);
    canvas.addEventListener("touchstart", start, { passive: false });
    canvas.addEventListener("touchmove", move, { passive: false });
    canvas.addEventListener("touchend", end);
  }

  document.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
    const targetId = canvas.getAttribute("data-draw-target");
    const hidden = targetId ? document.getElementById(targetId) : null;
    if(hidden) initDrawCanvas(canvas, hidden);
  });

  const surfaceHeatingRadios = document.querySelectorAll('input[name="surfaceHeating"]');
  const surfaceHeatingDetails = document.getElementById("surfaceHeatingDetails");
  function toggleSurfaceHeating(){
    if(!surfaceHeatingDetails) return;
    surfaceHeatingDetails.classList.remove("hidden");
    surfaceHeatingDetails.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
      const ctx = canvas.getContext("2d");
      if(ctx) resizeDrawCanvas(canvas, ctx);
    });
  }
  surfaceHeatingRadios.forEach(r => r.addEventListener("change", toggleSurfaceHeating));
  toggleSurfaceHeating();
  const buildingDataRadios = document.querySelectorAll('input[name="buildingData"]');
  const buildingDataDetails = document.getElementById("buildingDataDetails");
  function toggleBuildingData(){
    if(!buildingDataDetails) return;
    const checked = document.querySelector('input[name="buildingData"]:checked');
    buildingDataDetails.classList.toggle("hidden", !(checked && checked.value === "Nein"));
    if(checked && checked.value === "Nein"){
      buildingDataDetails.querySelectorAll("canvas[data-draw-target]").forEach(canvas => {
        const ctx = canvas.getContext("2d");
        if(ctx) resizeDrawCanvas(canvas, ctx);
      });
    }
  }
  buildingDataRadios.forEach(r => r.addEventListener("change", toggleBuildingData));
  restoreFormState();
  toggleBuildingData();

  function collectFormState(){
    const roomCount = document.querySelectorAll(".room-card").length;
    const hkCounts = {};
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      hkCounts[String(idx + 1)] = card.querySelectorAll(".hk-card").length;
    });
    const values = {};
    document.querySelectorAll("input, select, textarea").forEach(el => {
      if(!el.name) return;
      if(el.type === "radio"){
        if(el.checked) values[el.name] = { type: "radio", value: el.value };
        return;
      }
      if(el.type === "checkbox"){
        values[el.name] = { type: "checkbox", checked: el.checked };
        return;
      }
      if(el.type === "hidden" && el.dataset.drawing){
        values[el.name] = { type: "hidden", value: el.value || "", drawing: el.dataset.drawing };
        return;
      }
      values[el.name] = { type: el.type, value: el.value };
    });
    return { roomCount, hkCounts, values };
  }

  function scheduleSave(){
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(() => {
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(collectFormState()));
      } catch(e){}
    }, 300);
  }

  function findCanvasForHidden(hidden){
    if(hidden.id){
      const byId = document.querySelector('canvas[data-draw-target="' + hidden.id + '"]');
      if(byId) return byId;
    }
    const next = hidden.nextElementSibling;
    if(next && next.classList && next.classList.contains("draw-wrap")){
      const canvas = next.querySelector("canvas");
      if(canvas) return canvas;
    }
    return null;
  }

  function drawDataUrl(canvas, dataUrl){
    if(!canvas || !dataUrl) return;
    const ctx = canvas.getContext("2d");
    resizeDrawCanvas(canvas, ctx);
    const rect = canvas.getBoundingClientRect();
    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 0, 0, rect.width, rect.height);
    };
    img.src = dataUrl;
  }

  function restoreFormState(){
    let raw = null;
    try { raw = localStorage.getItem(STORAGE_KEY); } catch(e) { raw = null; }
    if(!raw) return;
    let state = null;
    try { state = JSON.parse(raw); } catch(e){ state = null; }
    if(!state) return;
    const currentRooms = document.querySelectorAll(".room-card").length;
    const addRoomBtnLocal = document.querySelector(".add-room-btn");
    if(addRoomBtnLocal && state.roomCount && state.roomCount > currentRooms){
      for(let i = currentRooms; i < state.roomCount; i++){
        addRoomBtnLocal.click();
      }
    }
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      const target = state.hkCounts ? state.hkCounts[String(idx + 1)] : null;
      if(!target) return;
      const stack = card.querySelector(".hk-stack");
      if(!stack) return;
      while(stack.querySelectorAll(".hk-card").length < target){
        addHeater(stack);
      }
    });
    const values = state.values || {};
    Object.keys(values).forEach(name => {
      const data = values[name];
      const els = document.querySelectorAll('[name="' + name + '"]');
      if(!els.length) return;
      if(data.type === "radio"){
        els.forEach(el => { el.checked = (el.value === data.value); });
        return;
      }
      if(data.type === "checkbox"){
        els.forEach(el => { el.checked = !!data.checked; });
        return;
      }
      els.forEach(el => {
        if(data.type === "hidden" && data.drawing){
          el.dataset.drawing = data.drawing;
          const canvas = findCanvasForHidden(el);
          if(canvas) drawDataUrl(canvas, data.drawing);
        } else if("value" in data){
          el.value = data.value;
        }
      });
    });
    toggleSurfaceHeating();
    updateLabels();
  }

  document.addEventListener("input", scheduleSave, true);
  document.addEventListener("change", scheduleSave, true);
  window.addEventListener("beforeunload", scheduleSave);

  function addHeater(stack){
    const heaters = stack.querySelectorAll(".hk-card");
    if(!heaters.length) return;
    const template = heaters[heaters.length - 1];
    const clone = template.cloneNode(true);
    const nextIndex = heaters.length + 1;
    const title = clone.querySelector("h3");
    if(title) title.textContent = "Heizk\u00f6rper " + nextIndex;
    clone.querySelectorAll("select").forEach(sel => sel.selectedIndex = 0);
    clone.querySelectorAll("input").forEach(inp => inp.value = "");
    clone.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    clone.querySelectorAll(".draw-wrap").forEach(wrap => wrap.remove());
    clone.querySelectorAll('input[type="hidden"][name$="Custom"]').forEach(inp => {
      delete inp.dataset.drawing;
      delete inp.dataset.drawEnhanced;
    });
    clone.querySelectorAll("select,input").forEach(el => {
      const name = el.getAttribute("name");
      if(!name) return;
      const match = name.match(/^(room\d+Hk[A-Za-z]+?)(\d+)$/);
      if(match) el.setAttribute("name", match[1] + nextIndex);
    });
    stack.appendChild(clone);
    attachBauformListeners(clone);
    setupDrawingInputs(clone);
    scheduleSave();
  }

  function enhanceStack(stack){
    if(!stack || stack.dataset.enhanced) return;
    stack.dataset.enhanced = "1";
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "add-hk-btn";
    btn.textContent = "+ Heizk\u00f6rper hinzuf\u00fcgen";
    btn.addEventListener("click", () => addHeater(stack));
    const parent = stack.parentNode;
    if(parent){
      parent.querySelectorAll(".add-hk-btn").forEach(x => x.remove());
      parent.appendChild(btn);
    }
  }

  document.querySelectorAll(".hk-stack").forEach(enhanceStack);

  function resetRoomCard(card, index){
    card.querySelectorAll(".add-hk-btn").forEach(btn => btn.remove());
    card.querySelectorAll(".hk-stack").forEach(stack => stack.removeAttribute("data-enhanced"));
    card.querySelectorAll("details").forEach(det => det.open = false);
    const label = card.querySelector("[data-room-label]");
    if(label){
      const small = label.querySelector("small");
      label.dataset.default = "Raum " + index;
      label.textContent = "";
      label.append(document.createTextNode("Raum " + index + " "));
      if(small) label.append(small);
    }
    card.querySelectorAll("input").forEach(inp => inp.value = "");
    card.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    card.querySelectorAll("select").forEach(sel => sel.selectedIndex = 0);
    card.querySelectorAll(".draw-wrap").forEach(wrap => wrap.remove());
    card.querySelectorAll('input[type="hidden"][name$="Custom"]').forEach(inp => {
      delete inp.dataset.drawing;
      delete inp.dataset.drawEnhanced;
    });
    card.querySelectorAll("h3").forEach((h3, i) => h3.textContent = "Heizk\u00f6rper " + (i + 1));
    card.querySelectorAll("[id]").forEach(el => {
      const id = el.id;
      if(id) el.id = id.replace(/room\d+/, "room" + index);
    });
    card.querySelectorAll("label[for]").forEach(lab => {
      if(lab.htmlFor) lab.htmlFor = lab.htmlFor.replace(/room\d+/, "room" + index);
    });
    card.querySelectorAll("[name]").forEach(el => {
      const name = el.getAttribute("name");
      if(name) el.setAttribute("name", name.replace(/room\d+/, "room" + index));
    });
  }

  const addRoomBtn = document.querySelector(".add-room-btn");
  const form = document.querySelector("form");
  const roomTemplate = document.querySelector(".room-card");
  if(addRoomBtn && form && roomTemplate){
    addRoomBtn.addEventListener("click", () => {
      const nextIndex = document.querySelectorAll(".room-card").length + 1;
      const clone = roomTemplate.cloneNode(true);
      resetRoomCard(clone, nextIndex);
      form.insertBefore(clone, addRoomBtn);
      attachRoomListeners(clone);
      clone.querySelectorAll(".hk-stack").forEach(enhanceStack);
      attachBauformListeners(clone);
      setupDrawingInputs(clone);
      updateLabels();
      scheduleSave();
    });
  }

  function pickField(selectEl, customEl){
    const selectVal = selectEl && selectEl.value ? selectEl.value : "";
    if(selectVal) return { value: selectVal, draw: "" };
    const draw = customEl && customEl.dataset.drawing ? customEl.dataset.drawing : "";
    if(draw) return { value: "", draw };
    return { value: "", draw: "" };
  }

  function collectData(){
    const rooms = [];
    const surfaceHeating = document.querySelector('input[name="surfaceHeating"]:checked');
    const surfaceDetails = document.getElementById("surfaceHeatingDetails");
    const detailsOpen = surfaceDetails && !surfaceDetails.classList.contains("hidden");
    const addressNameDraw = (document.getElementById("addressNameDraw") || {}).dataset ? (document.getElementById("addressNameDraw").dataset.drawing || "") : "";
    const addressStreetDraw = (document.getElementById("addressStreetDraw") || {}).dataset ? (document.getElementById("addressStreetDraw").dataset.drawing || "") : "";
    const addressCityDraw = (document.getElementById("addressCityDraw") || {}).dataset ? (document.getElementById("addressCityDraw").dataset.drawing || "") : "";
    const addressPhoneDraw = (document.getElementById("addressPhoneDraw") || {}).dataset ? (document.getElementById("addressPhoneDraw").dataset.drawing || "") : "";
    const addressEmailDraw = (document.getElementById("addressEmailDraw") || {}).dataset ? (document.getElementById("addressEmailDraw").dataset.drawing || "") : "";
    const buildingData = (document.querySelector('input[name="buildingData"]:checked') || {}).value || "";
    const buildingStreetDraw = (document.getElementById("buildingStreetDraw") || {}).dataset ? (document.getElementById("buildingStreetDraw").dataset.drawing || "") : "";
    const buildingCityDraw = (document.getElementById("buildingCityDraw") || {}).dataset ? (document.getElementById("buildingCityDraw").dataset.drawing || "") : "";
    const buildingYearDraw = (document.getElementById("buildingYearDraw") || {}).dataset ? (document.getElementById("buildingYearDraw").dataset.drawing || "") : "";
    const buildingUnits = (document.getElementById("buildingUnits") || {}).value || "";
    const buildingTypeDetached = !!document.querySelector('input[name="buildingTypeDetached"]:checked');
    const buildingTypeMultiFamily = !!document.querySelector('input[name="buildingTypeMultiFamily"]:checked');
    const buildingTypeEndTerrace = !!document.querySelector('input[name="buildingTypeEndTerrace"]:checked');
    const buildingTypeMidTerrace = !!document.querySelector('input[name="buildingTypeMidTerrace"]:checked');
    const floorHeightBasementDraw = (document.getElementById("floorHeightBasementDraw") || {}).dataset ? (document.getElementById("floorHeightBasementDraw").dataset.drawing || "") : "";
    const floorHeightGroundDraw = (document.getElementById("floorHeightGroundDraw") || {}).dataset ? (document.getElementById("floorHeightGroundDraw").dataset.drawing || "") : "";
    const floorHeight1OgDraw = (document.getElementById("floorHeight1OgDraw") || {}).dataset ? (document.getElementById("floorHeight1OgDraw").dataset.drawing || "") : "";
    const floorHeight2OgDraw = (document.getElementById("floorHeight2OgDraw") || {}).dataset ? (document.getElementById("floorHeight2OgDraw").dataset.drawing || "") : "";
    const floorHeight3OgDraw = (document.getElementById("floorHeight3OgDraw") || {}).dataset ? (document.getElementById("floorHeight3OgDraw").dataset.drawing || "") : "";
    const floorHeightDgDraw = (document.getElementById("floorHeightDgDraw") || {}).dataset ? (document.getElementById("floorHeightDgDraw").dataset.drawing || "") : "";
    const structureMassive = !!document.querySelector('input[name="structureMassive"]:checked');
    const structureWooden = !!document.querySelector('input[name="structureWooden"]:checked');
    const basementHeated = (document.querySelector('input[name="basementHeated"]:checked') || {}).value || "";
    const notesDraw = (document.getElementById("notesDraw") || {}).dataset ? (document.getElementById("notesDraw").dataset.drawing || "") : "";
    const wallNorthL1Draw = (document.getElementById("wallNorthL1Draw") || {}).dataset ? (document.getElementById("wallNorthL1Draw").dataset.drawing || "") : "";
    const wallNorthL2Draw = (document.getElementById("wallNorthL2Draw") || {}).dataset ? (document.getElementById("wallNorthL2Draw").dataset.drawing || "") : "";
    const wallNorthL3Draw = (document.getElementById("wallNorthL3Draw") || {}).dataset ? (document.getElementById("wallNorthL3Draw").dataset.drawing || "") : "";
    const wallNorthL4Draw = (document.getElementById("wallNorthL4Draw") || {}).dataset ? (document.getElementById("wallNorthL4Draw").dataset.drawing || "") : "";
    const wallNorthL5Draw = (document.getElementById("wallNorthL5Draw") || {}).dataset ? (document.getElementById("wallNorthL5Draw").dataset.drawing || "") : "";
    const wallNorthTotalDraw = (document.getElementById("wallNorthTotalDraw") || {}).dataset ? (document.getElementById("wallNorthTotalDraw").dataset.drawing || "") : "";
    const wallEastL1Draw = (document.getElementById("wallEastL1Draw") || {}).dataset ? (document.getElementById("wallEastL1Draw").dataset.drawing || "") : "";
    const wallEastL2Draw = (document.getElementById("wallEastL2Draw") || {}).dataset ? (document.getElementById("wallEastL2Draw").dataset.drawing || "") : "";
    const wallEastL3Draw = (document.getElementById("wallEastL3Draw") || {}).dataset ? (document.getElementById("wallEastL3Draw").dataset.drawing || "") : "";
    const wallEastL4Draw = (document.getElementById("wallEastL4Draw") || {}).dataset ? (document.getElementById("wallEastL4Draw").dataset.drawing || "") : "";
    const wallEastL5Draw = (document.getElementById("wallEastL5Draw") || {}).dataset ? (document.getElementById("wallEastL5Draw").dataset.drawing || "") : "";
    const wallEastTotalDraw = (document.getElementById("wallEastTotalDraw") || {}).dataset ? (document.getElementById("wallEastTotalDraw").dataset.drawing || "") : "";
    const wallSouthL1Draw = (document.getElementById("wallSouthL1Draw") || {}).dataset ? (document.getElementById("wallSouthL1Draw").dataset.drawing || "") : "";
    const wallSouthL2Draw = (document.getElementById("wallSouthL2Draw") || {}).dataset ? (document.getElementById("wallSouthL2Draw").dataset.drawing || "") : "";
    const wallSouthL3Draw = (document.getElementById("wallSouthL3Draw") || {}).dataset ? (document.getElementById("wallSouthL3Draw").dataset.drawing || "") : "";
    const wallSouthL4Draw = (document.getElementById("wallSouthL4Draw") || {}).dataset ? (document.getElementById("wallSouthL4Draw").dataset.drawing || "") : "";
    const wallSouthL5Draw = (document.getElementById("wallSouthL5Draw") || {}).dataset ? (document.getElementById("wallSouthL5Draw").dataset.drawing || "") : "";
    const wallSouthTotalDraw = (document.getElementById("wallSouthTotalDraw") || {}).dataset ? (document.getElementById("wallSouthTotalDraw").dataset.drawing || "") : "";
    const wallWestL1Draw = (document.getElementById("wallWestL1Draw") || {}).dataset ? (document.getElementById("wallWestL1Draw").dataset.drawing || "") : "";
    const wallWestL2Draw = (document.getElementById("wallWestL2Draw") || {}).dataset ? (document.getElementById("wallWestL2Draw").dataset.drawing || "") : "";
    const wallWestL3Draw = (document.getElementById("wallWestL3Draw") || {}).dataset ? (document.getElementById("wallWestL3Draw").dataset.drawing || "") : "";
    const wallWestL4Draw = (document.getElementById("wallWestL4Draw") || {}).dataset ? (document.getElementById("wallWestL4Draw").dataset.drawing || "") : "";
    const wallWestL5Draw = (document.getElementById("wallWestL5Draw") || {}).dataset ? (document.getElementById("wallWestL5Draw").dataset.drawing || "") : "";
    const wallWestTotalDraw = (document.getElementById("wallWestTotalDraw") || {}).dataset ? (document.getElementById("wallWestTotalDraw").dataset.drawing || "") : "";
    const systemManufacturer = (document.getElementById("systemManufacturer") || {}).value || "";
    const systemManufacturerDraw = (document.getElementById("systemManufacturerDraw") || {}).dataset ? (document.getElementById("systemManufacturerDraw").dataset.drawing || "") : "";
    const systemTypeDraw = (document.getElementById("systemTypeDraw") || {}).dataset ? (document.getElementById("systemTypeDraw").dataset.drawing || "") : "";
    const systemPowerDraw = (document.getElementById("systemPowerDraw") || {}).dataset ? (document.getElementById("systemPowerDraw").dataset.drawing || "") : "";
    const systemYear = (document.getElementById("systemYear") || {}).value || "";
    const systemFuel = (document.getElementById("systemFuel") || {}).value || "";
    const systemLocation = (document.getElementById("systemLocation") || {}).value || "";
    const heatDistribution = (document.getElementById("heatDistribution") || {}).value || "";
    const pipeInsulation = (document.getElementById("pipeInsulation") || {}).value || "";
    const pumpCirculationDraw = (document.getElementById("pumpCirculationDraw") || {}).dataset ? (document.getElementById("pumpCirculationDraw").dataset.drawing || "") : "";
    const pumpCirculationHe = !!document.querySelector('input[name="pumpCirculationHe"]:checked');
    const pumpCirculationStf = (document.getElementById("pumpCirculationStf") || {}).value || "";
    const pumpStorageDraw = (document.getElementById("pumpStorageDraw") || {}).dataset ? (document.getElementById("pumpStorageDraw").dataset.drawing || "") : "";
    const pumpStorageHe = !!document.querySelector('input[name="pumpStorageHe"]:checked');
    const pumpStorageStf = (document.getElementById("pumpStorageStf") || {}).value || "";
    const pumpRecircDraw = (document.getElementById("pumpRecircDraw") || {}).dataset ? (document.getElementById("pumpRecircDraw").dataset.drawing || "") : "";
    const pumpRecircHe = !!document.querySelector('input[name="pumpRecircHe"]:checked');
    const pumpRecircStf = (document.getElementById("pumpRecircStf") || {}).value || "";
    const optionNightReduction = !!document.querySelector('input[name="optionNightReduction"]:checked');
    const optionHydraulicBalance = !!document.querySelector('input[name="optionHydraulicBalance"]:checked');
    const optionHeaterNiches = !!document.querySelector('input[name="optionHeaterNiches"]:checked');
    const optionCirculationTimed = !!document.querySelector('input[name="optionCirculationTimed"]:checked');
    const systemThermostatValves = (document.getElementById("systemThermostatValves") || {}).value || "";
    const system = {
      addressNameDraw,
      addressStreetDraw,
      addressCityDraw,
      addressPhoneDraw,
      addressEmailDraw,
      buildingData,
      buildingStreetDraw,
      buildingCityDraw,
      buildingYearDraw,
      buildingUnits,
      buildingTypeDetached,
      buildingTypeMultiFamily,
      buildingTypeEndTerrace,
      buildingTypeMidTerrace,
      floorHeightBasementDraw,
      floorHeightGroundDraw,
      floorHeight1OgDraw,
      floorHeight2OgDraw,
      floorHeight3OgDraw,
      floorHeightDgDraw,
      structureMassive,
      structureWooden,
      basementHeated,
      notesDraw,
      wallNorthL1Draw,
      wallNorthL2Draw,
      wallNorthL3Draw,
      wallNorthL4Draw,
      wallNorthL5Draw,
      wallNorthTotalDraw,
      wallEastL1Draw,
      wallEastL2Draw,
      wallEastL3Draw,
      wallEastL4Draw,
      wallEastL5Draw,
      wallEastTotalDraw,
      wallSouthL1Draw,
      wallSouthL2Draw,
      wallSouthL3Draw,
      wallSouthL4Draw,
      wallSouthL5Draw,
      wallSouthTotalDraw,
      wallWestL1Draw,
      wallWestL2Draw,
      wallWestL3Draw,
      wallWestL4Draw,
      wallWestL5Draw,
      wallWestTotalDraw,
      surfaceHeating: surfaceHeating ? surfaceHeating.value : (detailsOpen ? "Ja" : ""),
      distributorPhoto: !!document.querySelector('input[name="surfaceHeatingDistributorPhoto"]:checked'),
      distributorDn: (document.getElementById("distributorDn") || {}).value || "",
      layingSpacing: (document.getElementById("layingSpacing") || {}).value || ""
      ,
      fbhLineDiameter: (document.getElementById("fBHLineDiameter") || {}).value || "",
      heatingCircuits: (document.getElementById("heatingCircuits") || {}).value || "",
      systemManufacturer,
      systemManufacturerDraw,
      systemTypeDraw,
      systemPowerDraw,
      systemYear,
      systemFuel,
      systemLocation,
      heatDistribution,
      pipeInsulation,
      optionNightReduction,
      optionHydraulicBalance,
      optionHeaterNiches,
      optionCirculationTimed,
      systemThermostatValves,
      pumpCirculationDraw,
      pumpCirculationHe,
      pumpCirculationStf,
      pumpStorageDraw,
      pumpStorageHe,
      pumpStorageStf,
      pumpRecircDraw,
      pumpRecircHe,
      pumpRecircStf
    };
    document.querySelectorAll(".room-card").forEach((card, idx) => {
      const roomSel = card.querySelector('select[name$="Name"]');
      const floorSel = card.querySelector('select[name$="Floor"]');
      const roomName = roomSel ? roomSel.value.trim() : "";
      const floor = floorSel ? floorSel.value.trim() : "";
      const heaters = [];
      card.querySelectorAll(".hk-card").forEach(hk => {
        const formChecked = hk.querySelector('input[type="radio"][name*="HkForm"]:checked');
        const formText = formChecked && formChecked.parentElement ? formChecked.parentElement.textContent : "";
        const bauform = /Rippen/i.test(formText) ? "Rippen" : (/Platte/i.test(formText) ? "Platte" : "");
        const typeSel = hk.querySelector('select[name*="HkType"]');
        const typeCustom = hk.querySelector('input[name*="HkType"]');
        const heightSel = hk.querySelector('select[name*="HkHeight"]');
        const heightCustom = hk.querySelector('input[name*="HkHeight"]');
        const widthSel = hk.querySelector('select[name*="HkWidth"]');
        const widthCustom = hk.querySelector('input[name*="HkWidth"]');
        const dnSel = hk.querySelector('select[name*="HkDn"]');
        const dnCustom = hk.querySelector('input[name*="HkDn"]');
        const typeField = pickField(typeSel, typeCustom);
        const heightField = pickField(heightSel, heightCustom);
        const widthField = pickField(widthSel, widthCustom);
        const dnField = pickField(dnSel, dnCustom);
        const entry = {
          bauform,
          type: typeField.value,
          typeDraw: typeField.draw,
          height: heightField.value,
          heightDraw: heightField.draw,
          width: widthField.value,
          widthDraw: widthField.draw,
          dn: dnField.value,
          dnDraw: dnField.draw
        };
        const hasData = !!(entry.type || entry.typeDraw || entry.height || entry.heightDraw || entry.width || entry.widthDraw || entry.dn || entry.dnDraw);
        if(hasData) heaters.push(entry);
      });
      if(roomName || floor || heaters.length){
        rooms.push({ index: idx + 1, roomName, floor, heaters });
      }
    });
    return { system, rooms, detailsOpen };
  }

  function renderCell(value, draw){
    if(draw) return '<img class="draw-img" src="' + draw + '" alt="Zeichnung">';
    return value || "";
  }

  function renderPrint(data, skipPrint){
    const now = new Date().toLocaleString();
    const container = document.getElementById("printView");
    if(!container) return;
    const surfaceHeating = document.querySelector('input[name="surfaceHeating"]:checked');
    const surfaceDetails = document.getElementById("surfaceHeatingDetails");
    const detailsOpen = surfaceDetails && !surfaceDetails.classList.contains("hidden");
    const distributorPhotoChecked = !!document.querySelector('input[name="surfaceHeatingDistributorPhoto"]:checked');
    const distributorDnInput = document.getElementById("distributorDn");
    const distributorDnValue = (distributorDnInput && distributorDnInput.value ? distributorDnInput.value : "").trim();
    const distributorDnDraw = distributorDnInput && distributorDnInput.dataset.drawing ? distributorDnInput.dataset.drawing : "";
    const layingSpacingValue = ((document.getElementById("layingSpacing") || {}).value || "").trim();
    const addressNameDraw = (document.getElementById("addressNameDraw") || {}).dataset ? (document.getElementById("addressNameDraw").dataset.drawing || "") : "";
    const addressStreetDraw = (document.getElementById("addressStreetDraw") || {}).dataset ? (document.getElementById("addressStreetDraw").dataset.drawing || "") : "";
    const addressCityDraw = (document.getElementById("addressCityDraw") || {}).dataset ? (document.getElementById("addressCityDraw").dataset.drawing || "") : "";
    const addressPhoneDraw = (document.getElementById("addressPhoneDraw") || {}).dataset ? (document.getElementById("addressPhoneDraw").dataset.drawing || "") : "";
    const addressEmailDraw = (document.getElementById("addressEmailDraw") || {}).dataset ? (document.getElementById("addressEmailDraw").dataset.drawing || "") : "";
    const buildingData = ((document.querySelector('input[name="buildingData"]:checked') || {}).value || "").trim();
    const buildingStreetDraw = (document.getElementById("buildingStreetDraw") || {}).dataset ? (document.getElementById("buildingStreetDraw").dataset.drawing || "") : "";
    const buildingCityDraw = (document.getElementById("buildingCityDraw") || {}).dataset ? (document.getElementById("buildingCityDraw").dataset.drawing || "") : "";
    const buildingYearDraw = (document.getElementById("buildingYearDraw") || {}).dataset ? (document.getElementById("buildingYearDraw").dataset.drawing || "") : "";
    const buildingUnits = ((document.getElementById("buildingUnits") || {}).value || "").trim();
    const buildingTypeDetached = !!document.querySelector('input[name="buildingTypeDetached"]:checked');
    const buildingTypeMultiFamily = !!document.querySelector('input[name="buildingTypeMultiFamily"]:checked');
    const buildingTypeEndTerrace = !!document.querySelector('input[name="buildingTypeEndTerrace"]:checked');
    const buildingTypeMidTerrace = !!document.querySelector('input[name="buildingTypeMidTerrace"]:checked');
    const floorHeightBasementDraw = (document.getElementById("floorHeightBasementDraw") || {}).dataset ? (document.getElementById("floorHeightBasementDraw").dataset.drawing || "") : "";
    const floorHeightGroundDraw = (document.getElementById("floorHeightGroundDraw") || {}).dataset ? (document.getElementById("floorHeightGroundDraw").dataset.drawing || "") : "";
    const floorHeight1OgDraw = (document.getElementById("floorHeight1OgDraw") || {}).dataset ? (document.getElementById("floorHeight1OgDraw").dataset.drawing || "") : "";
    const floorHeight2OgDraw = (document.getElementById("floorHeight2OgDraw") || {}).dataset ? (document.getElementById("floorHeight2OgDraw").dataset.drawing || "") : "";
    const floorHeight3OgDraw = (document.getElementById("floorHeight3OgDraw") || {}).dataset ? (document.getElementById("floorHeight3OgDraw").dataset.drawing || "") : "";
    const floorHeightDgDraw = (document.getElementById("floorHeightDgDraw") || {}).dataset ? (document.getElementById("floorHeightDgDraw").dataset.drawing || "") : "";
    const structureMassive = !!document.querySelector('input[name="structureMassive"]:checked');
    const structureWooden = !!document.querySelector('input[name="structureWooden"]:checked');
    const basementHeated = ((document.querySelector('input[name="basementHeated"]:checked') || {}).value || "").trim();
    const notesDraw = (document.getElementById("notesDraw") || {}).dataset ? (document.getElementById("notesDraw").dataset.drawing || "") : "";
    const wallNorthL1Draw = (document.getElementById("wallNorthL1Draw") || {}).dataset ? (document.getElementById("wallNorthL1Draw").dataset.drawing || "") : "";
    const wallNorthL2Draw = (document.getElementById("wallNorthL2Draw") || {}).dataset ? (document.getElementById("wallNorthL2Draw").dataset.drawing || "") : "";
    const wallNorthL3Draw = (document.getElementById("wallNorthL3Draw") || {}).dataset ? (document.getElementById("wallNorthL3Draw").dataset.drawing || "") : "";
    const wallNorthL4Draw = (document.getElementById("wallNorthL4Draw") || {}).dataset ? (document.getElementById("wallNorthL4Draw").dataset.drawing || "") : "";
    const wallNorthL5Draw = (document.getElementById("wallNorthL5Draw") || {}).dataset ? (document.getElementById("wallNorthL5Draw").dataset.drawing || "") : "";
    const wallNorthTotalDraw = (document.getElementById("wallNorthTotalDraw") || {}).dataset ? (document.getElementById("wallNorthTotalDraw").dataset.drawing || "") : "";
    const wallEastL1Draw = (document.getElementById("wallEastL1Draw") || {}).dataset ? (document.getElementById("wallEastL1Draw").dataset.drawing || "") : "";
    const wallEastL2Draw = (document.getElementById("wallEastL2Draw") || {}).dataset ? (document.getElementById("wallEastL2Draw").dataset.drawing || "") : "";
    const wallEastL3Draw = (document.getElementById("wallEastL3Draw") || {}).dataset ? (document.getElementById("wallEastL3Draw").dataset.drawing || "") : "";
    const wallEastL4Draw = (document.getElementById("wallEastL4Draw") || {}).dataset ? (document.getElementById("wallEastL4Draw").dataset.drawing || "") : "";
    const wallEastL5Draw = (document.getElementById("wallEastL5Draw") || {}).dataset ? (document.getElementById("wallEastL5Draw").dataset.drawing || "") : "";
    const wallEastTotalDraw = (document.getElementById("wallEastTotalDraw") || {}).dataset ? (document.getElementById("wallEastTotalDraw").dataset.drawing || "") : "";
    const wallSouthL1Draw = (document.getElementById("wallSouthL1Draw") || {}).dataset ? (document.getElementById("wallSouthL1Draw").dataset.drawing || "") : "";
    const wallSouthL2Draw = (document.getElementById("wallSouthL2Draw") || {}).dataset ? (document.getElementById("wallSouthL2Draw").dataset.drawing || "") : "";
    const wallSouthL3Draw = (document.getElementById("wallSouthL3Draw") || {}).dataset ? (document.getElementById("wallSouthL3Draw").dataset.drawing || "") : "";
    const wallSouthL4Draw = (document.getElementById("wallSouthL4Draw") || {}).dataset ? (document.getElementById("wallSouthL4Draw").dataset.drawing || "") : "";
    const wallSouthL5Draw = (document.getElementById("wallSouthL5Draw") || {}).dataset ? (document.getElementById("wallSouthL5Draw").dataset.drawing || "") : "";
    const wallSouthTotalDraw = (document.getElementById("wallSouthTotalDraw") || {}).dataset ? (document.getElementById("wallSouthTotalDraw").dataset.drawing || "") : "";
    const wallWestL1Draw = (document.getElementById("wallWestL1Draw") || {}).dataset ? (document.getElementById("wallWestL1Draw").dataset.drawing || "") : "";
    const wallWestL2Draw = (document.getElementById("wallWestL2Draw") || {}).dataset ? (document.getElementById("wallWestL2Draw").dataset.drawing || "") : "";
    const wallWestL3Draw = (document.getElementById("wallWestL3Draw") || {}).dataset ? (document.getElementById("wallWestL3Draw").dataset.drawing || "") : "";
    const wallWestL4Draw = (document.getElementById("wallWestL4Draw") || {}).dataset ? (document.getElementById("wallWestL4Draw").dataset.drawing || "") : "";
    const wallWestL5Draw = (document.getElementById("wallWestL5Draw") || {}).dataset ? (document.getElementById("wallWestL5Draw").dataset.drawing || "") : "";
    const wallWestTotalDraw = (document.getElementById("wallWestTotalDraw") || {}).dataset ? (document.getElementById("wallWestTotalDraw").dataset.drawing || "") : "";
    const systemManufacturer = ((document.getElementById("systemManufacturer") || {}).value || "").trim();
    const systemManufacturerDraw = (document.getElementById("systemManufacturerDraw") || {}).dataset ? (document.getElementById("systemManufacturerDraw").dataset.drawing || "") : "";
    const systemTypeDraw = (document.getElementById("systemTypeDraw") || {}).dataset ? (document.getElementById("systemTypeDraw").dataset.drawing || "") : "";
    const systemPowerDraw = (document.getElementById("systemPowerDraw") || {}).dataset ? (document.getElementById("systemPowerDraw").dataset.drawing || "") : "";
    const systemYear = ((document.getElementById("systemYear") || {}).value || "").trim();
    const systemFuel = ((document.getElementById("systemFuel") || {}).value || "").trim();
    const systemLocation = ((document.getElementById("systemLocation") || {}).value || "").trim();
    const heatDistribution = ((document.getElementById("heatDistribution") || {}).value || "").trim();
    const pipeInsulation = ((document.getElementById("pipeInsulation") || {}).value || "").trim();
    const systemThermostatValves = ((document.getElementById("systemThermostatValves") || {}).value || "").trim();
    const system = {
      addressNameDraw,
      addressStreetDraw,
      addressCityDraw,
      addressPhoneDraw,
      addressEmailDraw,
      buildingData,
      buildingStreetDraw,
      buildingCityDraw,
      buildingYearDraw,
      buildingUnits,
      buildingTypeDetached,
      buildingTypeMultiFamily,
      buildingTypeEndTerrace,
      buildingTypeMidTerrace,
      floorHeightBasementDraw,
      floorHeightGroundDraw,
      floorHeight1OgDraw,
      floorHeight2OgDraw,
      floorHeight3OgDraw,
      floorHeightDgDraw,
      structureMassive,
      structureWooden,
      basementHeated,
      notesDraw,
      wallNorthL1Draw,
      wallNorthL2Draw,
      wallNorthL3Draw,
      wallNorthL4Draw,
      wallNorthL5Draw,
      wallNorthTotalDraw,
      wallEastL1Draw,
      wallEastL2Draw,
      wallEastL3Draw,
      wallEastL4Draw,
      wallEastL5Draw,
      wallEastTotalDraw,
      wallSouthL1Draw,
      wallSouthL2Draw,
      wallSouthL3Draw,
      wallSouthL4Draw,
      wallSouthL5Draw,
      wallSouthTotalDraw,
      wallWestL1Draw,
      wallWestL2Draw,
      wallWestL3Draw,
      wallWestL4Draw,
      wallWestL5Draw,
      wallWestTotalDraw,
      systemManufacturer,
      systemManufacturerDraw,
      systemTypeDraw,
      systemPowerDraw,
      systemYear,
      systemFuel,
      systemLocation,
      heatDistribution,
      pipeInsulation,
      optionNightReduction: !!document.querySelector('input[name="optionNightReduction"]:checked'),
      optionHydraulicBalance: !!document.querySelector('input[name="optionHydraulicBalance"]:checked'),
      optionHeaterNiches: !!document.querySelector('input[name="optionHeaterNiches"]:checked'),
      optionCirculationTimed: !!document.querySelector('input[name="optionCirculationTimed"]:checked'),
      systemThermostatValves,
      pumpCirculationDraw: (document.getElementById("pumpCirculationDraw") || {}).dataset ? (document.getElementById("pumpCirculationDraw").dataset.drawing || "") : "",
      pumpCirculationHe: !!document.querySelector('input[name="pumpCirculationHe"]:checked'),
      pumpCirculationStf: ((document.getElementById("pumpCirculationStf") || {}).value || "").trim(),
      pumpStorageDraw: (document.getElementById("pumpStorageDraw") || {}).dataset ? (document.getElementById("pumpStorageDraw").dataset.drawing || "") : "",
      pumpStorageHe: !!document.querySelector('input[name="pumpStorageHe"]:checked'),
      pumpStorageStf: ((document.getElementById("pumpStorageStf") || {}).value || "").trim(),
      pumpRecircDraw: (document.getElementById("pumpRecircDraw") || {}).dataset ? (document.getElementById("pumpRecircDraw").dataset.drawing || "") : "",
      pumpRecircHe: !!document.querySelector('input[name="pumpRecircHe"]:checked'),
      pumpRecircStf: ((document.getElementById("pumpRecircStf") || {}).value || "").trim(),
      heatingCircuits: ((document.getElementById("heatingCircuits") || {}).value || "").trim(),
      surfaceHeating: surfaceHeating ? surfaceHeating.value : (detailsOpen ? "Ja" : ""),
      distributorPhoto: distributorPhotoChecked,
      distributorDn: distributorDnValue,
      distributorDnDraw: distributorDnDraw,
      layingSpacing: layingSpacingValue,
      fbhLineDiameter: ((document.getElementById("fBHLineDiameter") || {}).value || "").trim()
    };
    const hasSystem = !!(
      system.systemManufacturer || system.systemManufacturerDraw || system.systemType || system.systemTypeDraw ||
      system.systemPowerDraw || system.systemYear || system.systemFuel || system.systemLocation || system.heatDistribution || system.pipeInsulation ||
      system.pumpCirculationDraw || system.pumpCirculationHe || system.pumpCirculationStf ||
      system.pumpStorageDraw || system.pumpStorageHe || system.pumpStorageStf ||
      system.pumpRecircDraw || system.pumpRecircHe || system.pumpRecircStf ||
      system.optionNightReduction || system.optionHydraulicBalance || system.optionHeaterNiches || system.optionCirculationTimed ||
      system.systemThermostatValves || system.heatingCircuits ||
      system.surfaceHeating || system.distributorPhoto || system.distributorDn || system.distributorDnDraw ||
      system.layingSpacing || system.fbhLineDiameter || detailsOpen
    );
    const sections = [];
    const hasAddress = !!(
      system.addressNameDraw || system.addressStreetDraw ||
      system.addressCityDraw || system.addressPhoneDraw || system.addressEmailDraw ||
      system.buildingData || system.buildingStreetDraw || system.buildingCityDraw ||
      system.buildingYearDraw || system.buildingUnits ||
      system.buildingTypeDetached || system.buildingTypeMultiFamily ||
      system.buildingTypeEndTerrace || system.buildingTypeMidTerrace
    );
    if(hasAddress){
      const rows = [];
      const addRowDraw = (label, draw) => {
        if(draw){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell("", draw) + '</td></tr>');
        }
      };
      const addRowValue = (label, value) => {
        if(value){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell(value, "") + '</td></tr>');
        }
      };
      const addFlag = (label, flag) => {
        if(flag) rows.push('<tr><td>' + label + '</td><td>Ja</td></tr>');
      };
      addRowDraw("Name", system.addressNameDraw);
      addRowDraw("Stra\u00dfe, Nr.", system.addressStreetDraw);
      addRowDraw("PLZ/Ort", system.addressCityDraw);
      addRowDraw("Telefon", system.addressPhoneDraw);
      addRowDraw("Email", system.addressEmailDraw);
      addRowValue("Geb\u00e4udedaten wie oben", system.buildingData);
      addRowDraw("Geb\u00e4ude Stra\u00dfe, Nr.", system.buildingStreetDraw);
      addRowDraw("Geb\u00e4ude PLZ/Ort", system.buildingCityDraw);
      addRowDraw("Geb\u00e4ude Baujahr", system.buildingYearDraw);
      addRowValue("Wohneinheiten", system.buildingUnits);
      addFlag("Geb\u00e4udetyp freistehend", system.buildingTypeDetached);
      addFlag("Geb\u00e4udetyp Mehrfamilienhaus", system.buildingTypeMultiFamily);
      addFlag("Geb\u00e4udetyp Reihenendhaus", system.buildingTypeEndTerrace);
      addFlag("Geb\u00e4udetyp Reihenmittelhaus", system.buildingTypeMidTerrace);
      if(rows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Anschrift</div><div class="room-sub">Stammdaten</div></div>',
          '<div class="badge">Adresse</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          rows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
    }
    const hasStructure = !!(
      system.floorHeightBasementDraw || system.floorHeightGroundDraw ||
      system.floorHeight1OgDraw || system.floorHeight2OgDraw ||
      system.floorHeight3OgDraw || system.floorHeightDgDraw ||
      system.structureMassive || system.structureWooden || system.basementHeated
    );
    if(hasStructure){
      const rows = [];
      const addRowDraw = (label, draw) => {
        if(draw){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell("", draw) + '</td></tr>');
        }
      };
      const addRowValue = (label, value) => {
        if(value){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell(value, "") + '</td></tr>');
        }
      };
      const addFlag = (label, flag) => {
        if(flag) rows.push('<tr><td>' + label + '</td><td>Ja</td></tr>');
      };
      addRowDraw("Keller", system.floorHeightBasementDraw);
      addRowDraw("Erdgeschoss", system.floorHeightGroundDraw);
      addRowDraw("1.OG", system.floorHeight1OgDraw);
      addRowDraw("2.OG", system.floorHeight2OgDraw);
      addRowDraw("3.OG", system.floorHeight3OgDraw);
      addRowDraw("DG", system.floorHeightDgDraw);
      addFlag("Massiv", system.structureMassive);
      addFlag("Holzbalken", system.structureWooden);
      addRowValue("Keller beheizt", system.basementHeated);
      if(rows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Geschossh&ouml;he, Kellerdecke/Bodenplatte, Au&szlig;enw&auml;nde</div><div class="room-sub">Art/Aufbau/Material</div></div>',
          '<div class="badge">Geb&auml;ude</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          rows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
    }
    const hasNotes = !!system.notesDraw;
    if(hasNotes){
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Notizen</div><div class="room-sub">Freitext</div></div>',
        '<div class="badge">Notiz</div>',
        '</div>',
        '<table class="hk-table">',
        '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
        '<tbody>',
        '<tr><td>Notizen</td><td>' + renderCell("", system.notesDraw) + '</td></tr>',
        '</tbody></table></section>'
      ].join(""));
    }
    const hasWalls = !!(
      system.wallNorthL1Draw || system.wallNorthL2Draw || system.wallNorthL3Draw ||
      system.wallNorthL4Draw || system.wallNorthL5Draw || system.wallNorthTotalDraw ||
      system.wallEastL1Draw || system.wallEastL2Draw || system.wallEastL3Draw ||
      system.wallEastL4Draw || system.wallEastL5Draw || system.wallEastTotalDraw ||
      system.wallSouthL1Draw || system.wallSouthL2Draw || system.wallSouthL3Draw ||
      system.wallSouthL4Draw || system.wallSouthL5Draw || system.wallSouthTotalDraw ||
      system.wallWestL1Draw || system.wallWestL2Draw || system.wallWestL3Draw ||
      system.wallWestL4Draw || system.wallWestL5Draw || system.wallWestTotalDraw
    );
    if(hasWalls){
      const buildRow = (label, values) => (
        '<tr>' +
        '<td>' + label + '</td>' +
        values.map(draw => '<td>' + renderCell("", draw) + '</td>').join("") +
        '</tr>'
      );
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">Au\u00dfenw\u00e4nde</div><div class="room-sub">Aufbau / Himmelsrichtungen</div></div>',
        '<div class="badge">Wand</div>',
        '</div>',
        '<table class="hk-table">',
        '<thead><tr><th>Aufbau</th><th>Schicht 1</th><th>Schicht 2</th><th>Schicht 3</th><th>Schicht 4</th><th>Schicht 5</th><th>Gesamtdicke</th></tr></thead>',
        '<tbody>',
        buildRow("Nord", [
          system.wallNorthL1Draw,
          system.wallNorthL2Draw,
          system.wallNorthL3Draw,
          system.wallNorthL4Draw,
          system.wallNorthL5Draw,
          system.wallNorthTotalDraw
        ]),
        buildRow("Ost", [
          system.wallEastL1Draw,
          system.wallEastL2Draw,
          system.wallEastL3Draw,
          system.wallEastL4Draw,
          system.wallEastL5Draw,
          system.wallEastTotalDraw
        ]),
        buildRow("S\u00fcd", [
          system.wallSouthL1Draw,
          system.wallSouthL2Draw,
          system.wallSouthL3Draw,
          system.wallSouthL4Draw,
          system.wallSouthL5Draw,
          system.wallSouthTotalDraw
        ]),
        buildRow("West", [
          system.wallWestL1Draw,
          system.wallWestL2Draw,
          system.wallWestL3Draw,
          system.wallWestL4Draw,
          system.wallWestL5Draw,
          system.wallWestTotalDraw
        ]),
        '</tbody></table></section>'
      ].join(""));
    }
    if(hasSystem){
      const rows = [];
      const addRow = (label, value, draw) => {
        if((value && value !== "-") || draw){
          rows.push('<tr><td>' + label + '</td><td>' + renderCell(value || "", draw || "") + '</td></tr>');
        }
      };
      const addFlag = (label, flag) => {
        if(flag) rows.push('<tr><td>' + label + '</td><td>Ja</td></tr>');
      };
      addRow("Hersteller", system.systemManufacturer, system.systemManufacturerDraw);
      addRow("Typ", "", system.systemTypeDraw);
      addRow("Leistung", "", system.systemPowerDraw);
      addRow("Baujahr", system.systemYear, "");
      addRow("Brennstoff", system.systemFuel, "");
      addRow("Aufstellort der Heizung", system.systemLocation, "");
      addRow("W\u00e4rmeverteilung", system.heatDistribution, "");
      addRow("D\u00e4mmung der Rohrleitung", system.pipeInsulation, "");
      addFlag("Nachtabsenkung", system.optionNightReduction);
      addFlag("Hydr. Abgleich", system.optionHydraulicBalance);
      addFlag("Heizk\u00f6rpernieschen", system.optionHeaterNiches);
      addFlag("Zirku. Zeitgesteuert", system.optionCirculationTimed);
      addRow("Thermostatventile", system.systemThermostatValves, "");
      addRow("Anzahl Heizkreise", system.heatingCircuits, "");
      addRow("Fl\u00e4chenheizung vorhanden", system.surfaceHeating, "");
      addFlag("Foto vom Verteiler", system.distributorPhoto);
      addRow("Verteiler DN", system.distributorDn, system.distributorDnDraw);
      addRow("Verlegeabstand", system.layingSpacing, "");
      addRow("Durchmesser Leitung FBH", system.fbhLineDiameter, "");
      addRow("Umw\u00e4lzpumpe", "", system.pumpCirculationDraw);
      addFlag("Umw\u00e4lzpumpe HE?", system.pumpCirculationHe);
      addRow("Umw\u00e4lzpumpe Stf", system.pumpCirculationStf, "");
      addRow("Speicherladepumpe", "", system.pumpStorageDraw);
      addFlag("Speicherladepumpe HE?", system.pumpStorageHe);
      addRow("Speicherladepumpe Stf", system.pumpStorageStf, "");
      addRow("Zirkulationspumpe", "", system.pumpRecircDraw);
      addFlag("Zirkulationspumpe HE?", system.pumpRecircHe);
      addRow("Zirkulationspumpe Stf", system.pumpRecircStf, "");
      if(rows.length){
        sections.push([
          '<section class="room">',
          '<div class="room-head">',
          '<div><div class="room-title">Anlagentechnik</div><div class="room-sub">Hersteller: ' + (system.systemManufacturer || "-") + '</div></div>',
          '<div class="badge">System</div>',
          '</div>',
          '<table class="hk-table">',
          '<thead><tr><th>Feld</th><th>Wert</th></tr></thead>',
          '<tbody>',
          rows.join(""),
          '</tbody></table></section>'
        ].join(""));
      }
    }
    data.rooms.forEach(room => {
      const plate = [];
      const rippen = [];
      room.heaters.forEach(hk => {
        if((hk.bauform || "").toLowerCase() === "rippen") rippen.push(hk);
        else plate.push(hk);
      });
      sections.push([
        '<section class="room">',
        '<div class="room-head">',
        '<div><div class="room-title">' + (room.roomName || "Raum " + room.index) + '</div><div class="room-sub">Geschoss: ' + (room.floor || "-") + '</div></div>',
        '<div class="badge">Raum ' + room.index + '</div>',
        '</div>',
        (plate.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>#</th><th>Bauform</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Breite [mm]</th><th>DN</th></tr></thead>',
          '<tbody>',
          plate.map((hk, i) => (
            '<tr>' +
            '<td>' + (i + 1) + '</td>' +
            '<td>' + (hk.bauform || "Platte") + '</td>' +
            '<td>' + renderCell(hk.type, hk.typeDraw) + '</td>' +
            '<td>' + renderCell(hk.height, hk.heightDraw) + '</td>' +
            '<td>' + renderCell(hk.width, hk.widthDraw) + '</td>' +
            '<td>' + renderCell(hk.dn, hk.dnDraw) + '</td>' +
            '</tr>'
          )).join(""),
          '</tbody></table>'
        ].join("") : ""),
        (rippen.length ? [
          '<table class="hk-table" style="margin-top:10px;">',
          '<thead><tr><th>#</th><th>Bauform</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Tiefe [mm]</th><th>Gliederzahl</th></tr></thead>',
          '<tbody>',
          rippen.map((hk, i) => (
            '<tr>' +
            '<td>' + (i + 1) + '</td>' +
            '<td>' + (hk.bauform || "Rippen") + '</td>' +
            '<td>' + renderCell(hk.type, hk.typeDraw) + '</td>' +
            '<td>' + renderCell(hk.height, hk.heightDraw) + '</td>' +
            '<td>' + renderCell(hk.width, hk.widthDraw) + '</td>' +
            '<td>' + renderCell(hk.dn, hk.dnDraw) + '</td>' +
            '</tr>'
          )).join(""),
          '</tbody></table>'
        ].join("") : ""),
        (!plate.length && !rippen.length ? [
          '<table class="hk-table">',
          '<thead><tr><th>#</th><th>Typ</th><th>H\u00f6he [mm]</th><th>Breite [mm]</th><th>DN</th></tr></thead>',
          '<tbody><tr><td>1</td><td>-</td><td>-</td><td>-</td><td>-</td></tr></tbody></table>'
        ].join("") : ""),
        '</section>'
      ].join(""));
    });
    container.innerHTML = [
      '<div class="doc-head"><h1>Aufnahme HK Daten</h1><div class="meta">Erstellt: ' + now + '</div></div>',
      sections.join("")
    ].join("");
    if(skipPrint) {
      document.body.classList.remove("show-print");
      return;
    }
    document.body.classList.add("show-print");
    // Force reflow before printing (iOS WebView)
    void container.offsetHeight;
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        setTimeout(() => window.print(), 300);
      });
    });
  }

  function downloadFile(data){
    const now = new Date().toLocaleString();
    const markup = buildReportMarkup(data, now);
    const html = [
      '<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>HK-Erfassung</title>',
      '<style>',
      'body { font-family: "Segoe UI", Arial, sans-serif; margin: 24px; color: #0f172a; }',
      '.doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 12px; }',
      'h1 { margin: 0; font-size: 22px; }',
      '.meta { color: #6b7280; font-size: 13px; }',
      '.room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin-bottom: 14px; background: #fff; }',
      '.room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }',
      '.room-title { font-size: 18px; font-weight: 700; }',
      '.room-sub { color: #6b7280; font-size: 14px; }',
      '.badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }',
      'table { width: 100%; border-collapse: collapse; }',
      'th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }',
      'th { background: #f8fafc; font-weight: 700; }',
      'td { background: #fff; }',
      '</style></head><body>',
      markup,
      '</body></html>'
    ].join("");
    const blob = new Blob([html], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "hk-daten.html";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 15000);
  }

  const shareBtn = document.querySelector(".share-btn");
  const resetBtn = document.querySelector(".reset-btn");
  window.addEventListener("afterprint", () => {
    document.body.classList.remove("show-print");
  });
  if(shareBtn){
    shareBtn.addEventListener("click", async () => {
      const data = collectData();
      if(
        !data.rooms.length &&
        !data.system.addressNameDraw && !data.system.addressStreetDraw &&
        !data.system.addressCityDraw && !data.system.buildingData &&
        !data.system.buildingStreetDraw && !data.system.buildingCityDraw &&
        !data.system.buildingYearDraw && !data.system.buildingUnits &&
        !data.system.buildingTypeDetached && !data.system.buildingTypeMultiFamily &&
        !data.system.buildingTypeEndTerrace && !data.system.buildingTypeMidTerrace &&
        !data.system.floorHeightBasementDraw && !data.system.floorHeightGroundDraw &&
        !data.system.floorHeight1OgDraw && !data.system.floorHeight2OgDraw &&
        !data.system.floorHeight3OgDraw && !data.system.floorHeightDgDraw &&
        !data.system.structureMassive && !data.system.structureWooden &&
        !data.system.basementHeated &&
        !data.system.notesDraw &&
        !data.system.wallNorthL1Draw && !data.system.wallNorthL2Draw &&
        !data.system.wallNorthL3Draw && !data.system.wallNorthL4Draw &&
        !data.system.wallNorthL5Draw && !data.system.wallNorthTotalDraw &&
        !data.system.wallEastL1Draw && !data.system.wallEastL2Draw &&
        !data.system.wallEastL3Draw && !data.system.wallEastL4Draw &&
        !data.system.wallEastL5Draw && !data.system.wallEastTotalDraw &&
        !data.system.wallSouthL1Draw && !data.system.wallSouthL2Draw &&
        !data.system.wallSouthL3Draw && !data.system.wallSouthL4Draw &&
        !data.system.wallSouthL5Draw && !data.system.wallSouthTotalDraw &&
        !data.system.wallWestL1Draw && !data.system.wallWestL2Draw &&
        !data.system.wallWestL3Draw && !data.system.wallWestL4Draw &&
        !data.system.wallWestL5Draw && !data.system.wallWestTotalDraw &&
        !data.system.addressPhoneDraw && !data.system.addressEmailDraw &&
        !data.system.systemManufacturer && !data.system.systemManufacturerDraw &&
        !data.system.systemTypeDraw &&
        !data.system.systemPowerDraw &&
        !data.system.systemYear && !data.system.systemFuel && !data.system.systemLocation && !data.system.heatDistribution && !data.system.pipeInsulation &&
        !data.system.optionNightReduction && !data.system.optionHydraulicBalance && !data.system.optionHeaterNiches && !data.system.optionCirculationTimed &&
        !data.system.systemThermostatValves &&
        !data.system.surfaceHeating && !data.system.distributorPhoto &&
        !data.system.heatingCircuits && !data.system.distributorDn &&
        !data.system.layingSpacing && !data.system.fbhLineDiameter &&
        !data.system.pumpCirculationDraw && !data.system.pumpCirculationHe && !data.system.pumpCirculationStf &&
        !data.system.pumpStorageDraw && !data.system.pumpStorageHe && !data.system.pumpStorageStf &&
        !data.system.pumpRecircDraw && !data.system.pumpRecircHe && !data.system.pumpRecircStf
      ){
        alert("Keine Daten erfasst.");
        return;
      }
      renderPrint(data, true);
      const html = [
        '<!DOCTYPE html><html lang="de"><head><meta charset="UTF-8"><title>HK-Uebersicht</title>',
        '<style>',
        'body { font-family: "Segoe UI", Arial, sans-serif; margin: 24px; color: #0f172a; }',
        '.doc-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 14px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px; }',
        'h1 { margin: 0; font-size: 22px; }',
        '.meta { color: #6b7280; font-size: 13px; }',
        '.room { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px 16px; margin: 0 0 14px; background: #fff; }',
        '.room-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }',
        '.room-title { font-size: 18px; font-weight: 700; }',
        '.room-sub { color: #6b7280; font-size: 14px; }',
        '.badge { background: #eef2ff; color: #1d4ed8; border: 1px solid #c7d2fe; border-radius: 8px; padding: 4px 10px; font-weight: 700; font-size: 13px; }',
        'table { width: 100%; border-collapse: collapse; }',
        'th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; font-size: 14px; }',
        'th { background: #f8fafc; font-weight: 700; }',
        '.draw-img { display: block; max-height: 60px; max-width: 140px; }',
        '</style></head><body>',
        document.getElementById("printView").innerHTML,
        '</body></html>'
      ].join("");
      try{
        const file = new File([html], "hk-uebersicht.html", { type: "text/html" });
        if(navigator.canShare && navigator.canShare({ files: [file] })){
          await navigator.share({ files: [file] });
        } else {
          renderPrint(data);
        }
      } catch(e){
        renderPrint(data);
      }
    });
  }
  if(resetBtn){
    resetBtn.addEventListener("click", () => {
      if(confirm("Alle Eingaben zuruecksetzen?")){
        try { localStorage.removeItem(STORAGE_KEY); } catch(e){}
        location.reload();
      }
    });
  }
})();
</script>
</body>
</html>
